<!doctype html><html lang=id><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><title>Transisi SELinux dari unconfined_r ke user_r</title><meta name=description content="Pada mesin Fedora 18, saya memiliki konteks SELinux berikut sebagai pengguna biasa yang dibuat selama instalasi:  $ sestatusSELinux status:                 enabledLoaded policy name:             targetedCurrent mode:                   enforcingMode from config file:..."><link rel=canonical href=https://www.idxstack.com/transisi-selinux-dari-unconfined-r-ke-user-r-bpe2lewr/><meta property="og:title" content="Transisi SELinux dari unconfined_r ke user_r"><meta property="og:description" content="Pada mesin Fedora 18, saya memiliki konteks SELinux berikut sebagai pengguna biasa yang dibuat selama instalasi:  $ sestatusSELinux status:                 enabledLoaded policy name:             targetedCurrent mode:                   enforcingMode from config file:..."><meta property="og:type" content="website"><meta property="og:url" content="https://www.idxstack.com/transisi-selinux-dari-unconfined-r-ke-user-r-bpe2lewr/"><meta property="og:site_name" content="IDXStack"><meta property="og:locale" content="id_ID"><meta name=twitter:card content="summary"><meta name=twitter:title content="Transisi SELinux dari unconfined_r ke user_r"><meta name=twitter:description content="Pada mesin Fedora 18, saya memiliki konteks SELinux berikut sebagai pengguna biasa yang dibuat selama instalasi:  $ sestatusSELinux status:                 enabledLoaded policy name:             targetedCurrent mode:                   enforcingMode from config file:..."><link rel=stylesheet href=/css/style.min.c181a38d9857323db0ab0ad950bbd049d24d2f1d58d7566522f92aae4e1057df.css><link rel=stylesheet href=/vendor/fontawesome/css/all.min.css></head><body itemscope itemtype=https://schema.org/QAPage><nav class="navbar navbar-expand-lg navbar-dark bg-dark"><div class=container><a href=/ class=navbar-brand>IDXStack</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a href=/ class=nav-link>Beranda</a></li></ul><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>About</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a href=/about-us class=dropdown-item>About</a>
<a href=/contact class=dropdown-item>Contact</a>
<a href=/disclaimer class=dropdown-item>Disclaimer</a></div></li></ul></div></div></nav><div class="container my-2" itemprop=mainEntity itemscope itemtype=https://schema.org/Question><div class="card shadow-sm mb-2"><div class=card-body><div class=mb-2><span class="badge badge-dark">Komputer</span></div><h1 class=h3 itemprop=name>Transisi SELinux dari unconfined_r ke user_r</h1><div itemprop=text><p>Pada mesin Fedora 18, saya memiliki konteks SELinux berikut sebagai pengguna biasa yang dibuat selama instalasi:</p><pre><code>$ sestatus
SELinux status:                 enabled
Loaded policy name:             targeted
Current mode:                   enforcing
Mode from config file:          enforcing
Policy MLS status:              enabled
Policy deny_unknown status:     allowed
</code></pre><p>dan</p><pre><code>$ id -Z
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</code></pre><p>Saya ingin menjalankan program dengan peran selinux terbatas <code>user_r</code>, bukan <code>unconfined_r</code> saya saat ini, jadi saya membuat pengguna baru dengan pengguna SELinux terbatas <code>user_r</code>:</p><pre><code># useradd -MN -Z user_u johndoe
# echo 'fubar' | passwd johndoe --stdin
</code></pre><p>Sekarang, saya membuka tty baru dan login sebagai <code>johndoe</code> menggunakan <code>agetty</code>. Ia mengeluh bahwa <code>/home/johndoe</code> tidak ada, tetapi pada dasarnya, ia memasukkan saya. Konteks SELinux:</p><pre><code>$ id -Z
user_u:user_r:user_t:s0
</code></pre><p><code>user_u:user_r:user_t</code> sempurna dan apa yang saya inginkan. Tapi saya ingin mencapai ini dalam sebuah naskah <em>sudah</em> berjalan sebagai <code>unconfined_u</code> dan bukan sebagai login baru. Saya mencoba dengan <code>sudo</code>:</p><p>Jika saya menggunakan <code>sudo -u</code>, saya mendapatkan:</p><pre><code>$ sudo -u johndoe id -Z
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</code></pre><p>Artinya, pengguna SELinux tidak berubah.</p><p>Saya juga mencoba:</p><pre><code>$ sudo -r user_r -u johndoe id -Z
sudo: unconfined_u:user_r:user_t:s0-s0:c0.c1023 is not a valid context
sudo: unable to execute /bin/id: Invalid argument
</code></pre><p>Jadi, tidak beruntung juga.</p><p>Jadi bagaimana cara saya beralih dari peran <code>unconfined_r</code> ke <code>user_r</code>, menggunakan <code>sudo</code> atau <code>su</code> (atau yang lainnya)?</p></div></div><div class="card-footer bg-white d-flex justify-content-between"><div><i class="far fa-heart fa-fw text-danger"></i><span itemprop=upvoteCount>4</span></div><div itemprop=author itemscope itemtype=https://schema.org/Person><a href=https://superuser.com/users/62149/arjunshankar target=_blank rel="nofollow noopener"><span itemprop=name>ArjunShankar</span></a>
—
<a href=https://superuser.com/questions/687456/selinux-transition-from-unconfined-r-to-user-r target=_blank rel="nofollow noopener">Sumber</a></div></div></div><hr><h2 class=h4><span itemprop=answerCount>3</span> Jawaban</h2><div class=form-row itemprop=acceptedAnswer itemscope itemtype=https://schema.org/Answer><div class="col-12 col-md-2 col-lg-1"><div class="card shadow-sm mb-2 d-none d-md-block"><div class="card-body text-center px-1 py-3"><i class="far fa-heart fa-fw text-danger"></i><span itemprop=upvoteCount>4</span></div></div></div><div class="col-12 col-md-10 col-lg-11"><div class="card mb-2 shadow-sm" id=answer-0><div class="card-header d-block d-md-none"><i class="far fa-heart fa-fw text-danger"></i>4</div><div class=card-body><div itemprop=text><p>Sudahkah Anda mencoba solusi policycoreutils-sandbox? Ini persis seperti yang Anda inginkan. Misalnya jika Anda ingin menjalankan Firefox di lingkungan yang dibatasi SELinux (sayangnya, tetapi untuk alasan yang baik, "kotak pasir" hanya didukung pada distribusi Red Hat):</p><pre><code>/usr/bin/sandbox -X -t sandbox_web_t firefox
</code></pre><p>SELinux dibedakan dari sistem MAC berbasis LSM lainnya karena fleksibilitas dan kemampuan penyesuaiannya.</p><p>Ini memungkinkan Anda untuk melakukan apa yang Anda inginkan, meskipun itu tidak masuk akal. Salah satu prasyaratnya adalah Anda menyadari setidaknya prinsip dan konsep dasar.</p><p>Ada beberapa hal yang perlu diperhatikan di sini:</p><ul><li>ID keamanan identitas SELinux unconfined_u harus
terkait dengan pengenal keamanan peran user_r SELinux jika Anda
ingin kombinasi "unconfined_u: user_r" dalam konteks keamanan
berlaku.</li></ul><p>Ini dapat dilakukan dengan:</p><pre><code>semanage user -m -L s0 -r s0-s0:c0.c1023 -R "unconfined_r system_r user_r" -P user unconfined_u
</code></pre><ul><li>Pengenal keamanan peran SELinux unconfined_r harus diizinkan
secara manual (melalui sudo dalam kasus ini) diubah menjadi user_r SELinux
pengenal keamanan peran.</li></ul><p>Ini dapat dilakukan dengan membuat modul kebijakan sederhana:</p><pre><code>cat &gt; myuser.te &lt;&lt;EOF
module myuser 1.0;
require { role unconfined_r, user_r; }
allow unconfined_r user_r;
EOF

checkmodule -M -m myuser.te -o myuser.mod
semodule_package -o myuser.pp -m myuser.mod
sudo semodule -i myuser.pp
</code></pre><ul><li><p>Sudo perlu diberi tahu pengenal keamanan tipe SELinux mana itu
harus digunakan bersama dengan keamanan peran user_r SELinux yang ditentukan
pengenal</p><p>sudo -r user_r -t user_t id -Z</p></li></ul><p>Saya yakin saya telah menyentuh semua pertimbangan tetapi saya mungkin telah mengabaikan beberapa dan contoh saya mungkin salah ketik. Lihat halaman manual untuk perintah yang saya sebutkan.</p></div></div><div class="card-footer text-right bg-white d-flex justify-content-between"><div><a href=https://www.idxstack.com/transisi-selinux-dari-unconfined-r-ke-user-r-bpe2lewr/#answer-0 itemprop=url>Bagikan</a></div><div itemprop=author itemscope itemtype=https://schema.org/Person><a href=https://superuser.com/users/281867/domg472 target=_blank rel="nofollow noopener"><span itemprop=name>domg472</span></a>
—
<a href=https://superuser.com/a/688375 rel="nofollow noopener" target=_blank>Sumber</a></div></div></div><div class=form-row><div class="col-2 col-lg-1"></div><div class="col-10 col-lg-11"><div class=mb-2><button class="btn btn-secondary btn-sm show-answer-replies" data-id=0>Tampilkan Balasan</button></div><div class="card shadow-sm mb-2 answer-replies-container d-none" data-id=0><ul class="list-group list-group-flush"><li class=list-group-item><div><code>sandbox -t sandbox_min_t id -Z</code> <i>tidak</i> tunjukkan bahwa peran SELinux berubah menjadi <code>sandbox_min_t</code>. Saya belum cukup tahu tentang SELinux untuk menandai jawaban ini sebagai 'benar', jadi untuk saat ini, ini mendapat +1. Terima kasih @ domg472. Saya akan menindaklanjuti jika saya tahu lebih banyak.</div><div>— <a href=https://superuser.com/users/62149/arjunshankar target=_blank rel="nofollow noopener">ArjunShankar</a></div></li></ul></div></div></div></div></div><div class=form-row itemprop=suggestedAnswer itemscope itemtype=https://schema.org/Answer><div class="col-12 col-md-2 col-lg-1"><div class="card shadow-sm mb-2 d-none d-md-block"><div class="card-body text-center px-1 py-3"><i class="far fa-heart fa-fw text-danger"></i><span itemprop=upvoteCount>2</span></div></div></div><div class="col-12 col-md-10 col-lg-11"><div class="card mb-2 shadow-sm" id=answer-1><div class="card-header d-block d-md-none"><i class="far fa-heart fa-fw text-danger"></i>2</div><div class=card-body><div itemprop=text><p>Saat menggunakan <strong>MLS</strong> , perintahmu</p><p><code>sudo -u johndoe id -Z</code></p><p>berarti Anda melewati Anda <strong>wewenang</strong> dan <strong>Tipe</strong> ke sudo. Anda harus menggunakan perintah</p><p><code>sudo -r user_r -u johndoe id -Z</code></p><p>Selain itu, jika Anda mencoba masuk dengan konsol atau ssh, Anda juga dapat melihat peran dan jenis yang benar.</p><p><strong>EDIT:</strong> Saya ingin memberikan beberapa catatan juga.
Anda tidak dapat mengubah konteks Anda (<code>id -Z</code>) jika tidak ada transisi yang valid. Anda akan mendapatkan error seperti</p><p><code>sudo: ... is not a valid context</code></p><p>Untuk menjadi root, pertama-tama Anda harus masuk <strong>sudoers</strong> file dan <strong>staff_u</strong> pengguna selinux. Untuk sudo, saya hanya suka menambahkan <code>myuser ALL=/bin/su</code> untuk menggunakan <code>sudo su -</code>. Setelah saya melakukan <code>sudo su -</code>, menjadi root, saya menjalankan <code>newrole -r sysadm_r</code> untuk mendapatkan hak admin sistem. Hal ini tidak mengherankan karena sudo tidak dapat diubah <strong>wewenang</strong> . Sama seperti, sebelum keluar saya menjalankan <code>newrole -r staff_r</code> untuk mengembalikan peran saya sendiri. Setelah itu saya log out, jika tidak shell hang (kesalahan konteks yang valid).</p></div></div><div class="card-footer text-right bg-white d-flex justify-content-between"><div><a href=https://www.idxstack.com/transisi-selinux-dari-unconfined-r-ke-user-r-bpe2lewr/#answer-1 itemprop=url>Bagikan</a></div><div itemprop=author itemscope itemtype=https://schema.org/Person><a href=https://superuser.com/users/406652/kazim-sarikaya target=_blank rel="nofollow noopener"><span itemprop=name>Kazim SARIKAYA</span></a>
—
<a href=https://superuser.com/a/862177 rel="nofollow noopener" target=_blank>Sumber</a></div></div></div></div></div><div class=form-row itemprop=suggestedAnswer itemscope itemtype=https://schema.org/Answer><div class="col-12 col-md-2 col-lg-1"><div class="card shadow-sm mb-2 d-none d-md-block"><div class="card-body text-center px-1 py-3"><i class="far fa-heart fa-fw text-danger"></i><span itemprop=upvoteCount>1</span></div></div></div><div class="col-12 col-md-10 col-lg-11"><div class="card mb-2 shadow-sm" id=answer-2><div class="card-header d-block d-md-none"><i class="far fa-heart fa-fw text-danger"></i>1</div><div class=card-body><div itemprop=text><p>Itu cukup rumit. Saya mendapatkan sesuatu yang berfungsi melalui peretasan. Pertama, tulis skrip Anda dalam sebuah file. Kemudian, gunakan <code>semanage fcontext</code> untuk menambahkan aturan pelabelan. SELinux menggunakan label ini untuk menerapkan kurungan. Dalam contoh saya, saya mereproduksi konteks postgres.</p><pre><code># semanage fcontext -a -s system_u -t postgresql_exec_t /absolute/path/to/my-script
# restorecon -v my-script
</code></pre><p>SELinux mengetahui beberapa transisi. Misalnya systemd berjalan di init_t dan file berlabel postgresql_exec_t ditransisikan dalam konteks postgresql. Jadi, saya menulis layanan oneshot systemd untuk menggunakan kembali transisi itu.</p><pre><code># /etc/systemd/system/multi-users.target.wants/my-script.service
[Unit]
Description=My Script
After=syslog.target
After=network.target

[Service]
Type=oneshot

User=postgres
Group=postgres

ExecStart=/usr/local/bin/cornac-selinux
</code></pre><p>Kemudian, jalankan dengan <code>systemctl</code></p><pre><code># systemctl start my-script.service
# journalctl -n 10 --no-pager
août 19 15:19:11 bernace-db0 cornac-selinux[14928]: + id                                                                                
août 19 15:19:11 bernace-db0 cornac-selinux[14928]: uid=26(postgres) gid=26(postgres) groupes=26(postgres) contexte=system_u:system_r:postgresql_t:s0                                                                                                                            
</code></pre><p>Itulah yang terbaik yang dapat saya lakukan sejauh ini, tanpa menulis modul kebijakan kustom.</p></div></div><div class="card-footer text-right bg-white d-flex justify-content-between"><div><a href=https://www.idxstack.com/transisi-selinux-dari-unconfined-r-ke-user-r-bpe2lewr/#answer-2 itemprop=url>Bagikan</a></div><div itemprop=author itemscope itemtype=https://schema.org/Person><a href=https://superuser.com/users/710632/%c3%89tienne-bersac target=_blank rel="nofollow noopener"><span itemprop=name>&#201;tienne Bersac</span></a>
—
<a href=https://superuser.com/a/1472893 rel="nofollow noopener" target=_blank>Sumber</a></div></div></div></div></div><div class="card shadow-sm my-2"><div class=card-header>Pertanyaan Serupa</div><ul class="list-group list-group-flush"><li class=list-group-item><div><a href=/mulai-aplikasi-windows-dari-file-batch-tanpa-jendela-perintah-sisa-wxgqtt2w/>Mulai aplikasi Windows dari file batch tanpa jendela perintah sisa</a></div></li><li class=list-group-item><div><a href=/sisipkan-gif-di-word-2013-7qlrmp0d/>Sisipkan gif di Word 2013</a></div></li><li class=list-group-item><div><a href=/aplikasi-apa-yang-dapat-menggunakan-layar-lcd-logitech-g15-66dqjyxp/>Aplikasi apa yang dapat menggunakan layar LCD Logitech G15?</a></div></li><li class=list-group-item><div><a href=/mutt-tidak-melihat-teks-html-sebaris-menggunakan-browser-mailcap-dan-teks-b9ch3t0t/>mutt tidak melihat teks / html sebaris menggunakan browser mailcap dan teks</a></div></li><li class=list-group-item><div><a href=/mencari-alternatif-untuk-alt-tab-di-compiz-opzpfc62/>Mencari alternatif untuk alt + tab di Compiz</a></div></li><li class=list-group-item><div><a href=/tidak-dapat-melihat-bantuan-xcode-42-quotindexhtmlquot-dikunci-untuk-pengeditan-6bgosvfu/>Tidak dapat melihat bantuan Xcode 4.2 "index.html" dikunci untuk pengeditan</a></div></li><li class=list-group-item><div><a href=/mengapa-font-muncul-sebagai-kotak-di-windows-8-kfzvzzbr/>Mengapa font muncul sebagai kotak di Windows 8?</a></div></li><li class=list-group-item><div><a href=/sistem-berbunyi-bip-terus-menerus-jika-kedua-ram-dimasukkan-tpww5sc5/>Sistem berbunyi bip terus menerus jika kedua RAM dimasukkan</a></div></li><li class=list-group-item><div><a href=/hapus-otomatis-download-dan-atau-sembunyikan-otomatis-bilah-download-di-chrome-atudq2vw/>Hapus Otomatis Download (dan / atau Sembunyikan Otomatis Bilah Download) di Chrome?</a></div></li><li class=list-group-item><div><a href=/brave-browser-cara-memodifikasi-pintasan-keyboard-ekstensi-4e2gkv4u/>Brave Browser: cara memodifikasi pintasan keyboard ekstensi</a></div></li></ul></div></div><div class="mt-5 bg-light"><div class=container><div class="py-4 d-flex justify-content-between small text-muted"><div>By using our site, you agree to our <a href=/terms-of-service>Terms of Service</a>, <a href=/privacy-policy>Privacy Policy</a>, and <a href=/cookie-policy>Cookie Policy</a></div><div>Berlisensi di bawah <a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel="nofollow noopener">CC BY-SA 4.0</a> dengan attribusi</div></div></div></div><script src=/js/jquery-3.5.1.min.js></script><script src=/js/bootstrap.bundle.min.js></script><script>$(document).ready(function(){$("#showQuestionReplies").click(function(){$("#questionRepliesContainer").toggleClass("d-none")}),$(".show-answer-replies").click(function(){var a=$(this).data("id");$(".answer-replies-container[data-id='"+a+"']").toggleClass("d-none")})})</script></body></html>