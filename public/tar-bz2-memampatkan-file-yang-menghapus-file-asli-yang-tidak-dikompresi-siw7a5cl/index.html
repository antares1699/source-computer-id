<!doctype html><html lang=id><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><title>tar / bz2 memampatkan file yang menghapus file asli yang tidak dikompresi</title><meta name=description content="Apakah ada cara untuk mengubah direktori bernama dir1 menjadi dir1.tar.bz2 tanpa menyimpan aslinya? Saya perlu menghemat ruang dan ingin mengompres beberapa file besar tetapi tidak memiliki cukup ruang untuk menyimpan salinan terkompresi..."><link rel=canonical href=https://www.idxstack.com/tar-bz2-memampatkan-file-yang-menghapus-file-asli-yang-tidak-dikompresi-siw7a5cl/><meta property="og:title" content="tar / bz2 memampatkan file yang menghapus file asli yang tidak dikompresi"><meta property="og:description" content="Apakah ada cara untuk mengubah direktori bernama dir1 menjadi dir1.tar.bz2 tanpa menyimpan aslinya? Saya perlu menghemat ruang dan ingin mengompres beberapa file besar tetapi tidak memiliki cukup ruang untuk menyimpan salinan terkompresi..."><meta property="og:type" content="website"><meta property="og:url" content="https://www.idxstack.com/tar-bz2-memampatkan-file-yang-menghapus-file-asli-yang-tidak-dikompresi-siw7a5cl/"><meta property="og:site_name" content="IDXStack"><meta property="og:locale" content="id_ID"><meta name=twitter:card content="summary"><meta name=twitter:title content="tar / bz2 memampatkan file yang menghapus file asli yang tidak dikompresi"><meta name=twitter:description content="Apakah ada cara untuk mengubah direktori bernama dir1 menjadi dir1.tar.bz2 tanpa menyimpan aslinya? Saya perlu menghemat ruang dan ingin mengompres beberapa file besar tetapi tidak memiliki cukup ruang untuk menyimpan salinan terkompresi..."><link rel=stylesheet href=/css/style.min.c181a38d9857323db0ab0ad950bbd049d24d2f1d58d7566522f92aae4e1057df.css><link rel=stylesheet href=/vendor/fontawesome/css/all.min.css></head><body itemscope itemtype=https://schema.org/QAPage><nav class="navbar navbar-expand-lg navbar-dark bg-dark"><div class=container><a href=/ class=navbar-brand>IDXStack</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a href=/ class=nav-link>Beranda</a></li></ul><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>About</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a href=/about-us class=dropdown-item>About</a>
<a href=/contact class=dropdown-item>Contact</a>
<a href=/disclaimer class=dropdown-item>Disclaimer</a></div></li></ul></div></div></nav><div class="container my-2" itemprop=mainEntity itemscope itemtype=https://schema.org/Question><div class="card shadow-sm mb-2"><div class=card-body><div class=mb-2><span class="badge badge-dark">Komputer</span></div><h1 class=h3 itemprop=name>tar / bz2 memampatkan file yang menghapus file asli yang tidak dikompresi</h1><div itemprop=text><p>Apakah ada cara untuk mengubah direktori bernama dir1 menjadi dir1.tar.bz2 tanpa menyimpan aslinya? Saya perlu menghemat ruang dan ingin mengompres beberapa file besar tetapi tidak memiliki cukup ruang untuk menyimpan salinan terkompresi dan aslinya. Apakah ada cara untuk mengubah file yang ada menjadi arsip secara langsung?</p></div></div><div class="card-footer bg-white d-flex justify-content-between"><div><i class="far fa-heart fa-fw text-danger"></i><span itemprop=upvoteCount>4</span></div><div itemprop=author itemscope itemtype=https://schema.org/Person><a href=https://superuser.com/users/225838/gregg-leventhal target=_blank rel="nofollow noopener"><span itemprop=name>Gregg Leventhal</span></a>
â€”
<a href=https://superuser.com/questions/656111/tar-bz2-compress-a-file-removing-uncompressed-original target=_blank rel="nofollow noopener">Sumber</a></div></div></div><hr><h2 class=h4><span itemprop=answerCount>1</span> Jawaban</h2><div class=form-row itemprop=acceptedAnswer itemscope itemtype=https://schema.org/Answer><div class="col-12 col-md-2 col-lg-1"><div class="card shadow-sm mb-2 d-none d-md-block"><div class="card-body text-center px-1 py-3"><i class="far fa-heart fa-fw text-danger"></i><span itemprop=upvoteCount>8</span></div></div></div><div class="col-12 col-md-10 col-lg-11"><div class="card mb-2 shadow-sm" id=answer-0><div class="card-header d-block d-md-none"><i class="far fa-heart fa-fw text-danger"></i>8</div><div class=card-body><div itemprop=text><p><code>tar</code> tidak dapat melakukannya, tetapi Anda dapat mencapai apa yang Anda inginkan dengan:</p><p><code>find dir1 -depth -print0 | xargs -0 tar --create --no-recursion --remove-file --file - | bzip2 > dir1.tar.bz2</code></p><p>dimana:</p><ul><li><p><code>find dir1 -depth -print0</code></p><p>daftar semua file dan direktori di <code>dir1</code>, daftar isi direktori sebelum direktori itu sendiri (<code>-depth</code>). Penggunaan <code>-print0</code> (dan <code>-0</code> pada <code>xargs</code> di bawah) adalah kuncinya <strong>mendukung direktori dan nama file dengan spasi yang disematkan</strong> .</p></li><li><p><code>xargs -0 tar --create --no-recursion --remove-file --file -</code></p><p>membuat arsip tar dan menambahkan setiap file atau direktori ke dalamnya. Arsip tar dikirim ke output standar dengan opsi <code>--file -</code>.</p></li><li><p><code>bzip2 > dir1.tar.bz2</code></p><p>mengompresi arsip tar dari input standar ke file bernama <code>dir1.tar.bz2</code>.</p></li></ul><p><strong>Jumlah ruang disk kosong yang dibutuhkan adalah ukuran file terkompresi terbesar di tahun <code>dir1</code></strong> karena <code>tar</code>, saat memproses file, menunggu hingga pengarsipan selesai sebelum menghapusnya. Karena <code>tar</code> disalurkan ke <code>bzip2</code>, untuk sesaat, sebelum <code>tar</code> menghapusnya, setiap file berada di dua tempat: tidak dikompresi di sistem file dan dikompresi di dalam <code>dir1.tar.bz2</code>.</p><p>Saya ingin tahu bagaimana ruang disk digunakan, jadi saya membuat eksperimen ini di VM Ubuntu saya:</p><ol><li><p>Buat sistem file 1 GB:</p><pre><code>$ dd if=/dev/zero of=/tmp/1gb bs=1M count=1024
$ losetup /dev/loop0 /tmp/1gb
$ mkfs.ext3 /dev/loop0
$ sudo mount /dev/loop0 /tmp/mnt
$ df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/loop0     1008M   34M  924M   4% /tmp/mnt
</code></pre></li><li><p>Isi filesystem dengan 900 file berukuran 1 megabyte:</p><pre><code>$ chown jaume /tmp/mnt
$ mkdir /tmp/mnt/dir1
$ for (( i=0; i&lt;900; i++ )); do dd if=/dev/urandom of=/tmp/mnt/dir1/file$i bs=1M count=1; done
$ chown -R jaume /tmp/mnt
$ df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/loop0     1008M  937M   20M  98% /tmp/mnt
</code></pre><p>Sistem berkas sekarang 98% penuh.</p></li><li><p>Buat salinan <code>dir1</code> untuk verifikasi nanti:</p><pre><code>$ cp -a /tmp/mnt/dir1 /tmp/dir1-check
</code></pre></li><li><p>Kompres <code>--file -</code>:</p><pre><code>$ ls /tmp/mnt
dir1  lost+found
$ find /tmp/mnt/dir1 -depth -print0 | xargs -0 tar --create --no-recursion --remove-file --file - | bzip2 &gt; /tmp/mnt/dir1.tar.bz2
$
</code></pre><p><strong>Perhatikan bahwa perintah berjalan tanpa kesalahan 'tidak ada ruang tersisa di perangkat'.</strong></p><p><code>dir1</code> telah dihapus, hanya <code>dir1.tar.bz2</code> yang ada:</p><pre><code>$ ls /tmp/mnt
dir1.tar.bz2  lost+found
</code></pre></li><li><p>Perluas <code>dir1.tar.bz2</code> dan bandingkan dengan <code>/tmp/dir1-check</code>:</p><pre><code>$ tar --extract --file dir1.tar.bz2 --bzip2 --directory /tmp
$ diff -s /tmp/dir1 /tmp/dir1-check
(...)
Files /tmp/dir1/file97 and /tmp/dir1-check/file97 are identical
Files /tmp/dir1/file98 and /tmp/dir1-check/file98 are identical
Files /tmp/dir1/file99 and /tmp/dir1-check/file99 are identical
$
</code></pre><p>Salinan <code>dir1</code> dan <code>dir1.tar.bz2</code> yang tidak terkompresi adalah sama!</p></li></ol><p>Ini dapat digeneralisasikan dalam skrip:</p><ol><li><p>Buat file bernama <code>tarrm</code> (atau nama lain yang Anda sukai) dengan konten berikut:</p><pre><code>#!/bin/bash

# This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
# This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.
# You should have received a copy of the GNU General Public License along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.

# dir is first argument
dir="$1"
# check dir exists
if [ ! -d "$dir" ]; then
    echo "$(basename $0): error: '$dir' doesn't exist" 1&gt;&amp;2
    exit 1
fi
# check if tar file exists
if [ -f "${dir}.tar" -o -f "${dir}.tar.bz2" ]; then
    echo "$(basename $0): error: '$dir.tar' or '${dir}.tar.bz2' already exist" 1&gt;&amp;2
    exit 1
fi

# --keep is second argument
if [ "X$2" == "X--keep" ]; then
    # keep mode
    removefile=""
    echo " Tarring '$dir'"
else
    removefile="--remove-file"
    echo " Tarring and **deleting** '$dir'"
fi

# normalize directory name (for example, /home/jaume//// is a legal directory name, but will break ${dir}.tar.bz2 - it needs to be converted to /home/jaume)
dir=$(dirname "$dir")/$(basename "$dir")

# create compressed tar archive and delete files after adding them to it
find "$dir" -depth -print0 | xargs -0 tar --create --no-recursion $removefile --file - | bzip2 &gt; "${dir}.tar.bz2"

# return status of last executed command
if [ $? -ne 0 ]; then
    echo "$(basename $0): error while creating '${dir}.tar.bz2'" 1&gt;&amp;2
fi
</code></pre></li><li><p>Jadikan itu dapat dieksekusi:</p><p><code>chmod a+x tarrm</code></p></li></ol><p>Skrip melakukan beberapa pemeriksaan kesalahan dasar: <code>dir1</code> harus ada, <code>$ ls /tmp/mnt
dir1.tar.bz2 lost+found</code> dan <code>dir1.tar</code> seharusnya tidak ada dan memiliki <em>menjaga</em> mode. Ini juga mendukung direktori dan nama file dengan spasi yang disematkan.</p><p><strong>Saya telah menguji skripnya tetapi tidak dapat menjamin bahwa itu sempurna</strong> , jadi gunakan dulu dalam mode simpan:</p><p><code>./tarrm dir1 --keep</code></p><p>Pemanggilan ini akan menambahkan <code>dir1</code> ke <code>dir1.tar.bz2</code> tetapi tidak akan menghapus direktori.</p><p>Ketika Anda mempercayai skrip, gunakan seperti ini:</p><p><code>./tarrm dir1</code></p><p>Skrip akan memberi tahu Anda bahwa <code>find dir1 -depth -print0</code> akan dihapus dalam proses memasang tar:</p><p><code>Tarring and **deleting** 'dir1'</code></p><p>Sebagai contoh:</p><pre><code>$ ls -lF
total 4
drwxrwxr-x 3 jaume jaume 4096 2013-10-11 11:00 dir 1/
$ find "dir 1"
dir 1
dir 1/subdir 1
dir 1/subdir 1/file 1
dir 1/file 1
$ /tmp/tarrm dir\ 1/
 Tarring and **deleting** 'dir 1/'
$ echo $?
0
$ ls -lF
total 4
-rw-rw-r-- 1 jaume jaume 181 2013-10-11 11:00 dir 1.tar.bz2
$ tar --list --file dir\ 1.tar.bz2 
dir 1/subdir 1/file 1
dir 1/subdir 1/
dir 1/file 1
dir 1/
</code></pre></div></div><div class="card-footer text-right bg-white d-flex justify-content-between"><div><a href=https://www.idxstack.com/tar-bz2-memampatkan-file-yang-menghapus-file-asli-yang-tidak-dikompresi-siw7a5cl/#answer-0 itemprop=url>Bagikan</a></div><div itemprop=author itemscope itemtype=https://schema.org/Person><a href=https://superuser.com/users/156041/jaume target=_blank rel="nofollow noopener"><span itemprop=name>jaume</span></a>
â€”
<a href=https://superuser.com/a/657440 rel="nofollow noopener" target=_blank>Sumber</a></div></div></div><div class=form-row><div class="col-2 col-lg-1"></div><div class="col-10 col-lg-11"><div class=mb-2><button class="btn btn-secondary btn-sm show-answer-replies" data-id=0>Tampilkan Balasan</button></div><div class="card shadow-sm mb-2 answer-replies-container d-none" data-id=0><ul class="list-group list-group-flush"><li class=list-group-item><div>Pendekatan yang menarik. Tampaknya tergantung pada ketersediaan ruang disk yang cukup untuk menyimpan arsip tar yang tidak terkompresi serta arsip yang hampir terkompresi sepenuhnya, karena bzip2 (serta alat lain yang saya ketahui) sebenarnya tidak kompres <i>di tempat</i> . Mungkin, mungkin saja, Anda bisa menggunakan pipa dari subkulit untuk membantu itu?</div><div>â€” <a href=https://superuser.com/users/53590/user target=_blank rel="nofollow noopener">user</a></div></li><li class=list-group-item><div>Ya, solusi yang saya usulkan memang membutuhkan cukup ruang untuk mengompresi <code>dir1.tar</code>. Pendekatan lain (yang lebih sederhana) adalah menggunakan <code>zip</code> sebagai gantinya: <code>zip --recurse-paths --move "dir 1.zip" "dir 1"</code>. Saya telah mengedit jawaban saya dengan menyebutkan <code>zip</code> ...</div><div>â€” <a href=https://superuser.com/users/156041/jaume target=_blank rel="nofollow noopener">jaume</a></div></li><li class=list-group-item><div>Nah, ternyata <code>zip</code> bukanlah pilihan. Saya memutar kembali ke jawaban awal. <code>zip</code> tidak memberikan apa yang diinginkan OP (dari halaman manual): <i>--move Pindahkan file yang ditentukan ke dalam arsip zip; sebenarnya, ini menghapus direktori / file target <b>setelah membuat</b> arsip zip tertentu. Jika direktori menjadi kosong setelah file dihapus, direktori tersebut juga dihapus. <b>Tidak ada penghapusan yang dilakukan sampai zip membuat arsip tanpa kesalahan.</b></i> &lt;/b></div><div>â€” <a href=https://superuser.com/users/156041/jaume target=_blank rel="nofollow noopener">jaume</a></div></li><li class=list-group-item><div>Solusi yang mengesankan. Saya kira pertanyaan yang tersisa adalah berapa banyak ruang kosong yang diperlukan untuk menjalankan operasi ini. Apakah itu memerlukan arsip + arsip asli, atau lebih kecil dari itu?</div><div>â€” <a href=https://superuser.com/users/225838/gregg-leventhal target=_blank rel="nofollow noopener">Gregg Leventhal</a></div></li><li class=list-group-item><div>@ MichaelKjÃ¶rling Terima kasih atas petunjuknya, saya perhatikan saya dapat menggunakan <code>tar --create</code> daripada <code>tar --append</code> jadi saya meningkatkan solusi untuk menyalurkan dan mengirim output terkompresi ke file. Sekarang jumlah ruang disk kosong yang dibutuhkan adalah ukuran file yang dikompresi di <code>dir1</code> yang merupakan yang terbesar setelah dikompresi, jauh lebih kecil dari <code>dir.tar</code>.</div><div>â€” <a href=https://superuser.com/users/156041/jaume target=_blank rel="nofollow noopener">jaume</a></div></li><li class=list-group-item><div>@GreggLeventhal Saya telah meningkatkan solusinya dan sekarang jumlah ruang disk kosong yang diperlukan adalah ukuran file yang dikompresi pada <code>dir1</code> yang merupakan yang terbesar setelah dikompresi. Saya melakukan pengujian dengan sistem file 98% penuh dan bekerja tanpa hambatan.</div><div>â€” <a href=https://superuser.com/users/156041/jaume target=_blank rel="nofollow noopener">jaume</a></div></li><li class=list-group-item><div>Saya belum mengujinya sendiri, tetapi saya memberi Anda jawaban atas jumlah waktu dan upaya yang Anda lakukan. Anda harus menempatkan skrip ini ke bahasa tingkat yang lebih tinggi seperti Python dan membuka sumbernya. Terima kasih atas pekerjaan Anda!</div><div>â€” <a href=https://superuser.com/users/225838/gregg-leventhal target=_blank rel="nofollow noopener">Gregg Leventhal</a></div></li><li class=list-group-item><div>Saya sangat menghargai komentar Anda, Gregg. Python saya (dan PHP, Perl, dll dalam hal ini) sangat buruk jadi saya tidak berpikir saya akan menulis ulang skrip tetapi saya telah menambahkan pernyataan izin penyalinan GPL standar. Pastikan Anda memiliki cadangan data Anda sebelum menguji skrip.</div><div>â€” <a href=https://superuser.com/users/156041/jaume target=_blank rel="nofollow noopener">jaume</a></div></li><li class=list-group-item><div>Saya akan memberikan suara positif ini lagi jika saya bisa, tetapi sayangnya, saya sudah menggunakan penjatahan suara positif saya untuk jawaban khusus ini ...</div><div>â€” <a href=https://superuser.com/users/53590/user target=_blank rel="nofollow noopener">user</a></div></li><li class=list-group-item><div>Saya pikir ada sesuatu yang hilang di sini. variabel "removeir" tidak digunakan, dan saat diuji, program ini hanya menghapus file tetapi tidak direktori. Saya hanya akan menambahkan <code>if [ "$removedir" == "true" ]; then;rm -rf $dir; fi</code></div><div>â€” <a href=https://superuser.com/users/239282/mveroone target=_blank rel="nofollow noopener">mveroone</a></div></li><li class=list-group-item><div>Anda benar, terima kasih telah menunjukkannya dan atas saran Anda. Saya akan memeriksa skripnya nanti dan mengeditnya.</div><div>â€” <a href=https://superuser.com/users/156041/jaume target=_blank rel="nofollow noopener">jaume</a></div></li><li class=list-group-item><div>@Kwaio Dalam pengujian saya, saya menemukan bahwa variabel <code>removedir</code> tidak diperlukan, jadi saya telah menghapusnya. Direktori akan dihapus jika <code>--keep</code> tidak ditentukan, saya bertanya-tanya mengapa hanya menghapus file dalam pengujian Anda. Saya menjalankan <code>tarrm</code> di OS X 10.9.1.</div><div>â€” <a href=https://superuser.com/users/156041/jaume target=_blank rel="nofollow noopener">jaume</a></div></li><li class=list-group-item><div>Saya menggunakan RHEL3 dengan kernel 2.4.17 dan coreutils 4.5.3. yang dapat mengubah banyak hal. Terima kasih untuk skripnya, bagaimanapun, file adalah yang paling memakan ruang.</div><div>â€” <a href=https://superuser.com/users/239282/mveroone target=_blank rel="nofollow noopener">mveroone</a></div></li></ul></div></div></div></div></div><div class="card shadow-sm my-2"><div class=card-header>Pertanyaan Serupa</div><ul class="list-group list-group-flush"><li class=list-group-item><div><a href=/dapatkah-saya-menggunakan-winscp-dalam-mode-hanya-baca-egthfgob/>Dapatkah saya menggunakan WinSCP dalam mode hanya-baca</a></div></li><li class=list-group-item><div><a href=/apa-alasan-komputer-melambat-secara-bertahap-setelah-penggunaan-berbulan-bulan-duplikat-tzyp5w4j/>Apa alasan komputer melambat secara bertahap setelah penggunaan berbulan-bulan? [duplikat]</a></div></li><li class=list-group-item><div><a href=/menghapus-folder-di-linux-bash-hqx5yw2j/>menghapus folder di linux bash</a></div></li><li class=list-group-item><div><a href=/apa-ding-shell-meminta-dengan-waktu-di-dalamnya-lilqjd4o/>Apa DING !? Shell meminta dengan waktu di dalamnya</a></div></li><li class=list-group-item><div><a href=/bagaimana-cara-menyimpan-kata-sandi-dengan-aman-di-irssi-841ahupy/>Bagaimana cara menyimpan kata sandi dengan aman di Irssi?</a></div></li><li class=list-group-item><div><a href=/tentukan-ukuran-file-gambar-yang-disematkan-dalam-dokumen-word-owavylsr/>Tentukan ukuran file gambar yang disematkan dalam dokumen Word</a></div></li><li class=list-group-item><div><a href=/bagaimana-cara-mengatur-font-default-untuk-gvim-di-windows-gkthu44a/>Bagaimana cara mengatur font default untuk gvim di Windows?</a></div></li><li class=list-group-item><div><a href=/bagaimana-saya-bisa-masuk-ke-bios-di-sony-vaio-vpceh25en-saya-rr1jjdkr/>Bagaimana saya bisa masuk ke BIOS di Sony Vaio VPCEH25EN saya</a></div></li><li class=list-group-item><div><a href=/menggabungkan-baris-cmd-mulai-dari-beberapa-parameter-gdlognyc/>menggabungkan baris cmd mulai dari beberapa parameter</a></div></li><li class=list-group-item><div><a href=/mintty-di-cygwin-cara-mengubah-spasi-baris-idmody9w/>mintty di Cygwin: cara mengubah spasi baris</a></div></li></ul></div></div><div class="mt-5 bg-light"><div class=container><div class="py-4 d-flex justify-content-between small text-muted"><div>By using our site, you agree to our <a href=/terms-of-service>Terms of Service</a>, <a href=/privacy-policy>Privacy Policy</a>, and <a href=/cookie-policy>Cookie Policy</a></div><div>Berlisensi di bawah <a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel="nofollow noopener">CC BY-SA 4.0</a> dengan attribusi</div></div></div></div><script src=/js/jquery-3.5.1.min.js></script><script src=/js/bootstrap.bundle.min.js></script><script>$(document).ready(function(){$("#showQuestionReplies").click(function(){$("#questionRepliesContainer").toggleClass("d-none")}),$(".show-answer-replies").click(function(){var a=$(this).data("id");$(".answer-replies-container[data-id='"+a+"']").toggleClass("d-none")})})</script></body></html>