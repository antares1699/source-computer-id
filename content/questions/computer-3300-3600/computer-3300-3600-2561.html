{"title":"Bagaimana perangkat PCI diakses?","draft":false,"url":"/bagaimana-perangkat-pci-diakses-gr5cc94z","votes":"4","answers_count":"2","categories":["Komputer"],"tags":["linux","drivers","pci"],"snippet":"Saya punya 2 pertanyaan terkait bus PCI:  Bagaimana driver perangkat mengakses perangkat pada bus PCI? Apakah cukup untuk menulis ke wilayah memori yang dialokasikan untuk perangkat (mov memory_space_allocated_for_dev, something, jika perangkat adalah...","body":"<p> Saya punya 2 pertanyaan terkait bus PCI: </p>\n\n<p> Bagaimana driver perangkat mengakses perangkat pada bus PCI? Apakah cukup untuk menulis ke wilayah memori yang dialokasikan untuk perangkat (<code>mov memory_space_allocated_for_dev, something</code>, jika perangkat adalah memori yang dipetakan, atau <code>out io_space_allocated for_dev, something</code> jika tidak) (apakah perangkat keras akan menerjemahkan upaya ini untuk mengakses lokasi memori ke rangkaian perintah PCI pada bus PCI, dll.?). </p>\n\n<p> Apakah benar bahwa setelah mengatur semua perangkat di semua bus PCI (mis. Mengalokasikan ruang memori, menghitung bus, dll.), Driver perangkat tidak perlu mengetahui apakah bus PCI ada atau decoding memori dilakukan dengan decoder sederhana (seperti di komputer lama ) (mis. mereka hanya menulis dan membaca dari beberapa lokasi memori untuk mengakses perangkat)? </p>","source":"https://superuser.com/questions/1087635/how-are-pci-devices-accessed","author":"<a href=\"https://superuser.com/users/604691/maplaz\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">maplaz</span></a>","replies":[],"answers":[{"answer":"<p> Perangkat PCI (e) yang dipetakan memori akan memiliki BAR (register alamat dasar) yang memungkinkan host mengetahui berapa banyak memori yang harus dialokasikan untuk perangkat tersebut. BIOS (dan OS selanjutnya) akan mengalokasikan ruang memori yang diminta ke perangkat target - bukan memori <strong> alamat </strong> , bit fisik tidak dialokasikan. Selain itu, ini umumnya akan menjadi <strong> ingatan fisik </strong> alamat, bukan alamat memori virtual. Kernel Linux akan mengatur akses ke perangkat ini dengan fungsi seperti mmap () yang memungkinkan pemetaan memori fisik ke alamat memori virtual. </p>\n\n<p> Misalnya, Anda memiliki perangkat PCIe yang mengontrol 8 LED. Sebagai pembuat perangkat, saya dapat meminta BAR yang sangat kecil dari 1K ruang alamat. BIOS dapat memberi saya alamat fisik pada sistem 32-bit dari 0xE000_0000 hingga 0xE000_0400 (catatan tambahan: Anda harus melihat di sini sekarang mengapa sistem 32-bit dan GPU dengan VRAM besar tidak bekerja sama dengan baik). </p>\n\n<p> Sekarang, jika saya menulis katakan 0xF0 ke lokasi memori 0xE000_0000 dengan penulisan satu byte, itu akan menyalakan LED 7 hingga 4, dan membiarkan 3 hingga 0 mati. Itu saja - ini adalah I / O yang dipetakan dengan memori sederhana. Menambahkan pada lapisan abstraksi, di Linux, Anda akan menggunakan subsistem PCI yang sangat baik dan menulis driver yang dimuat untuk string ID Vendor + ID Perangkat tertentu. Anda kemudian dapat menulis aplikasi userspace yang memanggil driver kernel tersebut, di mana panggilan mmap () dapat memetakan memori ke dalam userspace, memungkinkan aplikasi userspace Anda untuk membaca / menulis byte pada beberapa alamat memori virtual yang akan diterjemahkan dan berakhir. dalam ruang memori fisik tempatnya. </p>\n\n<p> x86 tentu saja memiliki ruang I / O, dan perilakunya sangat mirip, kecuali tingkat rendah di kernel, instruksi outb / outw / outl (dan sepupu inputnya) akan digunakan untuk menulis / membaca dari ruang I / O, vs. instruksi baca / tulis memori. Sekali lagi, aplikasi userspace harus berkomunikasi melalui ioctls () dan segmen memori yang dipetakan karena kernel bertanggung jawab atas keamanan / akses ke memori seperti itu. </p>\n\n<p> Untuk pertanyaan kedua Anda, jenis campuran di atas, tetapi driver PCIe modern untuk Linux akan bersandar pada subsistem PCI untuk banyak hal pemeliharaan rumah tingkat rendah. Anda biasanya menentukan Vendor / ID Perangkat apa yang menjadi tanggung jawab Anda, dan kemudian menulis fungsi .probe () yang menarik IRQ Anda dan melakukan pengaturan perangkat - memori Anda diserahkan kepada Anda. </p>","votes":"7","source":"https://superuser.com/a/1095067","author":"<a href=\"https://superuser.com/users/539671/krunal-desai\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Krunal Desai</span></a>","replies":[]},{"answer":"<p> Sudah lama, tetapi jika saya ingat dengan benar, driver kernel Anda akan menyiapkan perangkat di / dev yang memetakan ke alamat memori yang dialokasikan ke perangkat PCI baik oleh BIOS atau kernel. Program ruang pengguna dengan izin yang sesuai kemudian akan membuka, membaca / menulis / mencari, dan menutup / dev / file itu untuk berinteraksi dengan perangkat PCI. Lihat bab 12 dari Driver Perangkat Linux: <a href=\"https://lwn.net/Kernel/LDD3/\" rel=\"nofollow noopener\" target=\"_blank\"> https://lwn.net/Kernel/LDD3/ </a></p>","votes":"0","source":"https://superuser.com/a/1087752","author":"<a href=\"https://superuser.com/users/292524/isaac\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Isaac</span></a>","replies":[]}]}
