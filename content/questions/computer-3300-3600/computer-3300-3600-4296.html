{"title":"Kirim pesan kernel ke proses lain saat terjadi","draft":false,"url":"/kirim-pesan-kernel-ke-proses-lain-saat-terjadi-mrygbjwd","votes":"4","answers_count":"3","categories":["Komputer"],"tags":["linux","logging","kernel","linux-kernel","kernel-messages"],"snippet":"Saya memiliki layar OLED di laptop saya yang telah saya konfigurasikan untuk menampilkan informasi status. Driver saat ini yang telah saya instal di Linux untuk itu dapat menampilkan pesan dengan mengirimkannya ke...","body":"<p> Saya memiliki layar OLED di laptop saya yang telah saya konfigurasikan untuk menampilkan informasi status. Driver saat ini yang telah saya instal di Linux untuk itu dapat menampilkan pesan dengan mengirimkannya ke skrip sebagai argumen yang dipisahkan oleh spasi. </p>\n\n<p> Contoh: perintah <code>/opt/asusg50oled/utils/notify.sh Hi Everybody \"Hello World\"</code> ditampilkan di layar OLED: </p> <pre><code>Hi\nEverybody\nHello World\n</code></pre> <p> Jika pesan lain dikirim sebelum pesan lama menghilang dan kembali ke info status, pesan teratas akan terdorong. Contoh: kurang dari 30 detik setelah contoh sebelumnya, <code>/opt/asusg50oled/utils/notify.sh \"Bananas have potassium\"</code> dijalankan: </p> <pre><code>Everybody\nHello World\nBananas have potassium\n</code></pre> <p> Yang ingin saya lakukan adalah memiliki pesan kernel (jenis yang Anda lihat dengan menjalankan <code>dmesg</code>) diteruskan ke skrip ini. Misalnya, ketika saya memasukkan drive USB, informasi berikut akan ditampilkan di layar OLED saat mereka masuk: </p> <pre><code>[ 1283.200150] usb 2-4: new high speed USB device using ehci_hcd and address 4\n[ 1283.353322] scsi9 : usb-storage 2-4:1.0\n[ 1284.351366] scsi 9:0:0:0: Direct-Access     SanDisk  Cruzer           1.03 PQ: 0 ANSI: 2\n[ 1284.352697] sd 9:0:0:0: Attached scsi generic sg4 type 0\n[ 1284.355669] sd 9:0:0:0: [sdd] 31266816 512-byte logical blocks: (16.0 GB/14.9 GiB)\n[ 1284.357032] sd 9:0:0:0: [sdd] Write Protect is off\n[ 1284.357041] sd 9:0:0:0: [sdd] Mode Sense: 03 00 00 00\n[ 1284.357047] sd 9:0:0:0: [sdd] Assuming drive cache: write through\n[ 1284.364356] sd 9:0:0:0: [sdd] Assuming drive cache: write through\n[ 1284.364371]  sdd: sdd1\n[ 1284.371656] sd 9:0:0:0: [sdd] Assuming drive cache: write through\n[ 1284.371666] sd 9:0:0:0: [sdd] Attached SCSI removable disk\n</code></pre> <p> Perhatikan bahwa karena lebar layar yang terbatas, menghapus stempel waktu juga akan berguna. Jadi di akhir pencatatan, layar akan muncul sekitar 30 detik: </p> <pre><code>  sdd: sdd1\n sd 9:0:0:0: [sdd] Assuming drive cache: write through\n sd 9:0:0:0: [sdd] Attached SCSI removable disk\n</code></pre> <p> Jadi, untuk memperjelas, saya ingin pesan kernel dikirim secara langsung dengan menjalankan <code>/opt/asusg50oled/utils/notify.sh \"$MESSAGE\"</code> </p>\n\n<p> Saya dapat memasukkan filter untuk menyingkirkan apa pun yang tidak ingin saya lihat nanti, saya hanya ingin tahu cara melakukan bagian-bagian yang disebutkan di atas. Bagaimana saya bisa melakukan ini? </p>\n\n<h3 class=\"h5\"> Sunting </h3>\n\n<p> Seperti yang disarankan Ciclamino, saya menambahkan baris berikut ke file /etc/rsyslog.conf saya: </p> <pre><code>kern.*  ^/opt/asusg50oled/utils/notify.sh\n</code></pre> <p> Ini hampir berhasil, tetapi pemformatan menghasilkan OLED hanya menampilkan tanggal, nama host, dan kata &#39;kernel&#39; sebelum kehabisan ruang. Setelah sedikit menggali, saya menemukan yang berikut: </p> <pre><code>$template OLEDformat,\"%msg%0\nkern.*  ^/opt/asusg50oled/utils/notify.sh;OLEDformat\n</code></pre> <p> Ini hampir sampai, tetapi sekali lagi, saya kehabisan ruangan karena semacam stempel waktu .. contoh tampilan: </p> <pre><code>[ 4477.993774] sd 11:0:0:0: [sdb] At\n</code></pre> <p> Saya ingin menghilangkan angka dalam tanda kurung jadi saya pergi </p> <pre><code>sd 11:0:0:0: [sdb] Attached SCSI rem\n</code></pre> <p> Masih belum sempurna tapi yang terbaik akan saya dapatkan dengan ukuran layarnya. Akan lebih baik jika itu akan membaginya menjadi 36 karakter sehingga saya dapat memiliki sesuatu seperti berikut: </p> <pre><code>sd 11:0:0:0: [sdb] Attached SCSI rem\novable disk\n</code></pre> <h1 class=\"h3\"> TERPECAHKAN </h1>\n\n<p> Saya menerima jawaban Ciclamino, karena itu membawa saya ke tempat yang saya inginkan. Inilah yang akhirnya saya lakukan: </p>\n\n<p> Saya membuat dan menambahkan bit eksekusi ke skrip shell <code>/opt/asusg50oled/utils/notify-kern.sh</code> yang berisi </p> <pre><code>#!/bin/bash\ncd `dirname $0`\nstringA=$1\nstringB=${stringA#\\[*\\]}\nstringC=${stringB:0:36}\nstringD=${stringB:36}\n./notify.sh \"$stringC\" \"$stringD\"\n</code></pre> <p> Lalu saya menambahkan ke /etc/rsyslog.conf </p> <pre><code>## output kernel messages to OLED\n$template OLEDformat,\"%msg%\"\nkern.*  ^/opt/asusg50oled/utils/notify-kern.sh;OLEDformat\n</code></pre> <p> Akhirnya, saya memulai ulang rsyslog dengan <code>sudo service rsyslog restart</code>. </p>","source":"https://superuser.com/questions/270507/pipe-kernel-messages-to-another-process-as-they-occur","author":"<a href=\"https://superuser.com/users/40564/tuxrug\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">TuxRug</span></a>","replies":[],"answers":[{"answer":"<p> Anda dapat menggunakan syslog untuk menangkap pesan kernel dan menyalurkannya ke sebuah perintah. Sintaksnya akan sedikit berbeda untuk berbagai implementasi syslogd yang berbeda. Berikut adalah contoh bagaimana melakukannya dengan rsyslog (di /etc/rsyslog.conf): </p> <pre><code>kern.*  ^/opt/asusg50oled/utils/notify.sh\n</code></pre>","votes":"3","source":"https://superuser.com/a/270546","author":"<a href=\"https://superuser.com/users/76394/ciclamino\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Ciclamino</span></a>","replies":[{"reply":"Ini persis seperti yang ingin saya lakukan. Saya akan memeriksa untuk melihat apakah itu berfungsi dengan baik saat saya menggunakan Linux.","author":"<a href=\"https://superuser.com/users/40564/tuxrug\" target=\"_blank\" rel=\"nofollow noopener\">TuxRug</a>"},{"reply":"Ini SANGAT dekat ... Sekarang saya mendapatkan tanggal, nama host, kata kernel, titik dua, dan kemudian OLED kehabisan ruang ... Saya akan melihat apakah saya bisa mencari cara untuk menghilangkannya ... Saya yakin saya bisa menulis skrip perantara untuk mengeluarkan: dan semua yang sebelumnya.","author":"<a href=\"https://superuser.com/users/40564/tuxrug\" target=\"_blank\" rel=\"nofollow noopener\">TuxRug</a>"},{"reply":"Sepertinya saya butuh sedikit bantuan lagi ... bagaimana cara membuatnya memangkas semuanya dan termasuk yang pertama &#39;:&#39;? Saat ini saya mendapatkan <code>Apr 14 11:36:35 TuxTop-III-LM kernel:</code> dan kemudian saya kehabisan ruang.","author":"<a href=\"https://superuser.com/users/40564/tuxrug\" target=\"_blank\" rel=\"nofollow noopener\">TuxRug</a>"},{"reply":"Oke, saya menemukan sesuatu yang membuat saya semakin dekat ... Saya menggunakan template (lihat edit pertanyaan) .. Masih belum cukup.","author":"<a href=\"https://superuser.com/users/40564/tuxrug\" target=\"_blank\" rel=\"nofollow noopener\">TuxRug</a>"}]},{"answer":"<p> berikut adalah solusi cepat dan kotor: </p> <pre><code>tail -n 0 -f /var/log/messages | while read -r MESSAGE; do\n  /opt/asusg50oled/utils/notify.sh \"$MESSAGE\"\ndone\n</code></pre>","votes":"3","source":"https://superuser.com/a/270519","author":"<a href=\"https://superuser.com/users/39401/lesmana\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">lesmana</span></a>","replies":[{"reply":"Ini tidak mendorong mereka saat terjadi, dan saya hanya ingin yang baru saja ditembakkan untuk ditampilkan. Saya ingin sesuatu yang menangkap pesan saat diproduksi.","author":"<a href=\"https://superuser.com/users/40564/tuxrug\" target=\"_blank\" rel=\"nofollow noopener\">TuxRug</a>"},{"reply":"@TuxRug Saya mengacaukannya. Seharusnya <code>&#47;var&#47;log&#47;messages</code> bukannya <code>&#47;var&#47;log&#47;dmesg</code>. Saya memperbarui jawaban saya. Selain itu, dengan <code>tail -n 0</code> Anda hanya mendapatkan pesan terbaru setelah pemanggilan perintah.","author":"<a href=\"https://superuser.com/users/39401/lesmana\" target=\"_blank\" rel=\"nofollow noopener\">lesmana</a>"}]},{"answer":"<p> Anda dapat membaca keluaran <code>/proc/kmsg</code> berulang kali menggunakan <code>tail</code> atau metode apa pun yang Anda inginkan. </p>\n\n<p> saya <em> berpikir </em> Anda harus menjadi root untuk melakukannya. </p>","votes":"0","source":"https://superuser.com/a/270513","author":"<a href=\"https://superuser.com/users/53304/new123456\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">new123456</span></a>","replies":[{"reply":"Sayangnya, ini akan mencetak pesan secara terus menerus. Saya ingin perintah diaktifkan sekali per pesan sehingga pesan akan muncul selama 30 detik. Setelah 30 detik berlalu tanpa pesan baru, itu akan kembali ke tampilan status normal.","author":"<a href=\"https://superuser.com/users/40564/tuxrug\" target=\"_blank\" rel=\"nofollow noopener\">TuxRug</a>"}]}]}
