{"title":"Apakah ada cara untuk mengetahui apakah file sudah selesai disalin?","draft":false,"url":"/apakah-ada-cara-untuk-mengetahui-apakah-file-sudah-selesai-disalin-j6cbkfpm","votes":"4","answers_count":"6","categories":["Komputer"],"tags":["scp"],"snippet":"Skenarionya adalah ini: Mesin A memiliki file yang ingin saya salin ke Mesin C. Mesin A tidak dapat mengakses C secara langsung, tetapi dapat mengakses Mesin B yang dapat mengakses Mesin C....","body":"<p> Skenarionya adalah ini: Mesin A memiliki file yang ingin saya salin ke Mesin C. Mesin A tidak dapat mengakses C secara langsung, tetapi dapat mengakses Mesin B yang dapat mengakses Mesin C. Saya menggunakan scp untuk menyalin dari Mesin A ke B, dan lalu dari B ke C. </p>\n\n<p> Mesin B memiliki ruang penyimpanan terbatas, jadi saat file masuk, saya perlu menyalinnya ke C dan menghapusnya dari B. Salinan kedua jauh lebih cepat, jadi tidak ada masalah dengan bandwidth. </p>\n\n<p> Saya bisa melakukan ini dengan tangan, tetapi saya malas. Yang saya inginkan adalah menjalankan skrip pada B atau C yang akan menyalin setiap file ke C <strong> saat masing-masing selesai </strong> . Pekerjaan scp dijalankan dari A. </p>\n\n<p> Jadi yang saya butuhkan adalah cara untuk menanyakan (sebaiknya dari skrip bash) apakah file X.avi sudah &quot;selesai&quot; disalin. Masing-masing file ini memiliki ukuran yang berbeda, dan saya tidak dapat benar-benar memprediksi ukuran atau waktu penyelesaiannya. </p>\n\n<p> Sunting: ngomong-ngomong, waktu transfer file adalah sekitar 1 jam dari A ke B dan sekitar 10 menit dari B ke C, jika skala waktu itu penting. </p>","source":"https://superuser.com/questions/45224/is-there-a-way-to-tell-if-a-file-is-done-copying","author":"<a href=\"https://superuser.com/users/314/mike-cooper\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Mike Cooper</span></a>","replies":[],"answers":[{"answer":"<p> Cara umum untuk melakukan ini adalah dengan menyalinnya terlebih dahulu ke nama file sementara, lebih disukai file yang tersembunyi. Saat penyalinan selesai, skrip yang melakukan penyalinan kemudian mengganti namanya menjadi nama file yang tidak tersembunyi. </p>\n\n<p> Skrip pada mesin B kemudian dapat mengawasi file yang tidak tersembunyi. </p>\n\n<p> Skrip pada mesin A akan terlihat seperti ini: </p> <pre><code>for file in `ls *` ; do\n    scp $file user@host:~/.${file}.tmp\n    ssh user@host \"mv ~/.${file}.tmp $file\"\ndone\n</code></pre> <p> Meski ini tidak memuaskan keinginan OP menggunakan satu baris </p> <pre><code>scp * user@host:~/\n</code></pre> <p> itu menyelesaikan hal yang sama dan juga memungkinkan mesin B untuk mentransfer setiap file saat selesai tanpa menunggu file berikutnya. </p>","votes":"8","source":"https://superuser.com/a/45232","author":"<a href=\"https://superuser.com/users/1804/bmb\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">bmb</span></a>","replies":[{"reply":"Masalah dengan ini adalah bahwa pada mesin A saya ingin melakukan <code>scp * user@host:~&#47;</code> dan file yang sedang disalin akan lebih dari sekadar mengisi mesin B, jadi saya tidak dapat memindahkan / mengganti nama file setelah disalin dari A.","author":"<a href=\"https://superuser.com/users/314/mike-cooper\" target=\"_blank\" rel=\"nofollow noopener\">Mike Cooper</a>"},{"reply":"Ah, jadi jika saya mengerti dengan benar, Anda menangani lebih dari satu file sekaligus? Dari situlah masalahnya berasal?","author":"<a href=\"https://superuser.com/users/11945/josh\" target=\"_blank\" rel=\"nofollow noopener\">Josh</a>"},{"reply":"Ya, itulah masalahnya. Saya tidak dapat menyimpan semua file di B, tetapi salinan ini akan memakan waktu cukup lama sehingga saya tidak ingin duduk dan mengasuhnya dengan melihat setiap file selesai dan kemudian menyalinnya. Mungkin saya akan menggunakan versi yang diperluas Anda.","author":"<a href=\"https://superuser.com/users/314/mike-cooper\" target=\"_blank\" rel=\"nofollow noopener\">Mike Cooper</a>"}]},{"answer":"<p> Apakah <code>lsof</code> pada mesin B menunjukkan bahwa scp telah membuka file? jika demikian, Anda dapat menonton <code>lsof</code> dan melihat kapan scp menutup file. Jika tidak, Anda dapat melihat ukuran file dan setelah itu tidak berubah selama jangka waktu tertentu (5 menit, misalnya), salin dari B ke C. </p>\n\n<p> Pilihan ketiga adalah menyalin file dari A ke direktori &quot;in_progress&quot; di C. Setelah penyalinan selesai di A, jalankan perintah <code>mv</code> untuk keluar dari direktori &quot;in_progress&quot;. </p>","votes":"2","source":"https://superuser.com/a/45230","author":"<a href=\"https://superuser.com/users/11945/josh\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Josh</span></a>","replies":[{"reply":"Sayangnya <code>lsof</code> tampaknya tidak ada di mesin B. Tentang opsi ketiga Anda, itu tidak akan berfungsi karena jika saya membiarkan salinan selesai sebelum saya melakukan apa pun, saya akan sangat membanjiri ruang yang diizinkan di B (sekitar 10: 1) . Jadi, solusi apa pun yang saya miliki harus bekerja selama penyalinan.","author":"<a href=\"https://superuser.com/users/314/mike-cooper\" target=\"_blank\" rel=\"nofollow noopener\">Mike Cooper</a>"},{"reply":"Ide menunggu 5 menit adalah ide yang bagus (saya memikirkan sesuatu yang serupa) tetapi saya tidak begitu yakin bagaimana hal itu akan dilakukan. Ada ide?","author":"<a href=\"https://superuser.com/users/314/mike-cooper\" target=\"_blank\" rel=\"nofollow noopener\">Mike Cooper</a>"},{"reply":"Ya, saya bisa menulis skrip ruby ​​yang cepat dan kotor untuk Anda - apakah mesin B memiliki ruby?","author":"<a href=\"https://superuser.com/users/11945/josh\" target=\"_blank\" rel=\"nofollow noopener\">Josh</a>"},{"reply":"Nggak. Itu tidak di bawah kendali saya dan tampaknya tidak memiliki hal-hal yang saya coba dan gunakan. Saya berharap bash mungkin memiliki sesuatu untuk melakukan ini. Meskipun saya mungkin dapat menjalankan skrip dari mesin lokal saya ... Saya akan bereksperimen dengan itu.","author":"<a href=\"https://superuser.com/users/314/mike-cooper\" target=\"_blank\" rel=\"nofollow noopener\">Mike Cooper</a>"},{"reply":"Saya akan melihat apakah saya dapat membuat kode seperti itu di bash saja. Namun, kecakapan rubi saya melebihi kecakapan pesta saya. stackoverflow.com mungkin dapat membantu dengan skrip semacam itu.","author":"<a href=\"https://superuser.com/users/11945/josh\" target=\"_blank\" rel=\"nofollow noopener\">Josh</a>"},{"reply":"Sebenarnya saya pikir saya sudah menemukan jawabannya, lihat jawaban saya.","author":"<a href=\"https://superuser.com/users/314/mike-cooper\" target=\"_blank\" rel=\"nofollow noopener\">Mike Cooper</a>"}]},{"answer":"<p> Saya hanya memikirkan pilihan lain yang sama sekali tidak berhubungan. Tidak menggunakan scp sama sekali. Tolong beri tahu saya jika ini akan berhasil: </p>\n\n<ol>\n<li><p> di B, buat pipa fifo di suatu tempat:\nmkfifo / tmp / xfer </p></li>\n<li><p> di A, jangan gunakan scp, sebagai gantinya, <code>tar\n-cz files | ssh B 'cat &gt; /tmp/xfer</code> </p></li>\n<li><p> di C, jalankan <code>ssh B 'cat /tmp/xfer' |\ntar -xz</code> </p></li>\n</ol>\n\n<p> Dengan cara ini, data tidak disimpan di B, data hanya melewati pipa. Sisi negatifnya adalah, Anda hanya dapat memiliki satu salinan dalam satu waktu ... </p>\n\n<p> Anda harus memastikan proses pada C respawn setiap kali selesai. </p>","votes":"2","source":"https://superuser.com/a/45257","author":"<a href=\"https://superuser.com/users/11945/josh\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Josh</span></a>","replies":[{"reply":"Cara Anda menjelaskan ini tampaknya berhasil ... tetapi tampaknya sedikit &quot;sihir gelap&quot; untuk seleraku. Saya pikir menemukan solusi lain yang berfungsi dengan cara asli, tetapi saya pasti akan menyimpan cuplikan ini untuk digunakan nanti.","author":"<a href=\"https://superuser.com/users/314/mike-cooper\" target=\"_blank\" rel=\"nofollow noopener\">Mike Cooper</a>"},{"reply":"Cara ini sebenarnya bukan &quot;sihir gelap&quot;, ini hanya menggunakan pipa yang merupakan fasilitas OS standar. Tetapi saya lebih menyukai solusi Anda yang lain, ini lebih sedikit kodenya dan mungkin lebih mudah dipelihara.","author":"<a href=\"https://superuser.com/users/11945/josh\" target=\"_blank\" rel=\"nofollow noopener\">Josh</a>"},{"reply":"Oh, bukan berarti bagi saya itu ajaib karena saya belum pernah bermain dengan pipa fifo dan itu adalah sesuatu yang tidak digunakan sesering benda lainnya. Padahal sesuatu untuk dipelajari sekarang. Selain itu, pemeliharaan tidak terlalu menjadi masalah. Ini akan diatur selama sekitar satu hari.","author":"<a href=\"https://superuser.com/users/314/mike-cooper\" target=\"_blank\" rel=\"nofollow noopener\">Mike Cooper</a>"}]},{"answer":"<p> Setelah memikirkan jawaban yang diposting (khususnya gagasan @ Josh tentang menonton waktu yang dimodifikasi) saya mencoba menjalankan manipulasi file B di C. Lihat, B anemia sejauh alat yang tersedia, jadi tidak ada yang tampaknya dapat melakukan pekerjaan itu ada disana. Saya menemukan solusi ini. Ide ini bukan milik saya, saya menemukannya di pencarian google sebelum pertanyaan ini. Saya membuangnya sebelumnya, karena mesin B tidak memiliki utilitas <code>find</code>. </p>\n\n<p> Pertama, pasang direktori yang sesuai di B ke C, sehingga muncul sebagai sistem file lokal. Saya menggunakan <code>sshfs</code> untuk ini (alat yang luar biasa, omong-omong). Ini akan membiarkan saya menggunakan utilitas C, bukan B. </p>\n\n<p> Kedua, perintah <code>find /the/folder/* -mmin +5</code> akan mencocokkan semua file yang dimodifikasi lebih dari 5 menit yang lalu. Jadi perintah <code>find /the/folder/* -mmin +5 -exec {} /the/other/folder \\;</code> akan memindahkan semua file yang telah dimodifikasi lebih dari 5 menit yang lalu ke folder lain (yaitu <em> sebenarnya </em> di C, bukan sshf yang dipasang dari B. </p>\n\n<p> Akhirnya, saya menyiapkan skrip cron untuk menjalankan skrip di atas setiap 10 menit hari ini dan besok. Garis di crontab saya terlihat seperti ini. </p> <pre><code>*/5 * 22,23 9 * find /the/folder/* -mmin +5 -exec mv {} /the/other/folder \\;\n</code></pre> <p> Semoga ini berhasil. File berikutnya belum selesai, jadi saya tidak dapat berkomentar apakah itu benar-benar berfungsi saat digabungkan dengan skrip cron, tetapi saya membuat beberapa file dengan tangan dan mengunggulkannya dan mereka bergerak dengan baik. <em> silangkan jariku </em></p>\n\n<p> Sunting: Ini berfungsi, meskipun bagaimana awalnya memiliki beberapa kesalahan, itu diperbaiki sekarang. </p>","votes":"2","source":"https://superuser.com/a/45269","author":"<a href=\"https://superuser.com/users/314/mike-cooper\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Mike Cooper</span></a>","replies":[{"reply":"Kedengarannya seperti solusi yang luar biasa","author":"<a href=\"https://superuser.com/users/11945/josh\" target=\"_blank\" rel=\"nofollow noopener\">Josh</a>"}]},{"answer":"<p> Tidak perlu mkfifo. Di mesin B, jalankan ini: </p> <pre><code>ssh A 'tar -cz files' | ssh C 'tar -xz'\n</code></pre> <p> Anda mungkin menemukan opsi tar -C berguna. </p>\n\n<p> Jika Anda perlu memulai penyalinan di mesin A, lakukan saja: </p> <pre><code>tar -cz files' | ssh B \"ssh C 'tar -xz'\"\n</code></pre> <p> Berhati-hatilah dengan kutipan yang tepat. </p>","votes":"1","source":"https://superuser.com/a/147539","author":"<a href=\"https://superuser.com/users/38831/tuomassalo\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">tuomassalo</span></a>","replies":[]},{"answer":"<p> Salinan akan berjalan sebagai proses lain, atau Anda dapat memaksanya, menggunakan subkulit. Kemudian, Anda dapat menggunakan ps untuk &quot;melihat&quot; proses dan melihat kapan proses tersebut menghilang. </p>\n\n<p> Selain itu, saya yakin bahwa di * nix, Anda dapat menghapus file saat sedang disalin. Sistem tidak akan menghapusnya sampai program penyalinan menutupnya. Tentu saja, jika penyalinan tidak berhasil, Anda kehilangan filenya, jadi, bukan ide terbaik. </p>","votes":"0","source":"https://superuser.com/a/45242","author":"<a href=\"https://superuser.com/users/133/gbarry\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">gbarry</span></a>","replies":[{"reply":"Saya tidak perlu menyalin setelah seluruh salinan selesai, karena saya menyalin banyak file. Saya perlu tahu kapan setiap file telah selesai.","author":"<a href=\"https://superuser.com/users/314/mike-cooper\" target=\"_blank\" rel=\"nofollow noopener\">Mike Cooper</a>"}]}]}
