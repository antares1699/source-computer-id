{"title":"Teruskan X11 melalui koneksi SSH ke host penampung?","draft":false,"url":"/teruskan-x11-melalui-koneksi-ssh-ke-host-penampung-cszgvzck","votes":"4","answers_count":"3","categories":["Komputer"],"tags":["docker","x11-forwarding","alpine-linux"],"snippet":"Saya ingin menjalankan aplikasi GUI dalam container dari mesin jarak jauh.  Saya tidak ingin menyelesaikan masalah ini dengan menambahkan host ssh ke wadah karena  Saya sudah memiliki akses ke mesin host melalui...","body":"<p> Saya ingin menjalankan aplikasi GUI dalam container dari mesin jarak jauh. </p>\n\n<p> Saya tidak ingin menyelesaikan masalah ini dengan menambahkan host ssh ke wadah karena </p>\n\n<ul>\n<li> Saya sudah memiliki akses ke mesin host melalui SSH </li>\n<li> Itu menambah overhead yang tidak perlu </li>\n<li> Itu membuat wadah tidak portabel antara penggunaan jarak jauh dan lokal </li>\n</ul>\n\n<p> Saya sudah berhasil menjalankan aplikasi GUI di host, tetapi tidak dari dalam penampung. Ini adalah langkah-langkah yang saya ambil sejauh ini: </p>\n\n<h1 class=\"h3\"> Tuan rumah </h1>\n\n<ul>\n<li> <code>xauth +</code> <em> (bukan untuk jangka panjang, tapi berguna untuk menghilangkan kemungkinan masalah) </em></li>\n<li> <code>docker-user</code> dengan uid 501000 pada host == <code>docker-user</code> dengan uid 1000 dalam wadah melalui fitur namespace </li>\n<li> File <code>.Xauthority</code> disalin ke folder rumah <code>docker-user</code> </li>\n</ul>\n\n<h1 class=\"h3\"> Dockerfile </h1>\n\n<ul>\n<li> Berbasis alpine </li>\n<li> Menginstal <code>xauth</code> dan, untuk tujuan pengujian, <code>xterm</code> </li>\n<li> Membuat <code>docker-user</code> dengan uid / gid yang tepat </li>\n</ul>\n\n<h1 class=\"h3\"> buruh pelabuhan-menulis </h1>\n\n<ul>\n<li> Variabel lingkungan <code>DISPLAY</code> diteruskan masuk </li>\n<li> Volume <code>/home/docker-user/:/home/docker-user/:ro</code> menyediakan <code>.Xauthority</code> cookie </li>\n<li> Volume <code>/tmp/.X11-unix:/tmp/.X11-unix:ro</code> untuk menyediakan akses soket X11 </li>\n<li> Jalankan perintah <code>su - docker-user -c \"export DISPLAY=$DISPLAY &amp;&amp; xterm\"</code> <ul>\n<li> <code>su</code> digunakan untuk dijalankan sebagai <code>docker-user</code> </li>\n<li> <code>DISPLAY</code> diteruskan ke konteks <code>su</code> </li>\n</ul></li>\n</ul>\n\n<p> Sayangnya, ini belum cukup. Sementara xterm pada OS host terhubung ke server X lokal saya tanpa masalah, xterm dalam wadah mengatakan <code>Xt error: Can't open display: localhost:10.0</code>. </p>\n\n<p> Saya telah mengonfirmasi bahwa &quot;localhost: 10.0&quot; benar, localhost ada di wadah <code>/etc/hosts</code>, dan cookie serta soket membuatnya melalui dengan izin yang tepat. </p>\n\n<p> Apa lagi yang mungkin salah? </p>","source":"https://superuser.com/questions/1202611/forward-x11-over-an-ssh-connection-to-containers-host","author":"<a href=\"https://superuser.com/users/332854/m-pixel\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">M-Pixel</span></a>","replies":[],"answers":[{"answer":"<p> Sepertinya Anda melakukan semua hal yang sama yang saya lakukan KECUALI Anda membagikan .Xauthority pada saat pembuatan penampung. Itu berarti jika Anda pernah melakukan ssh -X ke mesin Anda setelah membuat penampung, .Xauthority tidak akan valid lagi. Anda tidak dapat melakukan ssh -X dari terminal lain ke mesin yang sama dan kembali dan menggunakan .Xauthority, ssh -X mengubah .Xauthority setiap saat untuk terminal terbaru. Saya hanya membuatnya berfungsi dengan menyalin .Xauthority setiap kali saya ssh -X ke mesin saya dan mencoba berbagi layar dengan container saya. </p>\n\n<p> catatan: Saya berbagi perangkat dan id mesin karena saya meneruskan output webcam </p>\n\n<h2 class=\"h4\"> 1.Buat container dan beri tahu xhost untuk mengizinkan penerusan dari ID container: </h2> <pre><code>sudo docker run -it -d \\\n    --net=host \\\n    --env=\"DISPLAY\" \\\n    --env=\"QT_X11_NO_MITSHM=1\" \\\n    --volume=\"/tmp/.X11-unix:/tmp/.X11-unix:rw\" \\\n    --device=\"/dev/video0:/dev/video0\" \\\n    --volume=\"/path/to/your/sharedDockerFiles:/root/sharedDockerFiles\" \\\n    --volume=\"/etc/machine-id:/etc/machine-id\" \\\n    yourdockerrepo/image:tag \\\n    bash\nexport containerId=$(docker ps -l -q)\nsudo xhost +local:`sudo docker inspect --format='{{ .Config.Hostname }}' $containerId`\nsudo docker start $containerId\n</code></pre> <h2 class=\"h4\"> 2. Salin .Xauthority dari rumah host ke direktori sharedDockerFiles: </h2> <pre><code>sudo cp ~/.Xauthority /path/to/your/sharedDockerFiles\n</code></pre> <h2 class=\"h4\"> 3. <strong> Mulai dan pasang wadah Anda </strong></h2>\n\n<h2 class=\"h4\"> 4. <strong> Salin .Xauthority di folder bersama Anda ke rumah kontainer Anda </strong></h2> <pre><code>sudo cp /root/sharedDockerFiles/.Xauthority ~/\n</code></pre> <h2 class=\"h4\"> 5. <strong> (diperlukan sekali): Edit penampung / etc / ssh / ssh_config di bawah Host * untuk memasukkan: </strong></h2> <pre><code>   ForwardX11 yes\n   X11Forwarding yes\n</code></pre> <h2 class=\"h4\"> 6. <strong> Mulai ulang penampung Anda dan pasang kembali dan jalankan aplikasi GUI </strong></h2>\n\n<h2 class=\"h4\"> 7. <strong> Jika Anda masih mengalami masalah, pastikan variabel $ DISPLAY di container sama dengan host </strong></h2> <pre><code>echo $DISPLAY #do this in the container\nexit\necho $DISPLAY #do this in the host, should be the same as container's\n#if they aren't equal, start container and:\nexport DISPLAY= #put the output of your host's $DISPLAY variable here\n</code></pre>","votes":"5","source":"https://superuser.com/a/1239663","author":"<a href=\"https://superuser.com/users/760171/pale-bone\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">pale bone</span></a>","replies":[]},{"answer":"<p> Salin .Xauthority dalam penampung di awal sesi ssh sebelum menggunakan GUI: </p> <pre><code>sudo docker exec -i container_name bash -c 'cat &gt; ~/.Xauthority' &lt; ~/.Xauthority\n</code></pre> <p> Kemudian, Anda dapat meneruskan DISPLAY jika menggunakan &#39;docker exec&#39;. Misalnya. untuk membuka pesta baru: </p> <pre><code>sudo docker exec -it --env=\"DISPLAY\" container_name bash\n</code></pre> <p><strong> 2 kemungkinan penyebab kesalahan lainnya: </strong> (selain jawaban yang diterima) </p>\n\n<ul>\n<li><p><strong> dasar: </strong> Anda tidak memiliki server ssh atau xauth dalam penampung (untuk ubuntu, jalankan &#39;apt install openssh-server xauth&#39;) </p></li>\n<li><p><strong> yang licik: </strong> Jika wadah Anda <em> nama host </em> berbeda dengan yang ada dari host (misalnya, setel melalui -h badge di &#39;docker run&#39;) Anda akan mendapatkan kesalahan dan Anda harus mengatasinya (misalnya mengatur nama host yang sama atau menambahkan cookie ke xauth) </p></li>\n</ul>","votes":"1","source":"https://superuser.com/a/1266667","author":"<a href=\"https://superuser.com/users/813637/jure-sencar\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Jure Sencar</span></a>","replies":[{"reply":"Solusi ini berhasil untuk saya. Ternyata cukup dengan hanya menyalin file .Xauthority ke container docker tanpa perlu merestartnya.","author":"<a href=\"https://superuser.com/users/306581/nikolay-frick\" target=\"_blank\" rel=\"nofollow noopener\">Nikolay Frick</a>"}]},{"answer":"<p> Mari kita mulai buruh pelabuhan dengan opsi --net = host. Itu membuat penampung untuk melihat tumpukan jaringan yang sama dari host. </p>\n\n<p> Sebagai contoh, </p>\n\n<p> docker run --net = host --rm -ti -u myid -e DISPLAY = &quot;$ DISPLAY&quot; -v /tmp/.X11-unix:/tmp/.X11-unix image: tag BINARY </p>","votes":"0","source":"https://superuser.com/a/1205206","author":"<a href=\"https://superuser.com/users/724092/psh\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">psh</span></a>","replies":[]}]}
