{"title":"Keluar / b 0 tidak menyetel% errorlevel% ke 0","draft":false,"url":"/keluar-b-0-tidak-menyetel-errorlevel-ke-0-hdiwij0c","votes":"4","answers_count":"2","categories":["Komputer"],"tags":["windows","command-line","batch","jenkins","windows-error-reporting"],"snippet":"Saya memiliki perilaku aneh pengaturan tingkat kesalahan wrt dalam skrip batch ke 0.  Saya memanggil skrip batch a.bat pada pekerjaan Jenkins, yang pada gilirannya memanggil skrip kedua b.cmd dan mengevaluasi tingkat kesalahan...","body":"<p> Saya memiliki perilaku aneh pengaturan tingkat kesalahan wrt dalam skrip batch ke 0. </p>\n\n<p> Saya memanggil skrip batch <code>a.bat</code> pada pekerjaan Jenkins, yang pada gilirannya memanggil skrip kedua <code>b.cmd</code> dan mengevaluasi tingkat kesalahan setelah panggilan: </p> <pre><code>:: b.cmd\n:: some stuff, but relevant is only this:\n@echo b errorlevel: %errorlevel%\nEXIT /B 0\n</code></pre> <p> Skrip &quot;utama&quot;: </p> <pre><code>:: a.bat\npushd %CD%\ncd..\n\n@echo a errorlevel: %errorlevel%\n\nset outputdir=\".\\some\\exisiting\\dir\"\n:: (1)\nmd %outpurdir%\n@echo a errorlevel: %errorlevel%\n\n:: (!)\nif \"$somevar\" = \"FOO\" ( \n  cd .\\WhereBIs\n\n  :: (2)\n  call :seterr 0\n  @echo a errorlevel: %errorlevel%\n\n  :: (3)\n  call b.cmd\n\n  @if %errorlevel% neq 0 (\n    @echo a errorlevel: %errorlevel%\n    set errmsg=Error calling b\n    goto error\n  )\n\n  :: more stuff\n)\n\n:error\n@echo %errmsg%\npopd\n:: (4)\n@echo a errorlevel: %errorlevel%\n@if %errorlevel% neq 0 exit %errorlevel%\nExit /B 1\n\n:seterr\nexit /b %1\n</code></pre> <p> (Saya meminjam barang <code>:seterr</code> dari <a href=\"https://superuser.com/questions/649303/setting-errorlevel-to-0\" target=\"_blank\" rel=\"nofollow noopener\"> pertanyaan ini </a> ) </p>\n\n<p> Apa yang tampaknya terjadi ketika saya menjalankan pekerjaan Jenkins: </p>\n\n<ol>\n<li> <code>md</code> kembali dan errorlevel diatur ke 1, karena direktori sudah ada. </li>\n<li> panggilan ke <code>:seterr</code> tidak memiliki efek yang diharapkan, tingkat kesalahan tetap 1 </li>\n<li> panggilan ke <code>b.cmd</code> selesai tanpa masalah, tingkat kesalahan pada <code>b</code> adalah 0, tetapi setelah panggilan tingkat kesalahan pada <code>a</code> adalah <em> masih </em> 1, yang pasti tidak saya harapkan setelah membaca jawaban atas pertanyaan terkait. </li>\n<li> setelah lompatan ke <code>:error</code> dan panggilan <code>popd</code>, errorlevel tiba-tiba direset ke 0 - yang juga tidak saya harapkan. </li>\n</ol>\n\n<p> Adakah yang tahu apa yang mungkin terjadi di sini? Saya tidak sengaja mengatur errorlevel secara manual, jadi itu harus variabel sistem, bukan yang ditentukan pengguna. </p>","source":"https://superuser.com/questions/858418/exit-b-0-does-not-set-errorlevel-to-0","author":"<a href=\"https://superuser.com/users/233255/arne-mertz\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Arne Mertz</span></a>","replies":[{"reply":"Apakah Anda bekerja dengan setlocal / endlocal di mana saja?","author":"<a href=\"https://superuser.com/users/339147/marsh-wiggle\" target=\"_blank\" rel=\"nofollow noopener\">marsh-wiggle</a>"},{"reply":"@boboes tidak ada setlocal / endlocal di salah satu skrip.","author":"<a href=\"https://superuser.com/users/233255/arne-mertz\" target=\"_blank\" rel=\"nofollow noopener\">Arne Mertz</a>"}],"answers":[{"answer":"<p> Anda belum menampilkan seluruh skrip. Satu-satunya penjelasan yang mungkin saya ketahui adalah kode Anda berada dalam blok kode yang lebih besar, mungkin bagian dari loop FOR atau kondisi IF. </p>\n\n<p> % ERRORLEVEL% diperluas saat garis diurai, dan seluruh blok yang diberi tanda kurung diurai pada waktu yang sama. Jadi KESALAHAN yang Anda lihat pasti sudah ada sebelum dimulainya paranthesis terluar. </p>\n\n<p> Anda harus menggunakan perluasan tertunda jika Anda ingin melihat nilai yang berubah dalam blok kode. </p>\n\n<p> Berikut ini demonstrasi sederhana: </p> <pre><code>@echo off\nsetlocal enableDelayedExpansion\nset var=BEFORE\n(\n  set var=AFTER\n  echo Normal expansion shows value before block started: %var%\n  echo Delayed expansion shows the current value: !var!\n)\n</code></pre> <p> - KELUARAN - </p> <pre><code>Normal expansion shows value before block started: BEFORE\nDelayed expansion shows the current value: AFTER\n</code></pre>","votes":"7","source":"https://superuser.com/a/858681","author":"<a href=\"https://superuser.com/users/109090/dbenham\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">dbenham</span></a>","replies":[{"reply":"Terima kasih. Anda benar, saya tidak menunjukkan keseluruhan ~ 120 Garis. Saya akan memeriksa blok kode dalam tanda kurung segera setelah saya kembali bekerja.","author":"<a href=\"https://superuser.com/users/233255/arne-mertz\" target=\"_blank\" rel=\"nofollow noopener\">Arne Mertz</a>"},{"reply":"Itu memang blok if, saya mengedit pertanyaan (blok if dimulai setelah komentar <code>:: (!)</code>. Bahasa Thansk untuk mengklarifikasi kesalahan saya!","author":"<a href=\"https://superuser.com/users/233255/arne-mertz\" target=\"_blank\" rel=\"nofollow noopener\">Arne Mertz</a>"}]},{"answer":"<p> Meskipun permintaan ini diselesaikan, ada alasan lain untuk perilaku seperti yang dijelaskan. Contoh, letakkan ini ke dalam file batch dan jalankan: </p> <pre><code>@set errorlevel=\n@dir &gt;nul\n@if %errorlevel% equ 0 (echo 1: Correctly detected: No error!) else echo.\n@if not errorlevel 1 (echo A: Correctly detected: No error!) else echo.\n@dir nonexistent &gt;nul\n@if %errorlevel% neq 0 (echo 2: Correctly detected: An error!) else echo.\n@if errorlevel 1 (echo B: Correctly detected: An error!) else echo.\n\n@set errorlevel=7\n@dir &gt;nul\n@if %errorlevel% equ 0 (echo 3: Correctly detected: No error!) else echo.\n@if not errorlevel 1 (echo C: Correctly detected: No error!) else echo.\n@dir nonexistent &gt;nul\n@if %errorlevel% neq 0 (echo 4: Correctly detected: An error!) else echo.\n@if errorlevel 1 (echo D: Correctly detected: An error!) else echo.\n</code></pre> <p> Jika Anda mengamati keluaran kelompok ini, baris yang dimulai dengan 3: akan hilang, dan baris yang dimulai dengan 4: akan nakal. </p>\n\n<p> Kesimpulan: Jangan mengevaluasi errorlevel dengan% errorlevel% tetapi dengan if errorlevel. </p>","votes":"0","source":"https://superuser.com/a/878525","author":"<a href=\"https://superuser.com/users/419397/hint\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">hint</span></a>","replies":[{"reply":"Anda melompat ke kesimpulan yang salah. Ada kalanya nilai pasti ERRORLEVEL diperlukan, dalam hal ini <code>%ERRORLEVEL%</code> adalah satu-satunya opsi yang masuk akal. Kesimpulan yang benar adalah Anda tidak boleh menentukan variabel lingkungan ERRORLEVEL Anda sendiri, karena variabel tersebut menggantikan nilai dinamis. Hal yang sama berlaku untuk variabel semu dinamis lainnya seperti <code>%CD%</code>, <code>%TIME%</code>, <code>%DATE%</code>, <code>%RANDOM%</code>, dll. Jika variabel ditentukan, maka perilaku dinamis dipulihkan dengan membatalkan definisi variabel dengan <code>set &quot;errorlevel=&quot;</code>","author":"<a href=\"https://superuser.com/users/109090/dbenham\" target=\"_blank\" rel=\"nofollow noopener\">dbenham</a>"}]}]}
