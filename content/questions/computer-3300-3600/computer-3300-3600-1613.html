{"title":"Bagaimana cara menyisipkan baris di tengah file, dengan awk, diberi pola pencarian untuk disisipkan SETELAH atau SEBELUMNYA","draft":false,"url":"/bagaimana-cara-menyisipkan-baris-di-tengah-file-dengan-awk-diberi-pola-pencarian-untuk-disisipkan-setelah-atau-sebelumnya-wzzw53qd","votes":"4","answers_count":"3","categories":["Komputer"],"tags":["awk"],"snippet":"Saya ingin memasukkan beberapa teks di tengah file. Teks yang akan disisipkan berada setelah baris tertentu, katakanlah, &quot;&lt;begin&gt;&quot;. Saya tidak tahu nomor barisnya, saya juga tidak tahu jumlah baris dalam teks yang...","body":"<p> Saya ingin memasukkan beberapa teks di tengah file. Teks yang akan disisipkan berada setelah baris tertentu, katakanlah, &quot;<code>&lt;begin&gt;</code>&quot;. Saya tidak tahu nomor barisnya, saya juga tidak tahu jumlah baris dalam teks yang akan disisipkan. Saya hanya tahu bahwa setelah baris yang bertuliskan &quot;<code>&lt;begin&gt;</code>&quot; saya perlu memasukkan konten file lain. </p>\n\n<p> Saya hanya tidak tahu bagaimana menggunakan awk untuk melakukan sesuatu seperti ini. </p>\n\n<p> Terima kasih :-) </p>","source":"https://superuser.com/questions/209379/how-can-i-insert-a-line-in-the-middle-of-a-file-with-awk-given-a-search-patter","author":"<a href=\"https://superuser.com/users/7768/jfmessier\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">jfmessier</span></a>","replies":[],"answers":[{"answer":"<p> Buat file dengan kode berikut. Anda bisa menyimpannya sebagai: <br> insertfile.awk (atau apa pun yang Anda inginkan) </p> <pre><code>    BEGIN{\n        while ( (getline &lt; outerfile) &gt; 0 )\n        {\n            if ($0 == matchline) \n            {  \n                if (\"after\" == includematch)\n                {\n                    print\n                }\n                if (\"before\" == includematch)\n                {\n                    holdline = $0\n                }\n                  while ( (getline &lt; innerfile) &gt; 0) \n                {\n                    print\n                }\n                close(innerfile)\n                if (\"before\" == includematch)\n                {\n                     print holdline\n                     holdline = \"\"\n                }\n            }\n            else\n            {\n                print\n            }\n        }\n        close(outerfile)\n    }\n</code></pre> <p> Parameter baris perintah awk yang digunakan adalah: </p> <pre><code>-v outerfile=\"file1.txt\"    This is the name of the file you are searching (and printing).\n-v innerfile=\"file2.txt\"    This is the name of the file you will insert when you file a match\n-v matchline=\"Search Text\"  This is what you will search for as a line in file1.txt\n-v includematch=\"before\"    Optional: insert the file, before the matchline\n-v includematch=\"after\"     Optional: insert the file, after the matchline\n-v includematch=\"\"          If \"includematch\" is any other value, or empty, or not present, \n                            then insert the file, REPLACING matchline.\n-f \"insertfile.awk\"         This is the name of the awk command file.\n</code></pre> <p> Kemudian, untuk menggunakannya Anda memanggil awk seperti ini: </p> <pre><code>awk -v outerfile=\"file1.txt\" -v innerfile=\"file2.txt\" -v matchline=\"cat\" -f \"insertfile.awk\"  \n(Read and print \"file1.txt\".  Search for line containing only \"cat\". REPLACE \"cat\" lines with \"file2.txt\"  \n\nawk -v outerfile=\"file1.txt\" -v innerfile=\"file2.txt\" -v matchline=\"dog\" -v includematch=\"before\" -f \"insertfile.awk\"\n(Read and print \"file1.txt\".  Search for line containing only \"dog\". Insert \"file2.txt\" Before matched line.\n\nawk -v outerfile=\"file1.txt\" -v innerfile=\"file2.txt\" -v matchline=\"bird\" -v includematch=\"after\" -f \"insertfile.awk\"\n(Read and print \"file1.txt\".  Search for line containing only \"bird\". Insert \"file2.txt\" After matched line.\n</code></pre> <p> Di skrip awk, Anda dapat mengeditnya seperti ini: </p> <pre><code>Change $0 to $1 or $2 or other to match a specific word instead of the whole line.  \n\"hard-code\" the file-names instead of outerfile and innerfile if you wish.\n</code></pre> <p> Jika Anda ingin &quot;menyalurkan&quot; data input ke dalam skrip alih-alih mendapatkannya dari file, edit skrip insertfile.awk seperti ini: </p> <pre><code>        {\n            if ($0 == matchline) \n            {\n\n                if (\"after\" == includematch)\n                {\n                    print\n                }\n                if (\"before\" == includematch)\n                {\n                    holdline = $0\n                }\n\n                while ( (getline &lt; innerfile) &gt; 0) \n                {\n                    print\n                }\n                close(innerfile)\n\n                if (\"before\" == includematch)\n                {\n                     print holdline\n                     holdline = \"\"\n                }\n\n            }\n            else\n            {\n                print\n            }\n            close(outerfile)\n        }\n</code></pre> <p> Kemudian, untuk menggunakannya Anda memanggil awk seperti ini: </p> <pre><code>type \"somefile.txt\" | awk -v innerfile=\"file2.txt\" -v matchline=\"cat\" -f \"insertfile.awk\"  \n(Read and print STDIN.  Search for line containing only \"cat\". REPLACE \"cat\" lines with \"file2.txt\"  \n\ntype \"anyfile.txt\" | awk -v innerfile=\"file2.txt\" -v matchline=\"dog\" -v includematch=\"before\" -f \"insertfile.awk\"\n(Read and print STDIN.  Search for line containg only \"dog\". Insert \"file2.txt\" Before matched line.\n\ntype \"otherfile.txt\" | awk -v innerfile=\"file2.txt\" -v matchline=\"bird\" -v includematch=\"after\" -f \"insertfile.awk\"\n(Read and print STDIN.  Search for line containg only \"bird\". Insert \"file2.txt\" After matched line.\n</code></pre>","votes":"2","source":"https://superuser.com/a/502686","author":"<a href=\"https://superuser.com/users/144147/kevin-fegan\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Kevin Fegan</span></a>","replies":[]},{"answer":"<pre><code>/&lt;begin&gt;/{\n    insert_file(\"before_file.html\")\n    print $0\n    insert_file(\"after_file.html\")\n    next\n}\n{\n    print $0\n}\n</code></pre> <p> di mana Anda harus menulis fungsi <code>insert_file</code> yang mungkin terlihat seperti ini </p> <pre><code>function insert_file(file) {\n    while (getline line &lt;file)\n        print line\n    close(file)\n}\n</code></pre> <p><s> Perhatikan bahwa versi persis ini tampaknya tidak berfungsi seperti yang diharapkan di Mac saya ketika before_file dan after_file sama ... Saya hanya mendapatkan satu-satunya salinan pertama. Ini mungkin ada hubungannya dengan gagal menutup file. Saya akan menyelidiki. </s> Ya, itu perlu file <code>close</code>, dan itu harus dilakukan secara umum untuk praktik yang baik. </p>\n\n<hr>\n\n<p> Juga, saya pikir ini mungkin lebih mudah di <code>sed</code> ... </p>\n\n<p> Untuk memasukkan file <em> setelah </em> garis kunci </p> <pre><code>sed '/&lt;begin&gt;/r after_file.html' input_file\n</code></pre> <p> Memasukkan file sebelumnya sedikit lebih rumit, </p> <pre><code> sed -n -e '/^function/r before_file.html' -e 'x' -e 'p' input_file\n</code></pre> <p> sehingga Anda bisa menggunakan skrip seperti </p> <pre><code>/^function/r before_file.html\nx\np\n</code></pre> <p> dengan </p> <pre><code>sed -n -f script input_file\n</code></pre>","votes":"5","source":"https://superuser.com/a/209409","author":"<a href=\"https://superuser.com/users/1711/dmckee-ex-moderator-kitten\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">dmckee --- ex-moderator kitten</span></a>","replies":[{"reply":"Dengan skrip sed ini, Anda akan mengalami masalah dengan baris terakhir, yang tidak tercetak di ruang tunggu. Anda dapat memperbaikinya dengan menambahkan <code>-e &#39;${g;p}&#39;</code> akhir, atau dengan memastikan masukan Anda memiliki <code>\\n</code> tambahan di akhir.","author":"<a href=\"https://superuser.com/users/28187/dubiousjim\" target=\"_blank\" rel=\"nofollow noopener\">dubiousjim</a>"}]},{"answer":"<p> Perl adalah kakak laki-laki awk. </p> <pre><code>perl -p -i -e 'print \"some text\\n\" if /&lt;begin&gt;/' filename\n</code></pre> <p> Jika Anda memiliki beberapa &lt;begin&gt; maka itu perlu diubah. </p>\n\n<p> EDIT: Oh, Anda ingin memasukkan file </p> <pre><code>perl -MFile::Slurp -p -i -e 'print read_file(\"file2\") if /&lt;begin&gt;/' filename\n</code></pre> <p> (diuji OK, tetapi Anda mungkin perlu <code>cpan File::Slurp</code> terlebih dahulu.) </p>","votes":"2","source":"https://superuser.com/a/209499","author":"<a href=\"https://superuser.com/users/52492/redgrittybrick\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">RedGrittyBrick</span></a>","replies":[]}]}
