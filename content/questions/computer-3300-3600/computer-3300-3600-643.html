{"title":"Kecualikan subfolder dengan file tertentu di rekursif rm -rf / folder / *","draft":false,"url":"/kecualikan-subfolder-dengan-file-tertentu-di-rekursif-rm-rf-folder-ssefbm4m","votes":"4","answers_count":"3","categories":["Komputer"],"tags":["linux","bash"],"snippet":"Saya ingin tahu apakah mungkin untuk menentukan beberapa kondisi elegan (parameter mungkin?) Di rm -rf /folder/* untuk tidak menghapus subfoldernya, yang berisi file dengan nama &quot;dontshoot.txt&quot;.  Saya tidak dapat menemukannya sejauh ini....","body":"<p> Saya ingin tahu apakah mungkin untuk menentukan beberapa kondisi elegan (parameter mungkin?) Di <code>rm -rf /folder/*</code> untuk tidak menghapus subfoldernya, yang berisi file dengan nama &quot;dontshoot.txt&quot;. </p>\n\n<p> Saya tidak dapat menemukannya sejauh ini. </p>\n\n<p> Terima kasih sebelumnya atas bantuan Anda! </p>","source":"https://superuser.com/questions/607264/exclude-subfolders-with-specific-files-in-recursive-rm-rf-folder","author":"<a href=\"https://superuser.com/users/160336/mr-nothing\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">mr.nothing</span></a>","replies":[{"reply":"Sepengetahuan saya <code>rm</code> tidak dapat mengecualikan pola, Anda harus menulis fungsi atau skrip untuk melakukan ini.","author":"<a href=\"https://superuser.com/users/69555/cobra-fast\" target=\"_blank\" rel=\"nofollow noopener\">Cobra_Fast</a>"}],"answers":[{"answer":"<p> Anda cukup menggunakan <code>find</code> seperti ini </p> <pre><code>find some_folder ! -name dontshoot.txt -delete\n</code></pre> <p> Ini akan menghapus semua file dan folder secara rekursif kecuali file <code>dontshoot.txt</code>.\nSeperti dicatat di komentar lain, selalu membantu untuk mengujinya tanpa menghapus, yang bisa dilakukan seperti ini. </p> <pre><code>find some_folder ! -name dontshoot.txt \n</code></pre> <p> Namun ini akan mencantumkan semua folder, bahkan yang berisi <code>dontshoot.txt</code> tetapi tidak akan dihapus karena tidak akan kosong saat menggunakan <code>-delete</code>. </p>\n\n<p><strong> Edit: </strong></p>\n\n<p> Saya setuju bahwa interpretasi fedorqui atas pertanyaan ini lebih masuk akal daripada saya. Untuk hanya menghapus folder yang tidak berisi <code>dontshoot.txt</code> di suatu tempat jauh di dalam struktur pohon mereka, solusi yang sangat tidak efisien akan menjadi </p> <pre><code>find some_folder -type d -exec \\\n   sh -c \"find {} -name dontshoot.txt | grep -q '' || echo rm -fr {}\" \\;\n</code></pre> <p><strong> Penjelasan: </strong></p>\n\n<p> Perintah <code>find</code> luar melintasi secara rekursif melalui <code>some_folder</code> menemukan semua direktori (<code>-type d</code>) dan menjalankan (<code>-exec</code>) perintah shell yang diberikan sambil mengganti <code>{}</code> dengan jalur relatif ke direktori yang ditemukan. </p>\n\n<p> Perintah <code>find</code> di dalam shell mencari direktori yang ditemukan untuk <code>dontshoot.txt</code>. Jika tidak menemukan apa pun, tidak akan ada keluaran yang diteruskan ke <code>grep -q ''</code> yang karenanya akan mengembalikan <code>False</code> dan bagian terakhir akan dijalankan yang akan menghapus direktori penuh (yang tidak tentu saja tidak mengandung <code>dontshoot.txt</code>) secara rekursif. </p>\n\n<p> Singkatnya, ini melintasi semua direktori dan menghapus mereka yang tidak berisi <code>dontshoot.txt</code> di suatu tempat di dalamnya. </p>","votes":"7","source":"https://superuser.com/a/607267","author":"<a href=\"https://superuser.com/users/92475/buergi\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">buergi</span></a>","replies":[{"reply":"Saya punya satu keraguan: bagaimana jika kita memiliki folder t / dengan <code>dontshoot.txt</code> dan <code>otherfile.txt</code>? Saya pikir kode Anda akan menghapus <code>otherfile.txt</code>, meskipun saya rasa itu tidak harus didasarkan pada OP.","author":"<a href=\"https://superuser.com/users/204979/fedorqui\" target=\"_blank\" rel=\"nofollow noopener\">fedorqui</a>"},{"reply":"Ya, Anda benar, saya memperluas jawaban untuk interpretasi Anda yang lebih masuk akal atas pertanyaan itu.","author":"<a href=\"https://superuser.com/users/92475/buergi\" target=\"_blank\" rel=\"nofollow noopener\">buergi</a>"},{"reply":"Selamat, ini jawaban yang bagus!","author":"<a href=\"https://superuser.com/users/204979/fedorqui\" target=\"_blank\" rel=\"nofollow noopener\">fedorqui</a>"}]},{"answer":"<p> Tidak mungkin untuk mengecualikannya dalam perintah <code>rm</code>. </p>\n\n<p> Anda bisa melakukan sesuatu seperti ini: </p> <pre><code>for dir in /folder/*\ndo\n  echo $dir\n  if [ ! -f \"$dir/dontshoot.txt\" ]; then\n    rm -rf \"$dir\"\n   fi\ndone\n</code></pre> <h2 class=\"h4\"> Penting: </h2>\n\n<p> Periksa dengan <code>ls</code> bukan <code>rm</code> sebelum menjalankan. </p>","votes":"3","source":"https://superuser.com/a/607265","author":"<a href=\"https://superuser.com/users/204979/fedorqui\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">fedorqui</span></a>","replies":[{"reply":"Saya mendapat suara positif dan suara negatif pada saat yang sama!","author":"<a href=\"https://superuser.com/users/204979/fedorqui\" target=\"_blank\" rel=\"nofollow noopener\">fedorqui</a>"},{"reply":"Itu bukan aku, aku bersumpah! ; D Terima kasih atas balasannya, saya akan memeriksanya.","author":"<a href=\"https://superuser.com/users/160336/mr-nothing\" target=\"_blank\" rel=\"nofollow noopener\">mr.nothing</a>"},{"reply":"@ mr.nothing, selalu coba perintah Anda dengan <code>ls</code> sebelum menggunakannya dengan <code>rm</code>!","author":"<a href=\"https://superuser.com/users/204979/fedorqui\" target=\"_blank\" rel=\"nofollow noopener\">fedorqui</a>"},{"reply":"@edorin Mungkin solusi terbaik. Saya mencoba membuat sesuatu dengan <code>find</code>, tetapi saya rasa kondisi ini tidak dapat diselesaikan dengan itu.","author":"<a href=\"https://superuser.com/users/92891/glglgl\" target=\"_blank\" rel=\"nofollow noopener\">glglgl</a>"},{"reply":"@fedorqui, saya akan memasukkan kode ini ke skrip. Jadi tidak perlu mengeceknya secara manual.","author":"<a href=\"https://superuser.com/users/160336/mr-nothing\" target=\"_blank\" rel=\"nofollow noopener\">mr.nothing</a>"},{"reply":"@fedorqui, tidak bekerja untuk saya .. Kode ini meninggalkan dir tingkat atas tetapi menghapus yang itu, yang berisi file yang saya butuhkan.","author":"<a href=\"https://superuser.com/users/160336/mr-nothing\" target=\"_blank\" rel=\"nofollow noopener\">mr.nothing</a>"},{"reply":"Masalah dengan solusi ini adalah, itu tidak akan berfungsi secara rekursif. Namun pertanyaannya tidak menjelaskan apakah ini diinginkan atau tidak.","author":"<a href=\"https://superuser.com/users/92475/buergi\" target=\"_blank\" rel=\"nofollow noopener\">buergi</a>"},{"reply":"Maaf @ mr.tidak ada yang salah ketik dalam kode saya (nama variabel), dapatkah Anda memeriksa jawaban yang diperbarui? Saya memeriksanya sebelumnya dan bekerja untuk saya.","author":"<a href=\"https://superuser.com/users/204979/fedorqui\" target=\"_blank\" rel=\"nofollow noopener\">fedorqui</a>"}]},{"answer":"<p> Fungsi berikut bisa berfungsi, saya tidak punya waktu untuk mengujinya. </p> <pre><code>// $1 = directory to remove\n// $2 = exclude pattern\nfunction rmx()\n{\n    rm -f $(find $1 * | grep -v $2)\n}\n</code></pre> <p> Panggil seperti </p> <pre><code>rmx get/rid/of/this/ \".*?not-these-files.*?\"\n</code></pre> <p> Mungkin ini setidaknya bisa menjadi ide tentang salah satu cara untuk mendekati masalah ini ... </p>","votes":"1","source":"https://superuser.com/a/607266","author":"<a href=\"https://superuser.com/users/69555/cobra-fast\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Cobra_Fast</span></a>","replies":[{"reply":"<code>find</code> adalah cara yang benar, tetapi cara ini terlalu rumit, jauh lebih mudah untuk mengecualikan file dalam pencarian segera dan gunakan flag <code>-delete</code> find. Lihat jawaban saya untuk contoh lengkapnya.","author":"<a href=\"https://superuser.com/users/92475/buergi\" target=\"_blank\" rel=\"nofollow noopener\">buergi</a>"}]}]}
