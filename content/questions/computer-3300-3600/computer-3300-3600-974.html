{"title":"Contoh konfigurasi fail2ban untuk melarang server melakukan spamming pada server postfix saya?","draft":false,"url":"/contoh-konfigurasi-fail2ban-untuk-melarang-server-melakukan-spamming-pada-server-postfix-saya-uralzoco","votes":"4","answers_count":"2","categories":["Komputer"],"tags":["postfix"],"snippet":"Saya memiliki server email kecil di rumah dan aturan pemfilteran yang cukup ketat. Saya menggunakan logwatch dan dapat melihat bahwa 80 hingga 90% koneksi ditolak oleh aturan pemfilteran terbatas saya. Sebagian besar...","body":"<p> Saya memiliki server email kecil di rumah dan aturan pemfilteran yang cukup ketat. Saya menggunakan logwatch dan dapat melihat bahwa 80 hingga 90% koneksi ditolak oleh aturan pemfilteran terbatas saya. Sebagian besar hasil penolakan dari rbl_client. </p>\n\n<p> Saya putus asa mencari contoh file konfigurasi fail2ban yang menunjukkan cara memfilter IP yang melakukan spamming ke server saya. Saya berharap pemblokiran akan berlangsung lama (mis. 1 bulan). </p>\n\n<p> Saya juga mengalami upaya SYN flooding di server email saya yang saya blokir menggunakan aturan firewall yang ditetapkan secara manual. Bisakah fail2ban mendeteksi ini juga? </p>","source":"https://superuser.com/questions/576751/example-of-fail2ban-configuration-to-ban-servers-spamming-my-postfix-server","author":"<a href=\"https://superuser.com/users/15894/chmike\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">chmike</span></a>","replies":[{"reply":"Saya rasa itu bukan ide yang bagus. Saya akan terkejut jika sejumlah besar alamat tersebut digunakan kembali. Mengapa membuat lebih banyak aturan iptables sampah?","author":"<a href=\"https://superuser.com/users/192715/alex-p\" target=\"_blank\" rel=\"nofollow noopener\">Alex P.</a>"}],"answers":[{"answer":"<p> Saya baru saja bosan dengan semua spammer RBL yang mengisi log saya, jadi saya telah mengatur Postfix saya untuk melarang mereka. </p>\n\n<p> Setelah melakukannya, beban turun karena jumlahnya banyak! </p>\n\n<p> Ketahuilah bahwa Anda harus menerapkan beberapa cara untuk membersihkan daftar terlarang. </p>\n\n<p> Saya berencana untuk memulai kembali fail2ban setiap minggu. </p>\n\n<p> Lihat aturan ini: <a href=\"http://www.fail2ban.org/wiki/index.php/Postfix\" rel=\"nofollow noopener\" target=\"_blank\"> http://www.fail2ban.org/wiki/index.php/Postfix </a></p>\n\n<p> Tambahkan mereka di: /etc/fail2ban/filter.d/postfix.conf (itu ada di Sistem Debian!) </p>\n\n<p> Juga bagus untuk membaca ini (cari fail2ban): <a href=\"http://workaround.org/ispmail/squeeze/sysadmin-niceties\" rel=\"nofollow noopener\" target=\"_blank\"> http://workaround.org/ispmail/squeeze/sysadmin-niceties </a> (beberapa cuplikan dari sana). </p>\n\n<p> Pendeknya: </p>\n\n<ol>\n<li><p> Di set jail.conf: </p> <pre><code>[postfix]\nenabled  = true\n</code></pre> </li>\n<li><p> Baik untuk dilakukan jika Anda menggunakan dovecot (dari tautan di atas):\nBuat /etc/fail2ban/filter.d/dovecot-pop3imap.conf dan tambahkan: </p> <pre><code>[Definition]\nfailregex = (?: pop3-login|imap-login): .*(?:Authentication failure|Aborted login \\   (auth failed|Aborted login \\(tried to use disabled|Disconnected \\(auth failed).*rip=(?P&lt;host&gt;\\S*),.*\nignoreregex =\n</code></pre> </li>\n<li><p> Tambahkan bagian di jail.conf atau jail.local: </p> <pre><code>[dovecot-pop3imap]\nenabled = true\nport = pop3,pop3s,imap,imaps\nfilter = dovecot-pop3imap\nlogpath = /var/log/mail.log\n</code></pre> </li>\n<li><p> Mulai ulang fail2ban dan periksa iptables -nvL jika rantai untuk postfix dan kurir ditambahkan.\nHATI-HATI: Ini untuk sistem berbasis Debian. Periksa jalur file untuk RH atau lainnya. </p></li>\n</ol>","votes":"6","source":"https://superuser.com/a/600365","author":"<a href=\"https://superuser.com/users/217791/anton-valqk\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Anton Valqk</span></a>","replies":[{"reply":"Pengguna menyebutkan ini server email di rumah. Selama dovecot berada di belakang firewall router, tidak perlu pemeriksaan fail2ban untuk itu. Jika dia di luar itu lebih baik menggunakan VPN. Dia mungkin berarti koneksi SMTP mengirim spam.","author":"<a href=\"https://superuser.com/users/47628/bshea\" target=\"_blank\" rel=\"nofollow noopener\">bshea</a>"},{"reply":"Saya akan merekomendasikan Anda mengatur fail2ban untuk menggunakan ipset dan kemudian Anda dapat mengatur waktunya secara otomatis untuk Anda.","author":"<a href=\"https://superuser.com/users/213252/cybernard\" target=\"_blank\" rel=\"nofollow noopener\">cybernard</a>"}]},{"answer":"<p> Cara yang lebih baik adalah dengan menggunakan Postfix untuk memfilter IP menggunakan daftar blokir. </p>\n\n<p> Lihat <a href=\"http://www.postfix.org/postconf.5.html#smtpd_recipient_restrictions\" rel=\"nofollow noopener\" target=\"_blank\"> http://www.postfix.org/postconf.5.html#smtpd_recipient_restrictions </a> untuk menolak menggunakan daftar blokir. </p>\n\n<p> Jika Anda benar-benar ingin, Anda dapat menggunakan filter Fail2Ban seperti f2b-postfix-rbl ( <a href=\"https://github.com/fail2ban/fail2ban/blob/0.11/config/filter.d/postfix.conf\" rel=\"nofollow noopener\" target=\"_blank\"> postfix-rbl.conf </a> ) untuk memfilter log email untuk entri daftar blokir / daftar hitam. Ini kemudian akan memasukkan entri baru ke dalam iptables dan kami akan diblokir selama waktu larangan tertentu. </p>\n\n<p> Seperti yang disebutkan, ini mungkin tidak akan banyak membantu karena skrip / bot / mailer hanya akan berpindah setelah kegagalan pertama dan mencoba Anda lagi pada hari yang berbeda dari IP yang berbeda. <strong> Juga, ini mubazir karena Anda dapat memfilter menggunakan MTA seperti yang disebutkan di atas. </strong></p>\n\n<p> Berikut adalah contoh dari beberapa daftar blokir yang dapat Anda tambahkan di bawah postfix untuk memblokir IP yang masuk daftar hitam. <br></p>\n\n<p> /etc/main.cf: </p> <pre><code>smtpd_recipient_restrictions =\n    permit_mynetworks,\n    permit_sasl_authenticated,\n    reject_unauth_destination,\n    reject_unlisted_recipient,\n    reject_invalid_hostname,\n    reject_non_fqdn_sender,\n    reject_non_fqdn_recipient,\n    reject_unknown_sender_domain,\n    reject_unauth_pipelining,\n    check_client_access hash:/etc/postfix/blacklist,\n#Some DNS BL's - high availability:\n    reject_rbl_client zen.spamhaus.org,\n    reject_rbl_client bl.spamcop.net,\n    reject_rbl_client dul.dnsbl.sorbs.net,\n#Some country-wide IP blocks:\n    #reject_rbl_client cn.countries.nerd.dk,\n    #reject_rbl_client tw.countries.nerd.dk,\n    #reject_rbl_client lr.countries.nerd.dk,\n    #reject_rbl_client ng.countries.nerd.dk,\n    #reject_rbl_client ro.countries.nerd.dk,\n    #reject_rbl_client ua.countries.nerd.dk,\n    #reject_rbl_client kr.countries.nerd.dk,\n    #finalize and throw at postgrey if passes above:\n    #check_policy_service inet:[::1]:10023,\n    permit\n</code></pre> <p> Jika Anda bersikeras untuk memproses daftar blokir fail2ban, pastikan Anda mengaktifkannya di bawah /etc/failban/jail.local: </p> <pre><code>[postfix-rbl]\n\nenabled  = true\nport     = smtp,465,submission\nfilter   = postfix-rbl\nlogpath  = /var/log/mail.log\n</code></pre> <p> Untuk menggunakan rbl &quot;mode&quot; di bawah versi yang lebih baru, gantikan baris filter dengan: </p> <pre><code>filter    = postfix[mode=rbl]\n</code></pre> <p> Pada versi sebelumnya saya harus mengubah milik saya untuk mendeteksi &quot;554 5.7.1&quot; untuk mengambil log postfix yang ditolak melalui filter &quot;postifx-rbl&quot;. Versi filter yang lebih baru sepertinya memindai ini <a href=\"https://github.com/fail2ban/fail2ban/issues/1634\" rel=\"nofollow noopener\" target=\"_blank\"> perubahan </a> di bawah versi &quot;mode&quot; rbl yang lebih baru. </p>\n\n<p> Sejauh SYN flood - <a href=\"https://serverfault.com/a/640894/92023\" target=\"_blank\" rel=\"nofollow noopener\"> Lihat ini </a> . </p>","votes":"4","source":"https://superuser.com/a/1168969","author":"<a href=\"https://superuser.com/users/47628/bshea\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">bshea</span></a>","replies":[{"reply":"fail2ban dan blacklist seperti spamhaus melakukan dua fungsi berbeda. yang satu tidak lebih baik dari yang lain. fail2ban memonitor log Anda untuk pola penggunaan berbahaya. daftar hitam dikelola oleh otoritas pusat dan menyertakan pengirim spam menurut kiriman. keduanya merupakan alat yang berguna.","author":"<a href=\"https://superuser.com/users/164539/111\" target=\"_blank\" rel=\"nofollow noopener\">111</a>"}]}]}
