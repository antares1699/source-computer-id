{"title":"Kompleks filter eq FFmpeg: Kontras","draft":false,"url":"/kompleks-filter-eq-ffmpeg-kontras-wof5rc6m","votes":"4","answers_count":"3","categories":["Komputer"],"tags":["ffmpeg","colors","contrast"],"snippet":"Saya bermain dengan filter eq di FFmpeg:  https://ffmpeg.org/ffmpeg-filters.html#eq  Menggunakan perintah seperti:  ffmpeg -y -loop 1 -i input.jpg -filter_complex \"[0:v]eq=1:0:1:1:1:1:1:1[outv]\" -map [outv] -c:v libx264 -t 3 -pix_fmt yuv420p out.mp4 # does nothing  Dokumentasi...","body":"<p> Saya bermain dengan filter eq di FFmpeg: </p>\n\n<p><a href=\"https://ffmpeg.org/ffmpeg-filters.html#eq\" rel=\"nofollow noopener\" target=\"_blank\"> https://ffmpeg.org/ffmpeg-filters.html#eq </a></p>\n\n<p> Menggunakan perintah seperti: </p> <pre><code>ffmpeg -y -loop 1 -i input.jpg -filter_complex \"[0:v]eq=1:0:1:1:1:1:1:1[outv]\" -map [outv] -c:v libx264 -t 3 -pix_fmt yuv420p out.mp4 # does nothing\n</code></pre> <p> Dokumentasi menunjukkan bahwa komponen pertama dari filter adalah kontras: </p>\n\n<blockquote>\n  <p> Atur ekspresi kontras. Nilainya harus berupa nilai float dalam rentang -2.0 hingga 2.0. Nilai defaultnya adalah &quot;0&quot;. </p>\n</blockquote>\n\n<p> Namun, saya menemukan bahwa agar tidak terjadi perubahan kontras, nilainya harus &quot;1&quot;. Bukankah ini harus menjadi default? </p>\n\n<p> Pokoknya saya bingung kalau nilai pertama ini malah kontras. Itu tidak berperilaku seperti yang saya harapkan kontras. Saya membandingkannya dengan mis. css <code>-webkit-filter: contrast(x)</code>. Dalam CSS, <code>contrast(0)</code> membuat seluruh gambar menjadi abu-abu. Namun demikian, di FFmpeg, gambar tampak sebagian kuning dan sebagian abu-abu (mungkin tergantung pada gambar saya: </p>\n\n<p><a href=\"https://i.stack.imgur.com/ruzYZ.jpg\" rel=\"nofollow noopener\" target=\"_blank\"><img src=\"https://i.stack.imgur.com/ruzYZ.jpg\" alt=\"enter image description here\" class=\"img-fluid d-block my-2\" loading=\"lazy\"></a></p>\n\n<p> CSS <code>contrast(-1)</code> tidak valid. Namun, di FFmpeg, kontras -1 hampir merupakan kontras terbalik. Saya memahami bahwa kedua hal tersebut diterapkan sepenuhnya secara terpisah, tetapi saya mengharapkan perkiraan hubungan. Apakah saya salah memahami nilai kontras filter eq? </p>","source":"https://superuser.com/questions/928151/ffmpeg-eq-filter-complex-contrast","author":"<a href=\"https://superuser.com/users/448541/jon-g\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Jon G</span></a>","replies":[{"reply":"Mungkin ini membantu? <a href=\"https://github.com/FFmpeg/FFmpeg/blob/master/libavfilter/vf_eq.c#L77\" rel=\"nofollow noopener\" target=\"_blank\"> github.com/FFmpeg/FFmpeg/blob/master/libavfilter/vf_eq.c#L77 </a>","author":"<a href=\"https://superuser.com/users/48078/slhck\" target=\"_blank\" rel=\"nofollow noopener\">slhck</a>"}],"answers":[{"answer":"<p> Anda perlu menentukan opsi di filter berdasarkan nama, jadi setelan filter asli Anda perlu diubah menjadi ... </p> <pre><code>-filter_complex \"[0:v]eq=contrast=1:brightness=0:saturation=1:gamma=1:\ngamma_r=1:gamma_g=1:gamma_b=1:gamma_weight=1[outv]\"\n</code></pre> <p> ... jika Anda ingin mengatur semua parameter itu. Jika tidak, filter akan mengabaikan pengaturan Anda dan menerapkan nilai default, atau mungkin bisa salah menafsirkan nilai opsi yang dimaksudkan untuk yang lain (itu <em> seharusnya tidak </em> , tetapi hal-hal aneh telah terjadi dengan filter FFmpeg). </p>\n\n<p> Sejauh nilai yang dipilih vs. hasil akhir berjalan, kode slhck menunjukkan bahwa nilai yang ditetapkan per opsi dijalankan melalui serangkaian kalkulasi internal, kemudian hasilnya digunakan untuk mengevaluasi dan membuat penyesuaian tingkat piksel. Tampaknya penghitungan &quot;dasar&quot; untuk <code>contrast</code> adalah ... </p> <pre><code>(param-&gt;contrast * 256 * 16)\n</code></pre> <p> ... jadi nilai default <code>0</code> akan menghasilkan 0, nilai yang ditentukan <code>1</code> akan menghasilkan 4096, nilai <code>-0.00275</code> akan menghasilkan -11.264, dll, dan nilai dasar ini digunakan dalam penghitungan selanjutnya. Dengan kata lain, penanganan filter terhadap parameter ini adalah yang terbaik, jadi luangkan waktu untuk bermain-main dengannya untuk melihat cara kerjanya. Untuk mendapatkan gambaran yang benar tentang efeknya, Anda dapat men-tweak dan mensurvei output dari pengaturan <code>eq</code> menggunakan FFplay, mis .: </p> <pre><code>ffplay -i input.jpg -vf \"eq=contrast=1.5:brightness=-0.05:saturation=0.75\"\n</code></pre> <p> Sejauh skrip asli Anda berjalan, karena Anda hanya menggunakan satu input (jpeg Anda), satu filter (eq), dan semua opsi kecuali <code>contrast</code> membawa nilai default, Anda dapat mengurangi skrip ke yang berikut untuk mendapatkan 3- MP4 kedua, asalkan <code>eq=contrast=1</code> memberikan hasil yang diinginkan: </p> <pre><code>ffmpeg -y -loop 1 -i input.jpg -vf \"eq=contrast=1\" -c:v libx264 \\\n-pix_fmt yuv420p -t 3 out.mp4\n</code></pre> <p> pengungkapan penuh: posting diedit 2016/06/19 untuk klarifikasi lebih lanjut dan info diperpanjang </p>","votes":"6","source":"https://superuser.com/a/929836","author":"<a href=\"https://superuser.com/users/459654/mr-what\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Mr. What</span></a>","replies":[]},{"answer":"<p> Untuk menjawab pertanyaan asli Anda tentang kontras dalam FFmpeg vs. CSS, file <a href=\"https://github.com/FFmpeg/FFmpeg/blob/be37a669714094b9321f9f6f2947a296fe020483/libavfilter/vf_eq.c#L107-L155\" rel=\"nofollow noopener\" target=\"_blank\"> fragmen kode </a> di bawah ini sepertinya menyarankan bahwa <code>contrast</code> dalam FFmpeg hanya berlaku untuk luminansi / luma (kecerahan), sedangkan <code>saturation</code> hanya berlaku untuk chrominance / chroma (warna). </p> <pre class=\"lang-c prettyprint-override\"><code>static void set_contrast(EQContext *eq)\n{\n    eq-&gt;contrast = av_clipf(av_expr_eval(eq-&gt;contrast_pexpr, eq-&gt;var_values, eq), -1000.0, 1000.0);\n    eq-&gt;param[0].contrast = eq-&gt;contrast;\n    eq-&gt;param[0].lut_clean = 0;\n    check_values(&amp;eq-&gt;param[0], eq);\n}\n\n// ...\n\nstatic void set_saturation(EQContext *eq)\n{\n    int i;\n\n    eq-&gt;saturation = av_clipf(av_expr_eval(eq-&gt;saturation_pexpr, eq-&gt;var_values, eq), 0.0, 3.0);\n\n    for (i = 1; i &lt; 3; i++) {\n        eq-&gt;param[i].contrast = eq-&gt;saturation;\n        eq-&gt;param[i].lut_clean = 0;\n        check_values(&amp;eq-&gt;param[i], eq);\n    }\n}\n</code></pre> <p> Perhatikan bagaimana pada <code>set_contrast</code>, hanya <code>param[0]</code> (menunjukkan komponen warna pertama, yang dalam YUV adalah Y, luma) diubah, sedangkan pada <code>set_saturation</code> hanya <code>param[1]</code> dan <code>param[2]</code> (menunjukkan kuning dan magenta, kroma) yang diubah. Ini harus menjelaskan fakta bahwa Anda melihat kuning dan magenta, dua <em> chroma </em> komponen warna, saat Anda mengurangi kontras ke 0 di FFmpeg. Saat Anda menyetel saturasi ke 0 juga, saya melihat gambar abu-abu polos yang mirip dengan yang dihasilkan oleh CSS. </p>\n\n<p> Hubungan antara CSS <code>contrast</code> dan <code>saturate</code> versus FFmpeg <code>contrast</code> dan <code>saturation</code> dapat ditetapkan sebagai: </p>\n\n<blockquote>\n  <p> <code>filter: contrast(<i>c</i>) saturate(<i>s</i>);</code> </p>\n  \n  <p> setara dengan </p>\n  \n  <p> <code>eq=contrast=<i>c</i>:saturation=<i>c</i>*<i>s</i></code> </p>\n</blockquote>\n\n<p> Tangkapan layar wajib ditampilkan <em> c </em> = 0,6 dan <em> s </em> = 1,3: </p>\n\n<p><a href=\"https://i.stack.imgur.com/XyMX1.jpg\" rel=\"nofollow noopener\" target=\"_blank\"><img src=\"https://i.stack.imgur.com/XyMX1.jpg\" alt=\"CSS filter\" class=\"img-fluid d-block my-2\" loading=\"lazy\"></a>\n<a href=\"https://i.stack.imgur.com/QwDbL.jpg\" rel=\"nofollow noopener\" target=\"_blank\"><img src=\"https://i.stack.imgur.com/QwDbL.jpg\" alt=\"FFmpeg eq\" class=\"img-fluid d-block my-2\" loading=\"lazy\"></a></p>","votes":"3","source":"https://superuser.com/a/1131989","author":"<a href=\"https://superuser.com/users/232127/timothy-gu\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Timothy Gu</span></a>","replies":[{"reply":"Anehnya, setelah bermain dengan ini lebih lama, ketika kontras diatur ke 0 dengan FFMPEG, warna abu-abu yang saya dapatkan berbeda dari abu-abu yang saya dapatkan dengan CSS. Di CSS, saya mendapatkan # 808080 (abu-abu murni). Tetapi dengan ffmpeg, saya mendapatkan video dengan latar belakang # 898B89 saat kontras 0. Tahukah Anda mengapa ini mungkin terjadi?","author":"<a href=\"https://superuser.com/users/863762/justswim\" target=\"_blank\" rel=\"nofollow noopener\">justswim</a>"},{"reply":"Pada tangkapan layar Anda di atas, warna gambar sebenarnya sedikit hilang. Anda bisa melihatnya jika Anda melihat ke langit dan awan. Tampaknya ada hal lain yang berperan di sini .. apakah Anda punya ide untuk menyesuaikannya?","author":"<a href=\"https://superuser.com/users/863762/justswim\" target=\"_blank\" rel=\"nofollow noopener\">justswim</a>"}]},{"answer":"<p> Catatan: ada kesalahan dalam dokumen di sana <a href=\"https://ffmpeg.org/ffmpeg-filters.html#eq\" rel=\"nofollow noopener\" target=\"_blank\"> https://ffmpeg.org/ffmpeg-filters.html#eq </a></p>\n\n<p> Yang benar adalah:\nAtur ekspresi kontras. Nilainya harus berupa nilai float dalam rentang -1000.0 hingga 1000.0. Nilai defaultnya adalah &quot;1&quot;. </p>","votes":"0","source":"https://superuser.com/a/1480222","author":"<a href=\"https://superuser.com/users/1033761/%d0%92%d0%b0%d0%bb%d0%b5%d1%80%d0%b8%d0%b9-%d0%97%d0%b0%d0%bf%d0%be%d0%b4%d0%be%d0%b2%d0%bd%d0%b8%d0%ba%d0%be%d0%b2\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Валерий Заподовников</span></a>","replies":[]}]}
