{"title":"ffmpeg: Buffer queue overflow error muncul saat menambahkan audio dengan amix ke overlay video yang difilter","draft":false,"url":"/ffmpeg-buffer-queue-overflow-error-muncul-saat-menambahkan-audio-dengan-amix-ke-overlay-video-yang-difilter-anft00gy","votes":"4","answers_count":"1","categories":["Komputer"],"tags":["audio","video","ffmpeg","overlay"],"snippet":"Saya mencoba menggunakan ffmpeg untuk menggabungkan beberapa file video pada waktu mulai yang berbeda menggunakan filter overlay.  Ketika saya melakukannya tanpa audio apa pun, hasil yang dihasilkan benar.  Saat saya menambahkan elemen...","body":"<p> Saya mencoba menggunakan ffmpeg untuk menggabungkan beberapa file video pada waktu mulai yang berbeda menggunakan filter overlay. </p>\n\n<p> Ketika saya melakukannya tanpa audio apa pun, hasil yang dihasilkan benar. </p>\n\n<p> Saat saya menambahkan elemen filter audio dengan amix untuk menyertakan audio dari berbagai video yang di-overlay, ffmpeg mulai mengeluarkan kesalahan semacam ini: </p> <pre><code>[Parsed_overlay_4 @ 0x305ec40] [framesync @ 0x305ed68] Buffer queue overflow, dropping.\n</code></pre> <p> Bantuan apa pun dalam menghindari hal ini, atau cara alternatif untuk: </p>\n\n<ul>\n<li> Menggabungkan beberapa klip video </li>\n<li> Mengatur waktu mulai setiap klip video </li>\n<li> Memiliki audio untuk setiap pemutaran klip selaras dengan video yang sesuai </li>\n</ul>\n\n<p> akan sangat dihargai. </p>\n\n<p> Saya sudah mencoba banyak kombinasi setpts / asetpts / amerge / pan dan tidak bisa berfungsi. </p>\n\n<p> Berikut adalah baris perintah dan keluaran ffmpeg saya untuk kasus yang menyebabkan kesalahan (klausa if di overlay y = menyebabkan klip yang di-overlay menggulir video saat diputar): </p> <pre><code>ffmpeg -y \\\n -i /wintmp/vid/butterfly_base.mp4 \\\n -i /wintmp/vid/party_overlay.mp4 \\\n -i /wintmp/vid/car_overlay.mp4 \\\n -pix_fmt yuv420p -r 30000/1001 -filter_complex \" [1:v] setpts=PTS-STARTPTS+2/TB [v1] ; [0:v] [v1] overlay=x=50:y='if( gte(t,2), H-(t-2)*128, NAN)' [o1] ; [2:v] setpts=PTS-STARTPTS+3/TB,scale=width=320:height=240 [v2] ; [o1] [v2]  overlay=x=100:y='if( gte(t,3), H-(t-3)*102.4, NAN)' [outv] ; [1:a] adelay=2000|2000 [a1] ; [2:a] adelay=3000|3000 [a2] ; [0:a] [a1] [a2] amix=inputs=3:duration=longest [outa] \" -map \"[outv]\" -map \"[outa]\" /wintmp/vid/combined.mp4\nffmpeg version N-81978-g03d6d5f Copyright (c) 2000-2016 the FFmpeg developers\n  built with gcc 4.8 (Ubuntu 4.8.4-2ubuntu1~14.04.3)\n  configuration: --enable-gpl --enable-libx264 --enable-nonfree --enable-libfdk-aac\n  libavutil      55. 32.100 / 55. 32.100\n  libavcodec     57. 61.102 / 57. 61.102\n  libavformat    57. 51.107 / 57. 51.107\n  libavdevice    57.  0.102 / 57.  0.102\n  libavfilter     6. 63.100 /  6. 63.100\n  libswscale      4.  1.100 /  4.  1.100\n  libswresample   2.  2.100 /  2.  2.100\n  libpostproc    54.  0.100 / 54.  0.100\nInput #0, mov,mp4,m4a,3gp,3g2,mj2, from '/wintmp/vid/butterfly_base.mp4':\n  Metadata:\n    major_brand     : isom\n    minor_version   : 512\n    compatible_brands: isomiso2avc1mp41\n    encoder         : Lavf55.48.100\n  Duration: 00:00:08.01, start: 0.000000, bitrate: 550 kb/s\n    Stream #0:0(und): Video: h264 (High) (avc1 / 0x31637661), yuv420p, 480x272 [SAR 1:1 DAR 30:17], 412 kb/s, 29.97 fps, 29.97 tbr, 30k tbn, 59.94 tbc (default)\n    Metadata:\n      handler_name    : VideoHandler\n    Stream #0:1(und): Audio: aac (LC) (mp4a / 0x6134706D), 44100 Hz, stereo, fltp, 127 kb/s (default)\n    Metadata:\n      handler_name    : SoundHandler\nInput #1, mov,mp4,m4a,3gp,3g2,mj2, from '/wintmp/vid/party_overlay.mp4':\n  Metadata:\n    major_brand     : isom\n    minor_version   : 512\n    compatible_brands: isomiso2avc1mp41\n    title           : Teenage Fun, 1949 Style - http://www.archive.org/details/CEP503\n    date            : 1949\n    encoder         : Lavf55.48.100\n    comment         : license:  http://creativecommons.org/licenses/publicdomain/\n  Duration: 00:00:04.02, start: 0.000000, bitrate: 587 kb/s\n    Stream #1:0(und): Video: h264 (High) (avc1 / 0x31637661), yuv420p, 320x240 [SAR 1:1 DAR 4:3], 476 kb/s, 29.97 fps, 29.97 tbr, 30k tbn, 59.94 tbc (default)\n    Metadata:\n      handler_name    : VideoHandler\n    Stream #1:1(und): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, stereo, fltp, 101 kb/s (default)\n    Metadata:\n      handler_name    : SoundHandler\nInput #2, mov,mp4,m4a,3gp,3g2,mj2, from '/wintmp/vid/car_overlay.mp4':\n  Metadata:\n    major_brand     : isom\n    minor_version   : 512\n    compatible_brands: isomiso2avc1mp41\n    encoder         : Lavf55.48.100\n  Duration: 00:00:05.09, start: 0.000000, bitrate: 951 kb/s\n    Stream #2:0(und): Audio: aac (LC) (mp4a / 0x6134706D), 44100 Hz, stereo, fltp, 94 kb/s (default)\n    Metadata:\n      handler_name    : SoundHandler\n    Stream #2:1(und): Video: h264 (High) (avc1 / 0x31637661), yuv420p, 640x480 [SAR 1:1 DAR 4:3], 854 kb/s, 29.97 fps, 29.97 tbr, 30k tbn, 59.94 tbc (default)\n    Metadata:\n      handler_name    : VideoHandler\n[libx264 @ 0x3066780] using SAR=1/1\n[libx264 @ 0x3066780] using cpu capabilities: MMX2 SSE2Fast SSSE3 SSE4.2 AVX AVX2 FMA3 LZCNT BMI2\n[libx264 @ 0x3066780] profile High, level 2.1\n[libx264 @ 0x3066780] 264 - core 142 - H.264/MPEG-4 AVC codec - Copyleft 2003-2014 - http://www.videolan.org/x264.html - options: cabac=1 ref=3 deblock=1:0:0 analyse=0x3:0x113 me=hex subme=7 psy=1 psy_rd=1.00:0.00 mixed_ref=1 me_range=16 chroma_me=1 trellis=1 8x8dct=1 cqm=0 deadzone=21,11 fast_pskip=1 chroma_qp_offset=-2 threads=12 lookahead_threads=2 sliced_threads=0 nr=0 decimate=1 interlaced=0 bluray_compat=0 constrained_intra=0 bframes=3 b_pyramid=2 b_adapt=1 b_bias=0 direct=1 weightb=1 open_gop=0 weightp=2 keyint=250 keyint_min=25 scenecut=40 intra_refresh=0 rc_lookahead=40 rc=crf mbtree=1 crf=23.0 qcomp=0.60 qpmin=0 qpmax=69 qpstep=4 ip_ratio=1.40 aq=1:1.00\nOutput #0, mp4, to '/wintmp/vid/combined.mp4':\n  Metadata:\n    major_brand     : isom\n    minor_version   : 512\n    compatible_brands: isomiso2avc1mp41\n    encoder         : Lavf57.51.107\n    Stream #0:0: Video: h264 (libx264) ([33][0][0][0] / 0x0021), yuv420p, 480x272 [SAR 1:1 DAR 30:17], q=-1--1, 29.97 fps, 30k tbn, 29.97 tbc (default)\n    Metadata:\n      encoder         : Lavc57.61.102 libx264\n    Side data:\n      cpb: bitrate max/min/avg: 0/0/0 buffer size: 0 vbv_delay: -1\n    Stream #0:1: Audio: aac (LC) ([64][0][0][0] / 0x0040), 44100 Hz, stereo, fltp, 128 kb/s (default)\n    Metadata:\n      encoder         : Lavc57.61.102 aac\nStream mapping:\n  Stream #0:0 (h264) -&gt; overlay:main\n  Stream #0:1 (aac) -&gt; amix:input0\n  Stream #1:0 (h264) -&gt; setpts\n  Stream #1:1 (aac) -&gt; adelay\n  Stream #2:0 (aac) -&gt; adelay\n  Stream #2:1 (h264) -&gt; setpts\n  overlay -&gt; Stream #0:0 (libx264)\n  amix -&gt; Stream #0:1 (aac)\nPress [q] to stop, [?] for help\n[Parsed_overlay_4 @ 0x305ec40] [framesync @ 0x305ed68] Buffer queue overflow, dropping.\n    Last message repeated 15 times\nframe=  241 fps=0.0 q=-1.0 Lsize=     608kB time=00:00:08.10 bitrate= 614.6kbits/s speed=9.07x    \nvideo:472kB audio:126kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 1.638017%\n[libx264 @ 0x3066780] frame I:1     Avg QP:24.29  size: 24368\n[libx264 @ 0x3066780] frame P:117   Avg QP:24.94  size:  3290\n[libx264 @ 0x3066780] frame B:123   Avg QP:31.72  size:   599\n[libx264 @ 0x3066780] consecutive B-frames:  6.2% 72.2% 14.9%  6.6%\n[libx264 @ 0x3066780] mb I  I16..4:  0.0% 39.4% 60.6%\n[libx264 @ 0x3066780] mb P  I16..4:  0.1%  1.4%  1.1%  P16..4: 32.1% 19.9% 14.0%  0.0%  0.0%    skip:31.4%\n[libx264 @ 0x3066780] mb B  I16..4:  0.0%  0.3%  0.2%  B16..8: 27.4%  4.9%  1.2%  direct: 1.3%  skip:64.7%  L0:35.2% L1:57.1% BI: 7.8%\n[libx264 @ 0x3066780] 8x8 transform intra:52.0% inter:52.6%\n[libx264 @ 0x3066780] coded y,uvDC,uvAC intra: 89.9% 91.2% 74.9% inter: 15.6% 15.7% 3.1%\n[libx264 @ 0x3066780] i16 v,h,dc,p: 29% 33% 11% 27%\n[libx264 @ 0x3066780] i8 v,h,dc,ddl,ddr,vr,hd,vl,hu: 19% 12% 12%  7%  9% 12%  8% 12% 11%\n[libx264 @ 0x3066780] i4 v,h,dc,ddl,ddr,vr,hd,vl,hu: 21% 15% 12%  7% 10% 12%  7% 10%  7%\n[libx264 @ 0x3066780] i8c dc,h,v,p: 44% 22% 23% 11%\n[libx264 @ 0x3066780] Weighted P-Frames: Y:0.0% UV:0.0%\n[libx264 @ 0x3066780] ref P L0: 73.2% 15.2%  7.9%  3.7%\n[libx264 @ 0x3066780] ref B L0: 90.6%  9.0%  0.4%\n[libx264 @ 0x3066780] ref B L1: 98.2%  1.8%\n[libx264 @ 0x3066780] kb/s:480.51\n[aac @ 0x3068d40] Qavg: 515.774\n</code></pre> <p> Berikut adalah video masukan sumber: </p>\n\n<ul>\n<li> butterfly_base.mp4 - <a href=\"https://drive.google.com/file/d/0B56RokrDs3xaa2pIR1A4alFyLTg/view?usp=sharing\" rel=\"nofollow noopener\" target=\"_blank\"> https://drive.google.com/file/d/0B56RokrDs3xaa2pIR1A4alFyLTg/view?usp=sharing </a></li>\n<li> party_overlay.mp4 - <a href=\"https://drive.google.com/file/d/0B56RokrDs3xabThYR1lDamtRVm8/view?usp=sharing\" rel=\"nofollow noopener\" target=\"_blank\"> https://drive.google.com/file/d/0B56RokrDs3xabThYR1lDamtRVm8/view?usp=sharing </a></li>\n<li> car_overlay.mp4 - <a href=\"https://drive.google.com/file/d/0B56RokrDs3xaUkVXNGdlMzF5a3c/view?usp=sharing\" rel=\"nofollow noopener\" target=\"_blank\"> https://drive.google.com/file/d/0B56RokrDs3xaUkVXNGdlMzF5a3c/view?usp=sharing </a></li>\n</ul>\n\n<p> Berikut adalah video keluaran, di mana Anda dapat melihat bingkai yang dijatuhkan di video mobil yang dilapisi, di mana mobil dalam video berhenti berputar selama pemutaran: </p>\n\n<ul>\n<li> gabungan.mp4 - <a href=\"https://drive.google.com/file/d/0B56RokrDs3xaVk1KTzhSZ2c2RVU/view?usp=sharing\" rel=\"nofollow noopener\" target=\"_blank\"> https://drive.google.com/file/d/0B56RokrDs3xaVk1KTzhSZ2c2RVU/view?usp=sharing </a></li>\n</ul>\n\n<p> Jika saya menghapus semua audio seluruhnya dengan menjalankan ini: </p> <pre><code>ffmpeg -y \\\n-i /wintmp/vid/butterfly_base.mp4 \\\n-i /wintmp/vid/party_overlay.mp4 \\\n-i /wintmp/vid/car_overlay.mp4 \\\n-pix_fmt yuv420p -r 30000/1001 -an -filter_complex \" [1:v] setpts=PTS-STARTPTS+2/TB [v1] ; [0:v] [v1] overlay=x=50:y='if( gte(t,2), H-(t-2)*128, NAN)' [o1] ; [2:v] setpts=PTS-STARTPTS+3/TB,scale=width=320:height=240 [v2] ; [o1] [v2]  overlay=x=100:y='if( gte(t,3), H-(t-3)*102.4, NAN)' [outv] \" -map \"[outv]\" /wintmp/vid/combined_no_audio.mp4\n</code></pre> <p> Versi tanpa audio ini tidak menyebabkan kesalahan dan membuat video dengan benar: <a href=\"https://drive.google.com/file/d/0B56RokrDs3xaTmh0YkpmaGt0aUk/view?usp=sharing\" rel=\"nofollow noopener\" target=\"_blank\"> https://drive.google.com/file/d/0B56RokrDs3xaTmh0YkpmaGt0aUk/view?usp=sharing </a></p>\n\n<p> Masalahnya juga tampaknya terkait dengan jumlah overlay. Jika saya hanya melakukan satu overlay, masalahnya tidak terjadi. </p>","source":"https://superuser.com/questions/1135095/ffmpeg-buffer-queue-overflow-error-appears-when-adding-audio-with-amix-to-overl","author":"<a href=\"https://superuser.com/users/360788/deadcode\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">deadcode</span></a>","replies":[],"answers":[{"answer":"<p> Cacat ini telah dilaporkan <a href=\"https://trac.ffmpeg.org/ticket/4950\" rel=\"nofollow noopener\" target=\"_blank\"> sini </a> sebelumnya, tetapi belum terpecahkan. </p>\n\n<p> Ini masalah terkait buffer dan menggunakan filter <code>fifo</code>, <code>afifo</code> dapat membantu. Mencoba: </p> <pre><code>ffmpeg -y -i butterfly_base.mp4 -i party_overlay.mp4 -i car_overlay.mp4 -pix_fmt yuv420p -r 30000/1001 -filter_complex \" [1:v]fifo, setpts=PTS-STARTPTS+2/TB [v1] ; [0:v]fifo[v0buf];[v0buf][v1] overlay=x=50:y='if( gte(t,2), H-(t-2)*128, NAN)' [o1] ; [2:v]fifo, setpts=PTS-STARTPTS+3/TB,scale=width=320:height=240 [v2] ; [o1] [v2]  overlay=x=100:y='if( gte(t,3), H-(t-3)*102.4, NAN)' [outv] ; [1:a]afifo, adelay=2000|2000 [a1] ; [2:a]afifo, adelay=3000|3000 [a2] ; [0:a]afifo[a0buf];[a0buf] [a1] [a2] amix=inputs=3:duration=longest [outa] \" -map \"[outv]\" -map \"[outa]\" combined.mp4\n</code></pre>","votes":"6","source":"https://superuser.com/a/1135202","author":"<a href=\"https://superuser.com/users/647722/behroozfar\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Behroozfar</span></a>","replies":[]}]}
