{"title":"Apache melayani file dari cabang git repo","draft":false,"url":"/apache-melayani-file-dari-cabang-git-repo-an4ljpne","votes":"4","answers_count":"3","categories":["Komputer"],"tags":["apache-http-server","git"],"snippet":"Apakah ada cara untuk melayani file dari cabang dalam repo git tanpa memeriksanya ke direktori yang berbeda?  Saya ingin kemudahan untuk dapat membuat cabang baru, mendorongnya ke repo server pengujian dan kemudian...","body":"<p> Apakah ada cara untuk melayani file dari cabang dalam repo git tanpa memeriksanya ke direktori yang berbeda? </p>\n\n<p> Saya ingin kemudahan untuk dapat membuat cabang baru, mendorongnya ke repo server pengujian dan kemudian melakukan sesuatu seperti menelusuri http: // <em> nama cabang </em> .test.com. Saya dapat menggunakan aturan penulisan ulang untuk menangani subdomain nama cabang agar mengarah ke jalur root yang berbeda tetapi tentu saja Apache tidak dapat membaca repo kosong. </p>\n\n<p><a href=\"http://www.sfgoth.com/~mitch/linux/gitfs/\" rel=\"nofollow noopener\" target=\"_blank\"> gitfs </a> mungkin berhasil, tetapi tampaknya ditinggalkan. </p>\n\n<p> Saya juga tidak terlalu membutuhkan Apache. </p>","source":"https://superuser.com/questions/103516/apache-serve-files-from-git-repo-branches","author":"<a href=\"https://superuser.com/users/7978/van-gale\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Van Gale</span></a>","replies":[{"reply":"Dimungkinkan untuk membaca &#39;blob&#39;s out of a repository&#39; tanpa memiliki pohon yang berfungsi (checkout). Alat seperti gitweb <a href=\"http://git.wiki.kernel.org/index.php/Gitweb\" rel=\"nofollow noopener\" target=\"_blank\"> git.wiki.kernel.org/index.php/Gitweb </a> melayani terutama dari repositori telanjang. Mungkin gitweb dan sejenisnya menawarkan lebih dari yang Anda inginkan, tetapi mungkin Anda dapat menghapus satu untuk hanya menyajikan file kosong ( <a href=\"http://git.kernel.org/?p=git/git.git;a=blob_plain;f=README\" rel=\"nofollow noopener\" target=\"_blank\"> git.kernel.org/?p=git/git.git;a=blob_plain;f=README </a> ) dengan cara yang memungkinkan tautan relatif berfungsi.","author":"<a href=\"https://superuser.com/users/14827/chris-johnsen\" target=\"_blank\" rel=\"nofollow noopener\">Chris Johnsen</a>"},{"reply":"Ide yang menarik, tapi mungkin terlalu banyak kerja atm. Saya mencoba untuk menguji cabang aplikasi Django, jadi Python harus bisa mengimpor modul dari repo, dll.","author":"<a href=\"https://superuser.com/users/7978/van-gale\" target=\"_blank\" rel=\"nofollow noopener\">Van Gale</a>"},{"reply":"Kecuali dalam skenario paling dasar (konten statis), menyajikan konten umum dengan server web tidak memerlukan file sebenarnya. Jika yang Anda inginkan adalah cara menyediakan akses normal ke file di repositori Git tanpa benar-benar membuat file nyata (sistem file virtual; versi gitfs yang diperbarui / dipelihara / berfungsi), Anda mungkin harus mengabaikan semua penyebutan Apache, URL, dll.","author":"<a href=\"https://superuser.com/users/14827/chris-johnsen\" target=\"_blank\" rel=\"nofollow noopener\">Chris Johnsen</a>"}],"answers":[{"answer":"<p> Pendekatan paling sederhana akan memeriksa setiap cabang dan membuat klon untuk setiap cabang di subdirektori. Sangat mudah untuk melakukannya dengan skrip yang dijalankan oleh cron (atau dalam hook pasca-komit) seperti: </p> <pre><code>#!/bin/sh\nROOT=/srv/repos/control\ncd ${ROOT} # it's an internal repo\ngit fetch\nfor ref in .git/refs/remotes/origin/*; do\n  BRANCH=`basename ${ref}`\n  if ! [ -d ../${BRANCH} ]; then\n    git clone --local ${ROOT} ../${BRANCH}\n    cd ../${BRANCH}\n    git branch --track ${BRANCH} remotes/origin/${BRANCH}\n    git checkout ${BRANCH}\n  else\n    cd ../${BRANCH}\n    git pull\n  fi\ndone\n</code></pre> <p> Setelah berhasil, Anda akan mendapatkan banyak direktori dengan cabang di <code>/srv/repos</code>. </p>\n\n<p> <code>git clone --local</code> sangat cepat dan optimal bahkan pada repositori besar seperti kernel Linux karena tidak membuat semua objek dalam repositori melainkan membuat tautan keras ke sana, jadi Anda tidak akan menyia-nyiakan ruang apa pun pada salinan repositori. Anda akan, melalui, membuang-buang ruang pada salinan yang telah diperiksa, tetapi a) salinan tersebut mungkin tidak terlalu besar dan b) ini akan membuat akses berbasis web jauh lebih mudah dan lebih cepat. </p>","votes":"3","source":"https://superuser.com/a/103527","author":"<a href=\"https://superuser.com/users/25472/whitequark\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">whitequark</span></a>","replies":[{"reply":"Terima kasih, ini terlihat masuk akal untuk diterapkan. Semoga saya dapat menemukan waktu di minggu depan untuk mencobanya :)","author":"<a href=\"https://superuser.com/users/7978/van-gale\" target=\"_blank\" rel=\"nofollow noopener\">Van Gale</a>"}]},{"answer":"<p> Anda dapat menyajikan konten langsung dari repositori menggunakan kombinasi git-show (atau git cat-file) dan Apache CGI atau yang serupa. Saya telah menyiapkan contoh menggunakan .htaccess dan skrip zsh sederhana, sebagai berikut: </p>\n\n<p> .htaccess </p> <pre><code>Options +ExecCGI\nAddHandler cgi-script .sh\n\nRewriteEngine On\nRewriteRule ^(?!index.sh)(.*)$ /index.sh [L]\n</code></pre> <p> index.sh </p> <pre><code>#!/bin/zsh\n\n# Strips the initial slash, as git show ain't got time for that!\n# REQUEST_URI is set by Apache when executing the script.\n# You may also be interested in HTTP_HOST which is the request host.\n# Don't get confused with HOST which is a default shell variable.\nfunction get_request_uri {\n    if [ $REQUEST_URI[0,1] = '/' ]\n    then\n        REQUEST_URI=$REQUEST_URI:s#/##\n    fi\n\n    echo $REQUEST_URI\n}\n\n# You may not want to show the folders (represented by trees).\n# Or you may want to manipulate the output to produce a proper directory index.\nfunction is_file_folder {\n    [ $(git cat-file -t HEAD:$1) = 'tree' ]\n}\n\n# Just gets the content of the file.\n# For trees will produce a directory listing, one line per file.\n# To show different branches, pass them to git show in place of HEAD\nfunction get_file_content {\n    local file=$1\n\n    git show HEAD:${file}\n}\n\n# Attempts to determine the file type without writing the data to a file.\n# Has to resort to manually looking up the type in /usr/share/mime/globs\n# to test by extension, you may have to adjust that code to your environment.\nfunction get_file_type {\n    local file=$1\n    local content=$2\n\n    mime_type=$(echo ${content} | mimetype -b --stdin)\n    if [ -e /usr/share/mime/globs ]\n    then\n        file_mime_type=$(\n            grep \"\\*.${file:e}\\$\" /usr/share/mime/globs |\n                sed -ne 's/:.*$//' -e '1p'\n                    )\n\n        # Conflict resolution is also something you should work on.\n        if [ $file_mime_type != '' ]\n        then\n            mime_type=$file_mime_type\n        fi\n    fi\n\n    echo $mime_type\n}\n\nfunction do_404 {\n    echo 'Status: 404 Not Found'\n    echo ''\n}\n\n# Just does the header because there can be problems\n# getting binary data to the client by echoing it.\n# A little something for you to explore a fix for :)\nfunction do_200 {\n    mime_type=$1\n\n    echo \"Content-Type: $mime_type\"\n    echo ''\n}\n\n\ncd site.git\n\nuri=$(get_request_uri)\nfile_content=$(get_file_content $uri)\n\n# A non zero exit status from git show probably means the file does not exist.\n# Even if the error was something else, you still have nothing to show for it.\nif [ $? -ne 0 ]\nthen\n    do_404\nfi\n\n# You may not want to do the directory listing. Even if you do, you may\n# not want to use the default directory listing (which is very primitive).\n# If you wanted to redirect to index or similar, you would also handle that\n# here.\nif is_file_folder $uri\nthen\n    file_type='text/plain'\nelse\n    file_type=$(get_file_type $uri \"$file_content\")\nfi\n\ndo_200 $file_type\n\n# Doing this twice is not optimal, but it is very easy to\n# mangle binary data accidentally when passing around the\n# $file_content. Just reading the file directly to the client\n# seems to sidestep this. Another thing for you to fix :)\nget_file_content $uri\n\n# You might want to uncomment the two lines below (commenting out \n# any response code from above first), to show all of the variables\n# available to you. This list will include the variables set by this\n# script - to filter them out just run this earlier, with an exit after.\n\n# do_200 'text/plain'\n# set\n\n# vim: set ai et sw=4 syntax=zsh :\n</code></pre> <p> Ini mengasumsikan bahwa situs Anda ada di site.git dalam folder yang sama dengan dua file di atas. Ada banyak perbaikan yang dapat dilakukan pada skrip - seperti yang dikomentari. Ini lebih merupakan bukti konsep. </p>","votes":"3","source":"https://superuser.com/a/543890","author":"<a href=\"https://superuser.com/users/193949/matthew-franglen\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Matthew Franglen</span></a>","replies":[]},{"answer":"<p> Lihat juga <a href=\"http://cosmos.layervault.com/divergence.html\" rel=\"nofollow noopener\" target=\"_blank\"> Perbedaan </a> , aplikasi rak yang memetakan cabang git ke subdomain. Saya belum pernah menggunakannya sendiri, tetapi tampaknya cukup sesuai dengan kebutuhan Anda. </p>","votes":"1","source":"https://superuser.com/a/546591","author":"<a href=\"https://superuser.com/users/195512/tfischbach\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">tfischbach</span></a>","replies":[]}]}
