{"title":"Ubah kepemilikan file selama operasi tulis","draft":false,"url":"/ubah-kepemilikan-file-selama-operasi-tulis-awmoky5i","votes":"4","answers_count":"3","categories":["Komputer"],"tags":["linux","permissions"],"snippet":"Secara default umask adalah 0022:  usera@cmp$ touch somefile; ls -ltotal 0-rw-r--r-- 1 usera usera 0 2009-09-22 22:30 somefile  Direktori /home/shared/ dimaksudkan untuk file bersama dan harus dimiliki oleh grup root...","body":"<p> Secara default umask adalah 0022: </p> <pre><code>usera@cmp$ touch somefile; ls -l\ntotal 0\n-rw-r--r-- 1 usera usera 0 2009-09-22 22:30 somefile\n</code></pre> <p> Direktori <code>/home/shared/</code> dimaksudkan untuk file bersama dan harus dimiliki oleh grup <code>root</code> dan <code>shared</code>. File dibuat di sini oleh <code>user</code> <strong> n </strong> (setiap pengguna) secara otomatis dimiliki oleh grup <code>shared</code>. Ada tugas cron yang menangani perubahan pengguna yang memiliki dan memiliki grup (dari file yang dipindahkan) sekali sehari: </p> <pre><code>usera@cmp$ cat /etc/cron.daily/sharedscript\n\n#!/bin/bash\n\nchown -R root:shared /home/shared/\nchmod -R 770 /home/shared/\n</code></pre> <p> Saya sedang menulis <em> sangat besar </em> file ke direktori bersama. Itu membuat saya (<code>usera</code>) sebagai pengguna yang memiliki dan grup <code>shared</code> sebagai pemilik grup. Selama operasi tulis, tugas cron dijalankan, dan saya masih tidak mengalami masalah dalam menyelesaikan proses tulis. </p>\n\n<p> Kamu melihat. Saya pikir ini akan terjadi: </p>\n\n<ol>\n<li> Saya sedang menulis file. Izin file dan data kepemilikan untuk file tersebut terlihat seperti ini: <code>-rw-r--r-- usera shared</code> </li>\n<li> Pekerjaan cron dimulai! Garis chown diproses dan sekarang file tersebut dimiliki oleh pengguna <code>root</code> dan grup <code>shared</code>. </li>\n<li> Karena grup pemilik hanya memiliki akses baca ke file, saya mendapatkan kesalahan penulisan file! Ledakan! Akhir dari cerita. </li>\n</ol>\n\n<p> Mengapa operasinya berhasil? Tautan ke beberapa jenis dokumentasi referensi untuk mendukung alasan akan sangat disambut (karena saya dapat menggunakannya untuk mempelajari lebih detail). </p>","source":"https://superuser.com/questions/45293/change-file-ownership-during-write-operation","author":"<a href=\"https://superuser.com/users/2618/deleted\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Deleted</span></a>","replies":[{"reply":"Lihat opsi SGID bit dari chmod (dalam jawaban johnathan di bawah). Ini akan menyelamatkan Anda dari keharusan mengatur grup dengan cron.","author":"<a href=\"https://superuser.com/users/4530/chris-nava\" target=\"_blank\" rel=\"nofollow noopener\">Chris Nava</a>"},{"reply":"@ Chris: Saya tahu tentang itu. Tapi saya butuh sesuatu yang memperbaiki file yang dipindahkan juga.","author":"<a href=\"https://superuser.com/users/2618/deleted\" target=\"_blank\" rel=\"nofollow noopener\">Deleted</a>"}],"answers":[{"answer":"<p> Afaik, <a href=\"http://www.unix.org/2008edition/\" rel=\"nofollow noopener\" target=\"_blank\"> POSIX 1003.1 </a> hanya membutuhkan fopen untuk mengembalikan kesalahan [EACCES] pada hak istimewa yang tidak memadai. Operasi selanjutnya seperti fputc mungkin mengembalikan kesalahan deskriptor file [EBADF] yang buruk, tetapi menurut saya itu tidak dimaksudkan untuk menutupi perubahan izin saat file terbuka. </p>\n\n<p> Bertahun-tahun yang lalu, saya bekerja di perusahaan tempat server AIX kami disiapkan sehingga mereka menggunakan properti itu untuk membuat file log lebih aman. Ketika sebuah layanan dimulai, root akan menyentuh /var/log/service.log, lalu menghubungkannya ke serveruser: servergroup, su - start layanan (ini akan membuka file dalam mode append), dan kemudian chown file tersebut kembali ke root. Akibatnya, layanan dapat menambahkan logfile-nya sendiri, tetapi tidak menghapus atau menimpanya, jadi jika penyerang berhasil menyusupi layanan, dia tidak dapat merusak entri log sebelumnya. </p>\n\n<p> Trik serupa dapat digunakan untuk file sementara: buka file, lalu hapus. Entri direktori hilang dan file tidak terlihat, tetapi karena pegangan file masih terbuka, inode masih ada. Setelah Anda menutup file, jumlah tautan menjadi nol, dan OS mengambil kembali ruang disk. </p>","votes":"7","source":"https://superuser.com/a/45689","author":"<a href=\"https://superuser.com/users/10688/wallenborn\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">wallenborn</span></a>","replies":[]},{"answer":"<p> Menurut saya alasannya adalah ketika cron masuk, Anda masih memiliki pegangan yang valid untuk file tersebut, sehingga Anda dapat menggunakannya secara normal .. Dengan kata lain, sistem memeriksa hak Anda hanya ketika Anda mencoba membukanya, bukan pada setiap file operasi. </p>","votes":"5","source":"https://superuser.com/a/45307","author":"<a href=\"https://superuser.com/users/2226/joril\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Joril</span></a>","replies":[{"reply":"Ya, saya juga condong ke arah ini. Apakah Anda tahu sumber mana saya dapat membaca lebih lanjut tentang ini? Saya ingin tahu apakah ini portabel di antara semua kesatuan. Jika itu bagian dari standar POSIX.","author":"<a href=\"https://superuser.com/users/2618/deleted\" target=\"_blank\" rel=\"nofollow noopener\">Deleted</a>"},{"reply":"Saya khawatir saya tidak tahu .. :( Mungkin seseorang di ServerFault akan melakukannya? Saya pikir itu akan menjadi &quot;audiens&quot; yang lebih baik untuk pertanyaan seperti ini ..","author":"<a href=\"https://superuser.com/users/2226/joril\" target=\"_blank\" rel=\"nofollow noopener\">Joril</a>"}]},{"answer":"<p> Seperti yang dikatakan Joril, hak akses relevan saat file dibuka; mereka tidak diperiksa setelahnya. </p>\n\n<p> Ingatlah bahwa Anda dapat membuat file untuk menulis dengan 400 (atau 444, atau 000) izin pada file tersebut. Anda memerlukan izin untuk membuat file di direktori, tentu saja, tetapi Anda dapat memiliki akses tulis ke file yang tidak dapat diubah oleh orang lain (kecuali root). </p>\n\n<p> Perhatikan juga bahwa grup dapat diatur secara default dengan mengatur bit SGID pada direktori holding: </p> <pre><code>chmod g+s /home/shared\n</code></pre> <p> Semua file yang dibuat dalam direktori akan menjadi milik grup yang memiliki <code>/home/shared</code> hingga grup tersebut diubah. Di MacOS X, sistem berperilaku seolah-olah bit SGID disetel di setiap direktori - saat file disalin ke direktori, grup disetel ke grup yang memiliki direktori tersebut. </p>","votes":"2","source":"https://superuser.com/a/45309","author":"<a href=\"https://superuser.com/users/3089/jonathan-leffler\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Jonathan Leffler</span></a>","replies":[{"reply":"Saya tahu tentang SGID-bit dan saya menggunakannya. Tetapi itu tidak berfungsi untuk file yang saya buat di tempat lain yang kemudian dipindahkan ke <code>&#47;home&#47;shared</code>, yang diurus oleh cron-job. Tapi itu adalah hal sepele yang bagus dan menarik untuk mempelajari perbedaannya di MacOS X.","author":"<a href=\"https://superuser.com/users/2618/deleted\" target=\"_blank\" rel=\"nofollow noopener\">Deleted</a>"}]}]}
