{"title":"Bagaimana cara melakukan SSH dengan benar ke server di belakang NAT dengan tetap menjaga keamanan seketat mungkin?","draft":false,"url":"/bagaimana-cara-melakukan-ssh-dengan-benar-ke-server-di-belakang-nat-dengan-tetap-menjaga-keamanan-seketat-mungkin-u1ovhnfd","votes":"4","answers_count":"3","categories":["Komputer"],"tags":["linux","networking","ssh","security","nat"],"snippet":"Saya memiliki VPC di Amazon AWS. Ada Server NAT yang berjalan di Subnet Publik yang terhubung ke Gateway Internet. Saya memiliki banyak server yang berjalan di berbagai subnet pribadi dalam VPC. Saya...","body":"<p> Saya memiliki VPC di Amazon AWS. Ada Server NAT yang berjalan di Subnet Publik yang terhubung ke Gateway Internet. Saya memiliki banyak server yang berjalan di berbagai subnet pribadi dalam VPC. Saya ingin SSH ke server yang ada di subnet pribadi. Semua server saya menjalankan AWS Linux (CentOS). </p>\n\n<p> Saat ini, saya dapat melakukan SSH ke Server NAT menggunakan kunci pribadi saya. Server NAT memungkinkan koneksi SSH hanya dari IP pengembangan saya saat ini. Kemudian saya dapat SSH ke server di subnet pribadi hanya jika saya mengatur Login SSH di server tersebut, atau jika saya meletakkan file kunci di server NAT dan kemudian menggunakannya untuk SSH. Demi keamanan, sepertinya saya tidak boleh melakukan salah satu dari hal ini. </p>\n\n<p> Adakah cara praktik terbaik yang disukai untuk membuat hubungan ini? Sepertinya harus ada cara untuk terhubung dengan satu panggilan SSH dari mesin pengembangan rumah saya yang menjalankan Apple OSX. </p>","source":"https://superuser.com/questions/826805/how-do-i-properly-ssh-into-a-server-behind-a-nat-while-maintaining-the-tightest","author":"<a href=\"https://superuser.com/users/69669/t-brian-jones\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">T. Brian Jones</span></a>","replies":[{"reply":"lupa bertanya - OS klien mana yang Anda gunakan? Yang saya jelaskan wirks di Unix / Linux, tetapi teknik ini juga berfungsi di Windows dengan PuTTY. Cukup berantakan untuk mengatur penerusan port dengan PuTTY dan membuatnya mengerti itu harus menggunakan nama lain sebagai localhost untuk kunci yang disajikan dengan ...","author":"<a href=\"https://superuser.com/users/72257/florenz-kley\" target=\"_blank\" rel=\"nofollow noopener\">Florenz Kley</a>"},{"reply":"Semua server menjalankan Amazon Linux (CentOS) dan saya menjalankan OSX secara lokal. Menambahkan detail ini ke pertanyaan.","author":"<a href=\"https://superuser.com/users/69669/t-brian-jones\" target=\"_blank\" rel=\"nofollow noopener\">T. Brian Jones</a>"},{"reply":"Luar biasa! itu hanya pengaturan yang saya gunakan, OS X di sisi klien. Sisi server tidak terlalu penting. Lihat jawaban saya - edit entri host &quot;terowongan&quot; di ~ / .ssh / config Anda dan tambahkan beberapa entri yang menggunakan terowongan tersebut.","author":"<a href=\"https://superuser.com/users/72257/florenz-kley\" target=\"_blank\" rel=\"nofollow noopener\">Florenz Kley</a>"}],"answers":[{"answer":"<p> Anda tidak boleh meletakkan kunci rahasia Anda di gateway, dan Anda tidak perlu :-) </p>\n\n<p> atur konfigurasi SSH lokal Anda sehingga Anda dapat menggunakan gateway NAT untuk penerusan port saat Anda membutuhkannya: </p>\n\n<p> buat entri di <code>~/.ssh/config</code> Anda yang mengatur penerusan lokal ke host yang ingin Anda sambungkan: </p> <pre><code>Host natgw-fwd\n        User ec2-user\n        HostKeyAlias natgw-fwd.my.domain\n        HostName 54.182.32.11\n        LocalForward 1025 10.0.2.1:22\n</code></pre> <p> lalu tambahkan satu entri per host yang diteruskan dengan <code>HostKeyAlias</code>: </p> <pre><code>Host internal-one\n        User ec2-user\n        HostKeyAlias internal-one.ec2.internal\n        HostName localhost\n        Port 1025\n</code></pre> <p> bawa terowongan ke dalam satu cangkang: </p> <pre><code>ssh -C -v natgw-fwd\n</code></pre> <p> dan sambungkan ke host internal di shell lain: </p> <pre><code>ssh internal-one\n</code></pre> <p> Saat menggunakan banyak koneksi &quot;cepat + pendek&quot; selain satu atau dua shell, seperti alat seperti dsh, latensi untuk penyiapan dan penghancuran koneksi tunggal menjadi lebih terlihat, dan saya menggunakan <code>ControlMaster</code> dan <code>ControlPath</code> untuk mengaktifkan berbagi koneksi. Batasan tidak mengganggu saya karena saya jarang menggunakan agen atau X11 dalam skenario seperti itu. </p>","votes":"3","source":"https://superuser.com/a/826833","author":"<a href=\"https://superuser.com/users/72257/florenz-kley\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Florenz Kley</span></a>","replies":[{"reply":"INI BEKERJA BESAR. Memecahkan masalah saya berikutnya yang SSHing dari Editor Teks GUI (Coda) saya. Beberapa catatan ... Anda hanya perlu entri LocalForward pertama di konfigurasi Host natgw-fwd. Juga, untuk orang lain, HostKeyAlias ​​bisa apa saja. Selanjutnya, jika Anda menggunakan kunci publik untuk masuk ke server, Anda harus menyetel direktif <code>IdentityFile</code> untuk kedua host ke lokasi file kunci publik Anda. Terakhir, saat masuk dengan editor teks seperti Coda atau TextWrangler, pertama-tama <code>$ssh -C natgw-fwd</code> dari baris perintah. Kemudian login dengan editor teks Anda dengan menghubungkan melalui SFTP ke <code>localhost</code> pada port <code>1025</code>.","author":"<a href=\"https://superuser.com/users/69669/t-brian-jones\" target=\"_blank\" rel=\"nofollow noopener\">T. Brian Jones</a>"},{"reply":"@ T.BrianJones senang mendengarnya bekerja untuk Anda. Dua komentar: 1) jika Anda menggunakan ssh-agent Anda tidak perlu mengkonfigurasi <code>IdentityFile</code>, itu akan mencoba setiap identitas yang dimuat di rantai kunci agen 2) Saya sering berpindah jaringan, tetapi perlu terhubung ke host yang sama, jadi saya tetap <code>Host</code> entri stabil, dan konfigurasikan satu entri &quot;penerusan lingkungan X&quot; dan satu entri &quot;lingkungan Y&quot; lainnya, dengan pernyataan <code>LocalForward</code> yang sama","author":"<a href=\"https://superuser.com/users/72257/florenz-kley\" target=\"_blank\" rel=\"nofollow noopener\">Florenz Kley</a>"},{"reply":"Tips tambahan: 1) Ya, Anda dapat memiliki lebih dari satu direktif LocalForward per host. 2) Berikan opsi -N ke perintah ssh untuk membuka terowongan jika Anda tidak akan menjalankan perintah apa pun, yaitu Anda <i> hanya </i> membuka terowongan. 3) Juga berikan opsi -f ke perintah ssh yang membuka terowongan untuk menjalankannya di latar belakang.","author":"<a href=\"https://superuser.com/users/200246/dgvid\" target=\"_blank\" rel=\"nofollow noopener\">dgvid</a>"}]},{"answer":"<p> Saya melakukan beberapa penelitian dan menemukan sebuah artikel yang tampaknya terkait dengan apa yang Anda tanyakan. </p>\n\n<blockquote>\n  <p> Server SSH dan bastion </p>\n  \n  <p> Secara default, instans Linux di EC2 menggunakan file kunci SSH untuk autentikasi, bukan nama pengguna dan sandi SSH. Menggunakan file kunci dapat mengurangi kemungkinan seseorang mencoba menebak kata sandi untuk mendapatkan akses ke instance. Namun menggunakan pasangan kunci dengan bastion host dapat menimbulkan tantangan — menghubungkan ke instance di subnet pribadi memerlukan kunci pribadi, tetapi Anda tidak boleh menyimpan kunci pribadi di bastion. </p>\n  \n  <p> Salah satu solusinya adalah dengan menggunakan penerusan agen SSH (ssh-agent) pada klien. Ini memungkinkan administrator untuk terhubung dari bastion ke instance lain tanpa menyimpan kunci pribadi di bastion tersebut. Itulah pendekatan yang akan saya bahas di posting ini. </p>\n</blockquote>\n\n<p><a href=\"http://blogs.aws.amazon.com/security/post/Tx3N8GFK85UN1G6/Securely-connect-to-Linux-instances-running-in-a-private-Amazon-VPC\" rel=\"nofollow noopener\" target=\"_blank\"> http://blogs.aws.amazon.com/security/post/Tx3N8GFK85UN1G6/Securely-connect-to-Linux-instances-running-in-a-private-Amazon-VPC </a></p>\n\n<p> Semoga Anda akan menemukan solusi dalam membuat bastion server dan menggunakan penerusan agen SSH di klien Anda seperti yang direkomendasikan artikel ini. </p>","votes":"3","source":"https://superuser.com/a/826825","author":"<a href=\"https://superuser.com/users/379946/don-king\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Don King</span></a>","replies":[]},{"answer":"<p> Jawaban @Don King sangat membantu dan ini dia <a href=\"http://blogs.aws.amazon.com/security/post/Tx3N8GFK85UN1G6/Securely-connect-to-Linux-instances-running-in-a-private-Amazon-VPC\" rel=\"nofollow noopener\" target=\"_blank\"> tutorial </a> dia menyarankan. Ini memiliki instruksi untuk OSX dan Windows. </p>\n\n<p> Berikut adalah ringkasan dari apa yang saya lakukan saat masuk dari mesin OSX lokal. Ini mengasumsikan bahwa infrastruktur dasar di VPC Anda sudah benar. Lihat ini <a href=\"http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Scenario2.html\" rel=\"nofollow noopener\" target=\"_blank\"> tutorial </a> untuk detailnya. </p>\n\n<ol>\n<li><p> Buka koneksi SSH keluar di grup keamanan NAT yang memungkinkan koneksi ke grup keamanan server di subnet pribadi. </p></li>\n<li><p> Buka koneksi SSH masuk pada grup keamanan server di subnet pribadi yang memungkinkan koneksi dari grup keamanan NAT. </p></li>\n<li><p> Di OSX, tambahkan public_key.pem Anda ke rantai kunci lokal Anda: <code>ssh-add -K .aws/public_key.pem</code> </p></li>\n<li><p> SSH dari mesin lokal Anda ke NAT menggunakan -A (ssh-agent): <code>ssh -A ec2-user@ip_of_nat</code> </p></li>\n<li><p> SSH dari NAT ke server di subnet publik: <code>ssh ec2-user@ip_of_private_server</code> </p></li>\n</ol>\n\n<p><strong> Potensi Masalah: </strong></p>\n\n<ul>\n<li> pastikan ForwardAgent disetel ke yes di file OSX / etc / ssh_config Anda. Ini harus ya secara default. </li>\n</ul>","votes":"0","source":"https://superuser.com/a/826897","author":"<a href=\"https://superuser.com/users/69669/t-brian-jones\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">T. Brian Jones</span></a>","replies":[{"reply":"itu dua langkah per koneksi, sulit untuk membuat skrip karena ini (lupakan dsh) dan menggunakan penerusan auth dianggap bermasalah pada host bersama. Tutorialnya bagus, tetapi mengapa saya ingin mengetik barang dua kali ketika saya dapat memiliki shell saya dengan satu perintah?","author":"<a href=\"https://superuser.com/users/72257/florenz-kley\" target=\"_blank\" rel=\"nofollow noopener\">Florenz Kley</a>"},{"reply":"Saya akhirnya menggunakan solusi @Florenz Kley. Ini membutuhkan sedikit lebih banyak pengaturan, tetapi memecahkan masalah untuk dapat menggunakan SSH dari editor teks GUI seperti Coda atau TextWrangler. Lihat komentar saya tentang solusi itu untuk detailnya.","author":"<a href=\"https://superuser.com/users/69669/t-brian-jones\" target=\"_blank\" rel=\"nofollow noopener\">T. Brian Jones</a>"}]}]}
