{"title":"Mengimpor variabel dalam satu skrip shell dari yang lain tanpa menjalankan skrip shell yang dirujuk","draft":false,"url":"/mengimpor-variabel-dalam-satu-skrip-shell-dari-yang-lain-tanpa-menjalankan-skrip-shell-yang-dirujuk-6lye6nvu","votes":"4","answers_count":"2","categories":["Komputer"],"tags":["linux","command-line","bash","shell","shell-script"],"snippet":"Saya memiliki 2 skrip shell, file1.sh dan file2.sh  file1.sh  #!/usr/bin/env bash export var1=\"/data/share\"export var2='password'echo \"Hello\"  file2.sh  #!/usr/bin/env bash source file1.shecho $var1echo $var2  Ketika saya menjalankan file2.sh, saya mendapatkan...","body":"<p> Saya memiliki 2 skrip shell, file1.sh dan file2.sh </p>\n\n<p><strong> file1.sh </strong></p> <pre><code>#!/usr/bin/env bash \nexport var1=\"/data/share\"\nexport var2='password'\necho \"Hello\"\n</code></pre> <p><strong> file2.sh </strong></p> <pre><code>#!/usr/bin/env bash \nsource file1.sh\necho $var1\necho $var2\n</code></pre> <p> Ketika saya menjalankan file2.sh, saya mendapatkan output berikut </p> <pre><code>Hello\n/data/share\npassword\n</code></pre> <p> Tapi keluaran yang saya harapkan adalah </p> <pre><code>/data/share\npassword\n</code></pre> <p> file1.sh dijalankan saat dirujuk di file2.sh. Bagaimana cara mengimpor variabel sendirian di file2.sh tanpa menjalankan file1.sh? </p>","source":"https://superuser.com/questions/1090391/importing-variables-in-one-shell-script-from-another-without-executing-the-refer","author":"<a href=\"https://superuser.com/users/524226/mathew\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Mathew</span></a>","replies":[{"reply":"Kamu tidak boleh melakukan itu. <code>source</code> berarti mengeksekusi. Solusi paling jelas adalah meletakkan definisi variabel di file konfigurasi dan mengambilnya di kedua skrip.","author":"<a href=\"https://superuser.com/users/599802/michael-vehrs\" target=\"_blank\" rel=\"nofollow noopener\">Michael Vehrs</a>"},{"reply":"Bisa echo baris dengan <code>[[ $1 == &quot;SourceIt&quot; ]] &amp; echo &quot;Hello&quot;</code> ini setelah itu Anda bisa mendapatkan var dari script. Gunakan ini seperti ini <code>&#47;path&#47;of&#47;file.sh SourceIt</code>","author":"<a href=\"https://superuser.com/users/452074/makgun\" target=\"_blank\" rel=\"nofollow noopener\">makgun</a>"},{"reply":"7 pertanyaan dan <a href=\"http://superuser.com/users/524226/mathew?tab=activity&sort=accept\" target=\"_blank\" rel=\"nofollow noopener\"> 0 Menerima </a> . Silakan lihat di: <a href=\"http://superuser.com/help/someone-answers\" target=\"_blank\" rel=\"nofollow noopener\"> Apa yang harus saya lakukan ketika seseorang menjawab pertanyaan saya? </a>","author":"<a href=\"https://superuser.com/users/340330/cyrus\" target=\"_blank\" rel=\"nofollow noopener\">Cyrus</a>"}],"answers":[{"answer":"<p> Ada tiga opsi yang saya gunakan ketika saya memiliki skrip bash yang saya ingin berperilaku berbeda ketika bersumber vs. ketika dijalankan (atau dengan kata lain memiliki item data dalam skrip yang ingin saya akses tanpa mengeksekusi kode apa pun pada saat itu. waktu). Komentar tersebut sedikit menyinggung mereka. </p>\n\n<h3 class=\"h5\"> Opsi Satu </h3>\n\n<p> Tentukan kapan menjadi sumber dan akhiri &#39;sourcing&#39; pada waktu yang tepat </p>\n\n<p> Pisahkan skrip menjadi dua bagian, keluar dari skrip saat bersumber sebelum ke detik bawah </p>\n\n<p> Buat bagian atas skrip dengan definisi (fungsi / tugas variabel / dll), tetapi tidak ada eksekusi kode langsung. </p>\n\n<p> Tepat sebelum bagian kode yang dapat dieksekusi dimulai, letakkan logika yang akan keluar dari skrip jika mendeteksi itu bersumber.\nSegmen kode berikut akan melakukan ini: </p>\n\n<p><br><strong> file1.sh </strong></p> <pre><code>#!/usr/bin/env bash\nexport var1=\"/data/share\"\nexport var2='password'    \n# --- End Definitions Section ---    \n# check if we are being sourced by another script or shell\n[[ \"${#BASH_SOURCE[@]}\" -gt \"1\" ]] &amp;&amp; { return 0; }\n# --- Begin Code Execution Section ---\necho \"Hello\"\necho $var1\necho $var2 \n</code></pre> <p><br><strong> file2.sh </strong><br></p> <pre><code>#!/usr/bin/env bash \nsource file1.sh\necho \"$var1\"\necho \"$var2\"\n</code></pre> <p><br><strong> Output dari menjalankan ./file2.sh </strong><br></p> <pre><code>$ ./file2.sh \n/data/share\npassword\n</code></pre> <h3 class=\"h5\"> Opsi Dua </h3>\n\n<p> Yang ini biasanya hanya digunakan dalam situasi yang kompleks, dan untuk contoh khusus ini berlebihan. Saya membuat fungsi di file yang ingin saya sumber, dan di fungsi itu menentukan apa yang harus tersedia untuk pemanggil. Dalam hal ini adalah dua variabel yang diekspor. Biasanya saya menggunakan mode ini ketika saya memiliki array asosiatif, yang sebaliknya hampir tidak mungkin untuk dibagikan. Selain itu, file tmp harus dihapus oleh pemanggil; tapi saya tidak melakukannya dalam kasus ini: </p>\n\n<p><br><strong> file1.sh </strong></p> <pre><code>#!/usr/bin/env bash \nexport var1=\"/data/share\"\nexport var2='password'\nexportCfg() {\n  tmpF=$(mktemp)\n  declare -p var1 var2 &gt; \"$tmpF\"\n  echo \"$tmpF\"\n}\nif [ \"$1\" == \"export\" ]; then\n  exportCfg;\n  exit 0;\nfi\n\necho \"Hello\"\necho $var1\necho $var2\n</code></pre> <p><br><strong> file2.sh </strong></p> <pre><code>#!/usr/bin/env bash \nsource $(./file1.sh export)\n\n\necho \"$var1\"\necho \"$var2\"\n</code></pre> <p> Output dari menjalankan file2.sh sama seperti di atas </p>\n\n<h3 class=\"h5\"> Pilihan 3 </h3>\n\n<p> Cara umum terakhir saya menangani ini hanyalah dengan file perpustakaan yang hanya menyimpan definisi, dan tidak memiliki kode yang akan dieksekusi ketika bersumber atau langsung dijalankan.\nIni hanyalah masalah membagi kode Anda. Saya memiliki sekelompok &#39;libs&#39; bash yang berisi fungsi yang sering digunakan, dan berdasarkan proyek biasanya menyiapkan perpustakaan kecil yang dapat bersumber untuk menyimpan data konfigurasi (konstanta). Jika data itu termasuk array yang dihuni, maka saya juga akan menggunakan versi Opsi 2. </p>","votes":"4","source":"https://superuser.com/a/1091016","author":"<a href=\"https://superuser.com/users/250153/argonauts\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Argonauts</span></a>","replies":[]},{"answer":"<p> Jika semua variabel Anda diekspor dengan cara yang sama ( <em> ekspor foo = bar </em> ), lalu Anda dapat menggunakan semuanya dengan mudah <em> pesta </em> fitur substitusi proses: </p> <pre><code>source &lt;(grep '^export .*=' file1.sh)\n</code></pre> <p> Ekstrak halaman manual: </p>\n\n<blockquote>\n  <p> Proses Substitusi\n         Proses substitusi didukung pada sistem yang mendukung pipa bernama (FIFOs) atau metode / dev / fd penamaan file terbuka. Ini mengambil bentuk\n         &lt;(daftar) atau&gt; (daftar). Daftar proses dijalankan dengan input atau outputnya terhubung ke FIFO atau beberapa file di / dev / fd. Nama file ini adalah\n         diteruskan sebagai argumen ke perintah saat ini sebagai hasil dari perluasan. Jika formulir&gt; (daftar) digunakan, menulis ke file akan memberikan masukan\n         untuk daftar. Jika formulir &lt;(daftar) digunakan, file yang diteruskan sebagai argumen harus dibaca untuk mendapatkan keluaran daftar. </p>\n</blockquote>","votes":"2","source":"https://superuser.com/a/1091060","author":"<a href=\"https://superuser.com/users/565560/a-loiseau\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">A. Loiseau</span></a>","replies":[]}]}
