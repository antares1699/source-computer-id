{"title":"Menggunakan MySQL dan LxD melalui Btrfs","draft":false,"url":"/menggunakan-mysql-dan-lxd-melalui-btrfs-aby4neuy","votes":"4","answers_count":"2","categories":["Komputer"],"tags":["mysql","ext4","btrfs","snapshot","lxc"],"snippet":"Saya memiliki workstation Ubuntu 16.04, dengan filesystem ext4.  Saat bermain dengan LxD, saya ingin memiliki file  secepat kilat  kemampuan memotret (karena gambar saya biasanya besar). Kemampuan ini, menurut pemahaman saya, hanya dapat...","body":"<p> Saya memiliki workstation Ubuntu 16.04, dengan filesystem ext4. </p>\n\n<ol>\n<li> Saat bermain dengan LxD, saya ingin memiliki file <strong> secepat kilat </strong> kemampuan memotret (karena gambar saya biasanya besar). Kemampuan ini, menurut pemahaman saya, hanya dapat dicapai jika sistem file pendukung adalah sistem file CoW seperti Btrfs. </li>\n</ol>\n\n<p><em> (Catatan: Satu-satunya peringatan terkait kinerja utama untuk Btrf yang saya temukan sejauh ini adalah penggunaan yang disarankan dari bendera pemasangan <code>noatime</code>.) </em></p>\n\n<ol start=\"2\">\n<li> Tetapi karena saya juga memiliki instance MySQL pada sistem ini yang kinerjanya tidak ingin saya lihat menderita (relatif terhadap sistem file ext4), saya memutuskan untuk melakukan pemeriksaan terakhir untuk setiap masalah potensial dengan peralihan saya ke MySQL yang didukung Btrfs. Dan, <a href=\"https://mariadb.com/blog/what-best-linux-filesystem-mariadb\" rel=\"nofollow noopener\" target=\"_blank\"> Lihat apa yang kutemukan </a> : </li>\n</ol>\n\n<blockquote>\n  <p> Biasanya yang terbaik adalah me-mount Btrfs dengan opsi <code>'nodatacow'</code>, menonaktifkan copy-on-write, karena COW menyebabkan fragmentasi, dish thrashing, dan lonjakan CPU dan RAM ketika Anda memiliki banyak penulisan acak. </p>\n</blockquote>\n\n<p> Sekarang, itu tampaknya menjadi peredam yang nyata! </p>\n\n<p><strong> Pertanyaan: </strong> Apakah ada cara agar saya dapat memiliki snapshotting cepat dan instance MySQL yang berkinerja baik dengan Btrfs? </p>","source":"https://superuser.com/questions/1142695/using-mysql-and-lxd-over-btrfs","author":"<a href=\"https://superuser.com/users/126082/harry\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Harry</span></a>","replies":[],"answers":[{"answer":"<p><strong> Fragmentasi adalah efek samping yang sebagian besar tidak dapat dihindari dari sistem file yang dirancang dengan copy-on-write. </strong> Itu juga yang memungkinkan snapshot sistem file hampir gratis di tempat pertama. </p>\n\n<p> Alasannya cukup sederhana: Setiap kali sebuah blok diubah, blok baru harus ditulis ke beberapa lokasi selain dari blok asli. Jadi meskipun file awalnya bersebelahan, itu tidak akan terjadi setelah diubah. </p>\n\n<p> Saya tidak tahu bagaimana Btrfs <code>nodatacow</code> berinteraksi dengan snapshot, tetapi saya merasa bahwa saat Anda memiliki snapshot pada dataset, Anda memaksakan setidaknya sebagian perilaku copy-on-write tidak peduli flag apa yang Anda gunakan; jika tidak, bagaimana Anda bisa mengakses data lama melalui snapshot? </p>\n\n<p> Namun, <strong> ini tidak diberikan bahwa ini akan sangat mempengaruhi kinerja MySQL Anda, </strong> karena dua alasan: </p>\n\n<ul>\n<li> Disk modern benar-benar cukup cepat untuk beban kerja pengguna tunggal (yang menurut saya paling Anda minati karena Anda menyebutkan bahwa sistem Anda adalah &quot;stasiun kerja&quot;) </li>\n<li> Sistem operasi modern memiliki algoritme caching yang cukup baik, sehingga mengurangi kebutuhan untuk benar-benar mencapai penyimpanan fisik </li>\n</ul>\n\n<p> Sekadar memberi Anda gambaran, saya menjalankan ZFS sendiri (dari mana Btrfs meminjam banyak ide), dan saat ini ada scrub yang sedang berlangsung. Kumpulan yang dimaksud adalah raidz2 enam disk, yang tidak benar-benar dikenal karena kinerjanya yang luar biasa, secara fisik didukung oleh enam disk 7200 rpm (dua SATA, empat SAS) yang juga tidak terlalu dikenal untuk IOPS bintang pada khususnya. Sebuah scrub ZFS menavigasi seluruh pohon Merkle pada disk, membaca semua data, dan memverifikasi checksum pada semuanya untuk memastikan semuanya membaca kembali seperti yang ditulis sebelumnya; dalam kasus saya, menghitung hash SHA-256 untuk semua hal di sepanjang jalan. Kecepatan scrub saat ini (setelah melewati bagian awal yang padat metadata, yang melibatkan pencarian berat) sedang melayang <strong> sekitar 200 MB / s </strong> dan benar-benar mendaki dengan lambat. Dan itu sebenarnya <em> piring </em> I / O, tanpa melibatkan caching (karena caching tidak masuk akal saat Anda ingin memverifikasi apa yang ada di penyimpanan persisten). </p>\n\n<p> Tentu, sangat mungkin Anda akan melihat beberapa penurunan kinerja dari fragmentasi jika Anda pindah ke sistem file salin-saat-tulis. Tapi Anda tidak bisa makan kue dan menyimpannya juga; jika cuplikan cepat dan berbiaya rendah adalah sesuatu yang Anda inginkan, kemungkinan besar Anda harus melepaskan sesuatu yang lain untuk mendapatkannya. </p>\n\n<p><strong> Apa yang akan saya lakukan dalam kasus Anda adalah patokan. </strong> Siapkan beberapa penyimpanan Btrfs, letakkan salinan database MySQL di sana, dan lihat bagaimana keduanya bekerja di bawah beban kerja yang wajar. </p>","votes":"4","source":"https://superuser.com/a/1142731","author":"<a href=\"https://superuser.com/users/53590/user\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">user</span></a>","replies":[{"reply":"Apakah ada cara agar saya dapat mempertahankan sistem file ext4 utama OS host saya sebagaimana adanya (untuk MySQL dll), tetapi entah bagaimana membuat LxD menggunakan direktori <code>&#47;var&#47;lib&#47;lxcfs</code> dan <code>&#47;var&#47;lib&#47;lxd</code> yang didukung Btrfs? Misalnya, saya dapat membuat &#39;perangkat&#39; berbasis file 1TB pada host ext4fs saya, memasangnya sebagai perangkat loop, memformatnya dengan Btrfs dan &#39;entah bagaimana&#39; (tidak tahu bagaimana caranya!) Membuat instalasi LxD saya menggunakan itu <code>&#47;var&#47;lib&#47;...</code> direktori dari perangkat Btrfs ini.","author":"<a href=\"https://superuser.com/users/126082/harry\" target=\"_blank\" rel=\"nofollow noopener\">Harry</a>"},{"reply":"@Harry saya curiga ada. ZFS mendukung vdev yang didukung file dengan baik (meskipun ini bukan pengaturan yang disarankan, itu <i> aku s </i> sangat berguna untuk pengujian), dan saya tidak melihat mengapa Btrfs akan berbeda. Paling banyak, Anda perlu menggunakan <code>losetup</code> untuk mengkonfigurasi perangkat loopback yang didukung oleh file tersebut. Meskipun saya sangat merekomendasikan untuk tidak menggunakan <i> jarang </i> file untuk tujuan dukungan sistem file kecuali murni sebagai pengujian; karakteristik kinerja sepertinya <i> mengerikan </i> karena Anda akan mendapatkan minimal <i> dua </i> lapisan fragmentasi, bukan satu: File dukungan, dan konten sistem file.","author":"<a href=\"https://superuser.com/users/53590/user\" target=\"_blank\" rel=\"nofollow noopener\">user</a>"}]},{"answer":"<p> Saya mencoba komentar saya sendiri, dan semuanya tampaknya berfungsi dengan baik. Alternatif yang lebih baik masih diterima. </p>\n\n<p> Inilah yang saya lakukan. </p> <pre><code># 1. Initial, onetime setup.\n#   1.a) Create a sparse, 20G file.\n      $ truncate -s 20G disk.20g\n\n#   1.b) Format the loopback device with Btrfs.\n      $ losetup /dev/loop0 disk.20g\n      $ mkfs.btrfs /dev/loop0\n\n# 2. Do this every time you wish to actually start using LxD.\n# Note: Replace '/dev/loop0' with whatever loop-device is free on your system.\n  $ sudo service lxd stop\n  $ sudo mkdir -p /var/lib/lxd\n  $ sudo mount -o noatime /dev/loop0 /var/lib/lxd\n  $ sudo service lxd start\n\n# 3. Do this to gracefully 'shutdown' the effects of Step 2.\n  $ sudo service lxd stop\n  $ sudo umount /var/lib/lxd\n  $ losetup -d /dev/loop0\n  $ sudo service lxd start\n</code></pre> <p> Jadi, untuk mengulangi: </p>\n\n<ol>\n<li> Sistem file utama OS host saya adalah Ext4. File <code>disk.20g</code> di atas berada pada sistem file ini saja. Sistem file ini dapat terus menjadi host MySQL dan perangkat lunak lain yang kinerjanya dapat dipengaruhi secara negatif oleh Btrfs. </li>\n<li> LxD menyimpan image dan containernya di partisi Btrfs. Ini memungkinkan pengambilan gambar yang sangat cepat. </li>\n</ol>","votes":"2","source":"https://superuser.com/a/1142941","author":"<a href=\"https://superuser.com/users/126082/harry\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Harry</span></a>","replies":[{"reply":"Tapi kenapa tidak menggunakan partisi?","author":"<a href=\"https://superuser.com/users/219095/daniel-b\" target=\"_blank\" rel=\"nofollow noopener\">Daniel B</a>"},{"reply":"Tentu saja bisa. Dalam kasus saya, saya hanya memiliki 1 drive fisik dengan ext4fs, tanpa ruang untuk pengeditan partisi lebih lanjut.","author":"<a href=\"https://superuser.com/users/126082/harry\" target=\"_blank\" rel=\"nofollow noopener\">Harry</a>"}]}]}
