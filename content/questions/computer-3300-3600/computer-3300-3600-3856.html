{"title":"Izin folder log IIS tidak diwariskan","draft":false,"url":"/izin-folder-log-iis-tidak-diwariskan-hd7hihjp","votes":"4","answers_count":"3","categories":["Komputer"],"tags":["permissions","logging","webserver","iis"],"snippet":"Kami memiliki folder Log yang disiapkan di server web kami, dengan izin yang ditetapkan untuk grup AD tertentu agar dapat membacanya (pengembang yang perlu melihat pelaporan kesalahan, tetapi yang tidak memiliki izin...","body":"<p> Kami memiliki folder Log yang disiapkan di server web kami, dengan izin yang ditetapkan untuk grup AD tertentu agar dapat membacanya (pengembang yang perlu melihat pelaporan kesalahan, tetapi yang tidak memiliki izin administrator ke kotak). </p>\n\n<p> Ini berfungsi dengan baik untuk log yang sudah ada, tetapi setiap kali IIS membuat sub folder baru (dengan pola nama &quot;W3SVCx&quot;), izin dari folder induk tidak diturunkan. Sebaliknya, folder ini hanya terlihat oleh administrator. </p>\n\n<p> Bagaimana kita bisa mendapatkan IIS untuk menulis log ini dengan izin yang diwariskan yang benar, tanpa memberikan akses administrator kepada pengguna yang seharusnya tidak memilikinya? </p>","source":"https://superuser.com/questions/625975/iis-log-folder-permissions-not-being-inherited","author":"<a href=\"https://superuser.com/users/241979/sean-worle\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Sean Worle</span></a>","replies":[],"answers":[{"answer":"<p> IIS membuat folder W3SVCx setelah permintaan pertama ke situs yang baru dibuat, itu juga menetapkan izin NTFS di atasnya terlepas dari izin folder induk dan pengaturan warisannya. Izin yang ditetapkannya adalah: </p> <pre><code>NT AUTHORITY\\SYSTEM:(OI)(CI)(F)\nBUILTIN\\Administrators:(OI)(CI)(F)\n</code></pre> <p> Saya tidak tahu cara apa pun untuk memberi tahu IIS agar tidak melakukan ini. Anda perlu mengingat bahwa setelah Anda membuat situs baru, tekan sekali dan kemudian atur izin pada folder log. </p>\n\n<p> Jika Anda menyiapkan banyak situs, gunakan skrip sebagai gantinya. Saya menggunakan PowerShell: </p> <pre><code>New-WebSite -Name \"peter.superuser.com\" -port 80 -id 106 -PhysicalPath \"C:\\inetpub\\peter.superuser.com\" -HostHeader peter.superuser.com\n(New-Object System.Net.WebClient).DownloadString(\"http://peter.superuser.com\")\nstart-sleep -seconds 1\n&amp; icacls.exe \"C:\\inetpub\\logs\\LogFiles\\W3SVC106\" /Q /grant \"BUILTIN\\Users:`(OI`)`(CI`)`(RX`)\"\n</code></pre> <p> Saya pertama kali membuat situs, lalu masuk ke halaman beranda, tunggu sebentar, lalu setel izin pada folder log. </p>\n\n<p> Jika Anda tidak mengetahui Id situs sebelumnya, gunakan </p> <pre><code>$newId = (get-childitem IIS:\\Sites | where{$_.Name -eq \"peter.superuser.com\"}).Id\n&amp; icacls.exe \"C:\\inetpub\\logs\\LogFiles\\W3SVC$newId\" /Q /grant \"BUILTIN\\Users:`(OI`)`(CI`)`(RX`)\"\n</code></pre> <p> untuk mendapatkan Id setelah Anda membuat situs. </p>\n\n<p> Untuk menggunakan ini, Anda perlu mengaktifkan skrip untuk IIS, tergantung pada OS Anda. </p>","votes":"3","source":"https://superuser.com/a/630311","author":"<a href=\"https://superuser.com/users/3719/peter-hahndorf\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Peter Hahndorf</span></a>","replies":[{"reply":"Masalah utamanya adalah bahwa ini tidak sepenuhnya benar - IIS membuat folder ini setelah situs dibuat, dan juga secara berkala sejak saat itu penuh. Di server kami, ini membuat folder baru kira-kira sekali sehari, sehingga setiap folder berisi log hari itu. Apakah Anda mengatakan bahwa satu-satunya cara untuk menangani ini adalah menjalankan pekerjaan terjadwal untuk mengubah izin setiap hari?","author":"<a href=\"https://superuser.com/users/241979/sean-worle\" target=\"_blank\" rel=\"nofollow noopener\">Sean Worle</a>"},{"reply":"@ Sean - Versi IIS apa yang Anda gunakan. Setidaknya pada 8, folder tersebut tidak dibuat saat Anda membuat situs tetapi setelah klik pertama di situs tersebut. Izin pada folder itu tidak diubah lagi. Hanya ada satu folder per situs. Secara default, file baru dibuat setiap hari. Bagaimana folder bisa penuh? Anda dapat mengubah &#39;Log File Rollover&#39; dari &#39;Schedule&#39; menjadi &#39;Max file size&#39;. Saya belum melakukannya tetapi saya ragu ini akan mengubah perilaku umum penebangan.","author":"<a href=\"https://superuser.com/users/3719/peter-hahndorf\" target=\"_blank\" rel=\"nofollow noopener\">Peter Hahndorf</a>"},{"reply":"Kami menggunakan IIS 7.5. Sepertinya saya salah - Anda mengatakan bahwa folder tersebut hanya dibuat saat situs pertama kali terkena. Itu bisa menjadi sumber kesalahpahaman bahwa folder-folder ini terus dibuat. Ini sedikit pekerjaan ekstra yang harus dilakukan saat kami membuat situs, tetapi selama situs tidak terus dibuat, itu mungkin tidak masalah. Terima kasih.","author":"<a href=\"https://superuser.com/users/241979/sean-worle\" target=\"_blank\" rel=\"nofollow noopener\">Sean Worle</a>"}]},{"answer":"<p> Saya menggunakan solusi berikut pada instalasi IIS 7/8 baru: </p>\n\n<ol>\n<li><p> Atur izin yang diinginkan pada folder <code>C:\\inetpub\\logs\\LogFiles</code> </p></li>\n<li><p> Ubah folder log yang ada untuk mewarisi izin </p> <pre><code>icacls C:\\inetpub\\logs\\LogFiles\\W3SVC* /inheritance:e\n</code></pre> </li>\n<li><p> Pra-isi 99 folder log pertama <code>W3SVC1</code> ... <code>W3SVC99</code> sehingga mereka mewarisi izin bahkan sebelum IIS mencoba membuat salah satunya. IIS tidak mengubah izin ketika folder log sudah ada. </p> <pre><code>REM cmd style\nfor /l %%G in (1,1,99) do md C:\\inetpub\\logs\\LogFiles\\W3SVC%%G\n\n# PowerShell style\n1..3 | % { md C:\\inetpub\\logs\\LogFiles\\W3SVC$_ }   \n</code></pre> </li>\n</ol>\n\n<p> Tidak cantik, tapi menyelesaikan pekerjaan. </p>","votes":"3","source":"https://superuser.com/a/719464","author":"<a href=\"https://superuser.com/users/77310/oleschri\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">oleschri</span></a>","replies":[]},{"answer":"<p> Saya membuat situs saya menggunakan Powershell, jadi saya menambahkan yang berikut ini untuk membuat folder yang tepat berdasarkan ID Situs. </p> <pre><code>Import-Module WebAdministration\n$iisAppName = \"MySite\"\n$site = Get-ItemProperty IIS:\\Sites\\$iisAppName\n$folderName = \"W3SVC\" + $site.id    #Create a folder based on the actual site id\n$iisLogPath = \"C:\\MyLogFolder\"\n$folderPath = Join-Path $iisLogPath $folderName\nNew-Item -Path $folderPath -ItemType directory\n</code></pre>","votes":"0","source":"https://superuser.com/a/1083889","author":"<a href=\"https://superuser.com/users/134810/robert-brooker\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Robert Brooker</span></a>","replies":[]},{"answer":"<p> IIS membuat folder W3SVCx setelah permintaan pertama ke situs yang baru dibuat, itu juga menetapkan izin NTFS di atasnya terlepas dari izin folder induk dan pengaturan warisannya. Izin yang ditetapkannya adalah: </p> <pre><code>NT AUTHORITY\\SYSTEM:(OI)(CI)(F)\nBUILTIN\\Administrators:(OI)(CI)(F)\n</code></pre> <p> Saya tidak tahu cara apa pun untuk memberi tahu IIS agar tidak melakukan ini. Anda perlu mengingat bahwa setelah Anda membuat situs baru, tekan sekali dan kemudian atur izin pada folder log. </p>\n\n<p> Jika Anda menyiapkan banyak situs, gunakan skrip sebagai gantinya. Saya menggunakan PowerShell: </p> <pre><code>New-WebSite -Name \"peter.superuser.com\" -port 80 -id 106 -PhysicalPath \"C:\\inetpub\\peter.superuser.com\" -HostHeader peter.superuser.com\n(New-Object System.Net.WebClient).DownloadString(\"http://peter.superuser.com\")\nstart-sleep -seconds 1\n&amp; icacls.exe \"C:\\inetpub\\logs\\LogFiles\\W3SVC106\" /Q /grant \"BUILTIN\\Users:`(OI`)`(CI`)`(RX`)\"\n</code></pre> <p> Saya pertama kali membuat situs, lalu masuk ke halaman beranda, tunggu sebentar, lalu setel izin pada folder log. </p>\n\n<p> Jika Anda tidak mengetahui Id situs sebelumnya, gunakan </p> <pre><code>$newId = (get-childitem IIS:\\Sites | where{$_.Name -eq \"peter.superuser.com\"}).Id\n&amp; icacls.exe \"C:\\inetpub\\logs\\LogFiles\\W3SVC$newId\" /Q /grant \"BUILTIN\\Users:`(OI`)`(CI`)`(RX`)\"\n</code></pre> <p> untuk mendapatkan Id setelah Anda membuat situs. </p>\n\n<p> Untuk menggunakan ini, Anda perlu mengaktifkan skrip untuk IIS, tergantung pada OS Anda. </p>","votes":"3","source":"https://superuser.com/a/630311","author":"<a href=\"https://superuser.com/users/3719/peter-hahndorf\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Peter Hahndorf</span></a>","replies":[{"reply":"Masalah utamanya adalah bahwa ini tidak sepenuhnya benar - IIS membuat folder ini setelah situs dibuat, dan juga secara berkala sejak saat itu penuh. Di server kami, ini membuat folder baru kira-kira sekali sehari, sehingga setiap folder berisi log hari itu. Apakah Anda mengatakan bahwa satu-satunya cara untuk menangani ini adalah menjalankan pekerjaan terjadwal untuk mengubah izin setiap hari?","author":"<a href=\"https://superuser.com/users/241979/sean-worle\" target=\"_blank\" rel=\"nofollow noopener\">Sean Worle</a>"},{"reply":"@ Sean - Versi IIS apa yang Anda gunakan. Setidaknya pada 8, folder tersebut tidak dibuat saat Anda membuat situs tetapi setelah klik pertama di situs tersebut. Izin pada folder itu tidak diubah lagi. Hanya ada satu folder per situs. Secara default, file baru dibuat setiap hari. Bagaimana folder bisa penuh? Anda dapat mengubah &#39;Log File Rollover&#39; dari &#39;Schedule&#39; menjadi &#39;Max file size&#39;. Saya belum melakukannya tetapi saya ragu ini akan mengubah perilaku umum penebangan.","author":"<a href=\"https://superuser.com/users/3719/peter-hahndorf\" target=\"_blank\" rel=\"nofollow noopener\">Peter Hahndorf</a>"},{"reply":"Kami menggunakan IIS 7.5. Sepertinya saya salah - Anda mengatakan bahwa folder tersebut hanya dibuat saat situs pertama kali terkena. Itu bisa menjadi sumber kesalahpahaman bahwa folder-folder ini terus dibuat. Ini sedikit pekerjaan ekstra yang harus dilakukan saat kami membuat situs, tetapi selama situs tidak terus dibuat, itu mungkin tidak masalah. Terima kasih.","author":"<a href=\"https://superuser.com/users/241979/sean-worle\" target=\"_blank\" rel=\"nofollow noopener\">Sean Worle</a>"}]},{"answer":"<p> Saya menggunakan solusi berikut pada instalasi IIS 7/8 baru: </p>\n\n<ol>\n<li><p> Tetapkan izin yang diinginkan pada folder <code>C:\\inetpub\\logs\\LogFiles</code> </p></li>\n<li><p> Ubah folder log yang ada untuk mewarisi izin </p> <pre><code>icacls C:\\inetpub\\logs\\LogFiles\\W3SVC* /inheritance:e\n</code></pre> </li>\n<li><p> Pra-isi 99 folder log pertama <code>W3SVC1</code> ... <code>W3SVC99</code> sehingga mereka mewarisi izin bahkan sebelum IIS mencoba membuat salah satunya. IIS tidak mengubah izin ketika folder log sudah ada. </p> <pre><code>REM cmd style\nfor /l %%G in (1,1,99) do md C:\\inetpub\\logs\\LogFiles\\W3SVC%%G\n\n# PowerShell style\n1..3 | % { md C:\\inetpub\\logs\\LogFiles\\W3SVC$_ }   \n</code></pre> </li>\n</ol>\n\n<p> Tidak cantik, tapi menyelesaikan pekerjaan. </p>","votes":"3","source":"https://superuser.com/a/719464","author":"<a href=\"https://superuser.com/users/77310/oleschri\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">oleschri</span></a>","replies":[]},{"answer":"<p> Saya membuat situs saya menggunakan Powershell, jadi saya menambahkan yang berikut ini untuk membuat folder yang tepat berdasarkan ID Situs. </p> <pre><code>Import-Module WebAdministration\n$iisAppName = \"MySite\"\n$site = Get-ItemProperty IIS:\\Sites\\$iisAppName\n$folderName = \"W3SVC\" + $site.id    #Create a folder based on the actual site id\n$iisLogPath = \"C:\\MyLogFolder\"\n$folderPath = Join-Path $iisLogPath $folderName\nNew-Item -Path $folderPath -ItemType directory\n</code></pre>","votes":"0","source":"https://superuser.com/a/1083889","author":"<a href=\"https://superuser.com/users/134810/robert-brooker\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Robert Brooker</span></a>","replies":[]}]}
