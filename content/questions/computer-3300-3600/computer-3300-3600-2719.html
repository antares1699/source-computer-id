{"title":"Membedakan antara pengguna yang terhubung melalui ssh","draft":false,"url":"/membedakan-antara-pengguna-yang-terhubung-melalui-ssh-ye7je9ie","votes":"4","answers_count":"3","categories":["Komputer"],"tags":["ubuntu","ssh","login"],"snippet":"Rekan saya dan saya sama-sama ssh ke server ubuntu pekerjaan kami, sebagai pengguna &quot;deploy&quot; yang sama, menggunakan login kunci. Di konsol aplikasi rel kami, kami memiliki perangkat lunak yang mencatat siapa yang...","body":"<p> Rekan saya dan saya sama-sama ssh ke server ubuntu pekerjaan kami, sebagai pengguna &quot;deploy&quot; yang sama, menggunakan login kunci. Di konsol aplikasi rel kami, kami memiliki perangkat lunak yang mencatat siapa yang membuat perubahan, tetapi tidak dapat membedakan antara kami: ia hanya melihat pengguna penerapan. Adakah cara untuk membedakan kita? apakah sistem mencatat kunci mana yang digunakan untuk masuk? Itu bisa contoh hal yang bisa saya kaitkan untuk mengetahui siapa di antara kita yang benar-benar masuk. </p>\n\n<p> Perhatikan bahwa ini bukan pertanyaan keamanan: jika kami berdua harus melakukan sesuatu yang sedikit berbeda untuk membuat ini berhasil, kami berdua akan melakukannya. </p>\n\n<p> Jawaban yang paling jelas adalah &quot;Jangan keduanya masuk sebagai pengguna &#39;terapkan&#39;&quot;, dan itu memang akan memperbaikinya. Tapi kami tidak ingin melakukan itu. </p>\n\n<p> terima kasih, maks </p>","source":"https://superuser.com/questions/722766/distinguishing-between-users-connecting-via-ssh","author":"<a href=\"https://superuser.com/users/60790/max-williams\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Max Williams</span></a>","replies":[],"answers":[{"answer":"<p> Perhatikan bahwa Anda dapat menentukan opsi setelah setiap kunci di authorized_keys. Mungkin gunakan opsi <code>environment=\"NAME=value\"</code> dan tetapkan variabel umum ke nilai yang berbeda untuk setiap kunci. Variabel ini kemudian dapat digunakan untuk menyetel prompt bash dan digunakan dalam skrip. </p>\n\n<p> Berikut ini adalah bagian yang relevan dari <code>man sshd</code>: </p> <pre><code>AUTHORIZED_KEYS FILE FORMAT\n     AuthorizedKeysFile specifies the files containing public keys for public\n     key authentication; if none is specified, the default is\n     ~/.ssh/authorized_keys and ~/.ssh/authorized_keys2.  Each line of the\n     file contains one key (empty lines and lines starting with a ‘#’ are\n     ignored as comments).  Protocol 1 public keys consist of the following\n     space-separated fields: options, bits, exponent, modulus, comment.  Pro‐\n     tocol 2 public key consist of: options, keytype, base64-encoded key, com‐\n     ment.  The options field is optional; its presence is determined by\n     whether the line starts with a number or not (the options field never\n     starts with a number).  The bits, exponent, modulus, and comment fields\n     give the RSA key for protocol version 1; the comment field is not used\n     for anything (but may be convenient for the user to identify the key).\n     For protocol version 2 the keytype is “ecdsa-sha2-nistp256”,\n     “ecdsa-sha2-nistp384”, “ecdsa-sha2-nistp521”, “ssh-dss” or “ssh-rsa”.\n\n     Note that lines in this file are usually several hundred bytes long\n     (because of the size of the public key encoding) up to a limit of 8 kilo‐\n     bytes, which permits DSA keys up to 8 kilobits and RSA keys up to 16\n     kilobits.  You don't want to type them in; instead, copy the\n     identity.pub, id_dsa.pub, id_ecdsa.pub, or the id_rsa.pub file and edit\n     it.\n\n     sshd enforces a minimum RSA key modulus size for protocol 1 and protocol\n     2 keys of 768 bits.\n\n     The options (if present) consist of comma-separated option specifica‐\n     tions.  No spaces are permitted, except within double quotes.  The fol‐\n     lowing option specifications are supported (note that option keywords are\n     case-insensitive):\n\n     cert-authority\n             Specifies that the listed key is a certification authority (CA)\n             that is trusted to validate signed certificates for user authen‐\n             tication.\n\n             Certificates may encode access restrictions similar to these key\n             options.  If both certificate restrictions and key options are\n             present, the most restrictive union of the two is applied.\n\n     command=\"command\"\n             Specifies that the command is executed whenever this key is used\n             for authentication.  The command supplied by the user (if any) is\n             ignored.  The command is run on a pty if the client requests a\n             pty; otherwise it is run without a tty.  If an 8-bit clean chan‐\n             nel is required, one must not request a pty or should specify\n             no-pty.  A quote may be included in the command by quoting it\n             with a backslash.  This option might be useful to restrict cer‐\n             tain public keys to perform just a specific operation.  An exam‐\n             ple might be a key that permits remote backups but nothing else.\n             Note that the client may specify TCP and/or X11 forwarding unless\n             they are explicitly prohibited.  The command originally supplied\n             by the client is available in the SSH_ORIGINAL_COMMAND environ‐\n             ment variable.  Note that this option applies to shell, command\n             or subsystem execution.  Also note that this command may be\n             superseded by either a sshd_config(5) ForceCommand directive or a\n             command embedded in a certificate.\n\n     environment=\"NAME=value\"\n             Specifies that the string is to be added to the environment when\n             logging in using this key.  Environment variables set this way\n             override other default environment values.  Multiple options of\n             this type are permitted.  Environment processing is disabled by\n             default and is controlled via the PermitUserEnvironment option.\n             This option is automatically disabled if UseLogin is enabled.\n\n     from=\"pattern-list\"\n             Specifies that in addition to public key authentication, either\n             the canonical name of the remote host or its IP address must be\n             present in the comma-separated list of patterns.  See PATTERNS in\n             ssh_config(5) for more information on patterns.\n\n             In addition to the wildcard matching that may be applied to host‐\n             names or addresses, a from stanza may match IP addresses using\n             CIDR address/masklen notation.\n\n             The purpose of this option is to optionally increase security:\n             public key authentication by itself does not trust the network or\n             name servers or anything (but the key); however, if somebody\n             somehow steals the key, the key permits an intruder to log in\n             from anywhere in the world.  This additional option makes using a\n             stolen key more difficult (name servers and/or routers would have\n             to be compromised in addition to just the key).\n\n     no-agent-forwarding\n             Forbids authentication agent forwarding when this key is used for\n             authentication.\n\n     no-port-forwarding\n             Forbids TCP forwarding when this key is used for authentication.\n             Any port forward requests by the client will return an error.\n             This might be used, e.g. in connection with the command option.\n\n     no-pty  Prevents tty allocation (a request to allocate a pty will fail).\n\n     no-user-rc\n             Disables execution of ~/.ssh/rc.\n\n     no-X11-forwarding\n             Forbids X11 forwarding when this key is used for authentication.\n             Any X11 forward requests by the client will return an error.\n\n     permitopen=\"host:port\"\n             Limit local ``ssh -L'' port forwarding such that it may only con‐\n             nect to the specified host and port.  IPv6 addresses can be spec‐\n             ified by enclosing the address in square brackets.  Multiple\n             permitopen options may be applied separated by commas.  No pat‐\n             tern matching is performed on the specified hostnames, they must\n             be literal domains or addresses.\n\n     principals=\"principals\"\n             On a cert-authority line, specifies allowed principals for cer‐\n             tificate authentication as a comma-separated list.  At least one\n             name from the list must appear in the certificate's list of prin‐\n             cipals for the certificate to be accepted.  This option is\n             ignored for keys that are not marked as trusted certificate sign‐\n             ers using the cert-authority option.\n\n     tunnel=\"n\"\n             Force a tun(4) device on the server.  Without this option, the\n             next available device will be used if the client requests a tun‐\n             nel.\n\n     An example authorized_keys file:\n\n        # Comments allowed at start of line\n        ssh-rsa AAAAB3Nza...LiPk== user@example.net\n        from=\"*.sales.example.net,!pc.sales.example.net\" ssh-rsa\n        AAAAB2...19Q== john@example.net\n        command=\"dump /home\",no-pty,no-port-forwarding ssh-dss\n        AAAAC3...51R== example.net\n        permitopen=\"192.0.2.1:80\",permitopen=\"192.0.2.2:25\" ssh-dss\n        AAAAB5...21S==\n        tunnel=\"0\",command=\"sh /etc/netstart tun0\" ssh-rsa AAAA...==\n        jane@example.net\n</code></pre>","votes":"5","source":"https://superuser.com/a/722784","author":"<a href=\"https://superuser.com/users/44887/dan-d\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Dan D.</span></a>","replies":[{"reply":"aha - ya. kunci yang sudah saya miliki di kunci resmi terlihat seperti ini: <code>ssh-rsa &lt;long string of chars&gt; max@max-thinkpad-linux</code>. (<code>max@max-thinkpad-linux</code> masing-masing adalah nama pengguna lokal dan nama komputer lokal saya). Dapatkah saya membaca <code>max@max-thinkpad-linux</code> dari lingkungan? jika tidak, maka saya dapat menambahkan pasangan nama-nilai ekstra ke entri saya dan kolega saya di kunci resmi - nonaktifkan untuk mencobanya sekarang!","author":"<a href=\"https://superuser.com/users/60790/max-williams\" target=\"_blank\" rel=\"nofollow noopener\">Max Williams</a>"},{"reply":"Oke - sejauh ini saya tidak bisa menjalankannya. Saya menambahkan <code>environment=&quot;RAILS_USER_ID=1182&quot;</code> di akhir entri saya pada <code>.ssh&#47;authorized_keys</code> di server. Saya kemudian keluar dan terhubung lagi dengan ssh. Saya kemudian melakukan <code>echo $RAILS_USER_ID</code> dan tidak mendapatkan apa-apa kembali. (Saya juga mencoba menambahkannya ke kunci rsa.pub lokal saya juga, tidak ada kegembiraan). Apakah saya salah paham?","author":"<a href=\"https://superuser.com/users/60790/max-williams\" target=\"_blank\" rel=\"nofollow noopener\">Max Williams</a>"},{"reply":"Opsi diletakkan sebelum kunci di awal baris, bukan setelah di akhir. Lihat contohnya.","author":"<a href=\"https://superuser.com/users/44887/dan-d\" target=\"_blank\" rel=\"nofollow noopener\">Dan D.</a>"},{"reply":"ah, saya mohon maaf. Terima kasih. Oke, saya memindahkannya ke awal, dan sekarang saya tidak bisa masuk: saya mendapatkan <code>Permission denied (publickey,keyboard-interactive).</code>. Saya mengedit file id_rsa.pub lokal saya agar sama dengan entri authorized_keys di server: keduanya <code>environment=&quot;RAILS_USER_ID=1182&quot; ssh-rsa &lt;long string of chars&gt; max@max-thinkpad-linux</code>. Apakah saya perlu melakukan sesuatu yang lain ketika saya memperbarui entri kunci saya seperti ini?","author":"<a href=\"https://superuser.com/users/60790/max-williams\" target=\"_blank\" rel=\"nofollow noopener\">Max Williams</a>"},{"reply":"Btw, saya tetap membuka tab lain di server jadi saya masih memiliki akses meskipun saya terkunci di tab pengujian saya :)","author":"<a href=\"https://superuser.com/users/60790/max-williams\" target=\"_blank\" rel=\"nofollow noopener\">Max Williams</a>"},{"reply":"Ups, baru saja melihat ini: <code>Environment processing is disabled by default</code>","author":"<a href=\"https://superuser.com/users/60790/max-williams\" target=\"_blank\" rel=\"nofollow noopener\">Max Williams</a>"},{"reply":"Saya baru saja mengedit (di server) <code>&#47;etc&#47;ssh&#47;sshd_config</code> dan menambahkan <code>PermitUserEnvironment yes</code>, lalu mencoba lagi, dan saya masih terkunci.","author":"<a href=\"https://superuser.com/users/60790/max-williams\" target=\"_blank\" rel=\"nofollow noopener\">Max Williams</a>"},{"reply":"Doh, saya bodoh - saya lupa memulai ulang sshd setelah melakukan perubahan konfigurasi. Selesai dan berhasil. Terima kasih!","author":"<a href=\"https://superuser.com/users/60790/max-williams\" target=\"_blank\" rel=\"nofollow noopener\">Max Williams</a>"}]},{"answer":"<p> OpenSSH menetapkan beberapa variabel lingkungan yang mungkin dapat Anda gunakan, tetapi hanya jika alamat IP klien berguna bagi Anda. Secara khusus, <code>SSH_CLIENT</code> diatur ke alamat IP sistem klien dan nomor port yang digunakan. </p>","votes":"1","source":"https://superuser.com/a/722768","author":"<a href=\"https://superuser.com/users/203009/flup\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Flup</span></a>","replies":[{"reply":"Saya tidak yakin apakah itu akan berhasil: kami berdua terhubung dari kantor kami, jadi akan memiliki ip yang sama sejauh menyangkut server. AFAIK ssh selalu menggunakan port 22 bukan?","author":"<a href=\"https://superuser.com/users/60790/max-williams\" target=\"_blank\" rel=\"nofollow noopener\">Max Williams</a>"},{"reply":"Sebenarnya tahukah kamu apa angka kedua di SSH_CLIENT itu? Saya mendapatkan misalnya <code>&lt;ip address&gt; 35568 22</code> - apa itu 35568?","author":"<a href=\"https://superuser.com/users/60790/max-williams\" target=\"_blank\" rel=\"nofollow noopener\">Max Williams</a>"},{"reply":"Ah, cukup adil. ssh memang menggunakan port 22 secara default, tetapi <code>SSH_CLIENT</code> juga berisi nomor port sementara di ujung lainnya. Sayangnya, itu tidak membantu Anda!","author":"<a href=\"https://superuser.com/users/203009/flup\" target=\"_blank\" rel=\"nofollow noopener\">Flup</a>"},{"reply":"ah - saya pikir kami baru saja memposting pada saat yang sama :) apakah nomor kedua adalah &quot;nomor port sementara&quot;?","author":"<a href=\"https://superuser.com/users/60790/max-williams\" target=\"_blank\" rel=\"nofollow noopener\">Max Williams</a>"},{"reply":"Ya - itu adalah nomor yang dialokasikan oleh OS klien yang mengikat proses ssh. Ini adalah bagaimana OS mengetahui proses mana untuk merutekan kembali paket balasan.","author":"<a href=\"https://superuser.com/users/203009/flup\" target=\"_blank\" rel=\"nofollow noopener\">Flup</a>"},{"reply":"Anda mungkin dapat melakukan sesuatu yang cerdas dengan <code>netstat -anp | grep &lt;ephemeral port number&gt;</code>, lalu menghubungkan PID yang memiliki porta tersebut dengan pengguna. Yuck :)","author":"<a href=\"https://superuser.com/users/203009/flup\" target=\"_blank\" rel=\"nofollow noopener\">Flup</a>"},{"reply":"Masuk akal (nomor port sementara) - terima kasih atas infonya. Pendekatan netstat memang tampak sedikit menjijikkan, ya :)","author":"<a href=\"https://superuser.com/users/60790/max-williams\" target=\"_blank\" rel=\"nofollow noopener\">Max Williams</a>"}]},{"answer":"<p> Apakah Anda menyadari peluang yang ditawarkan sudo?\nApakah sudo cukup keren untuk meyakinkan Anda untuk tidak menggunakan akun yang sama?\nDengan log sudo Anda dapat merekam dengan tepat apa yang dilakukan satu sama lain. </p>\n\n<p> Anda masing-masing dapat terhubung dengan akun pengguna Anda sendiri dan kemudian menggunakan <code>sudo -u deploy /yoursoftware/command param1 param2</code> </p>\n\n<p> Kemudian di log sudo Anda, Anda akan melihat sesuatu seperti </p> <pre><code>Feb 28 xy:22:47 yourHost sudo:   MaxWilliams: TTY=pts/0 ; PWD=/mount/yourCWD ; USER=deploy; COMMAND=/yourSoftware/command param1 param2\n</code></pre> <p> Saya membayangkan, Anda dapat mengatur ini untuk dijalankan menggunakan kunci login. Saya berasumsi Anda menjalankan perintah dari jarak jauh dan tidak benar-benar masuk saat pengguna menyebarkan. Jika demikian, Anda perlu memperluas jawaban ini. </p>","votes":"1","source":"https://superuser.com/a/722777","author":"<a href=\"https://superuser.com/users/301056/unlimitedinfinity\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">UnlimitedInfinity</span></a>","replies":[{"reply":"Hai - kami berdua terhubung sebagai pengguna penerapan, dengan <code>ssh deploy@hostname</code>.","author":"<a href=\"https://superuser.com/users/60790/max-williams\" target=\"_blank\" rel=\"nofollow noopener\">Max Williams</a>"},{"reply":"@ Max Williams saya mengerti. Namun, Anda meminta sshd untuk melakukan pekerjaan yang sudo telah dikembangkan. Meskipun Dan D. tampaknya telah menemukan trik agar sshd melakukan apa yang Anda inginkan.","author":"<a href=\"https://superuser.com/users/301056/unlimitedinfinity\" target=\"_blank\" rel=\"nofollow noopener\">UnlimitedInfinity</a>"}]}]}
