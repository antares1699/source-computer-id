{"title":"Menggunakan sed untuk memadatkan array JSON","draft":false,"url":"/menggunakan-sed-untuk-memadatkan-array-json-w2pznagf","votes":"4","answers_count":"1","categories":["Komputer"],"tags":["linux","ubuntu","sed","awk","json"],"snippet":"Saya memiliki keluaran JSON dalam format berikut:  {  \"DaysCfg\": {    \"Range\": {      \"lowerDate\": \"2017-07-28T00:00:00.000-04:00\",      \"upperDate\": \"2017-08-04T00:00:00.000-04:00\"    },    \"DaysInPeriod\": 8,    \"DaysToSchedule\": [      0,      1,      2,      3,      4,      5,      6    ]  },  \"DepartmentsID\": [...","body":"<p> Saya memiliki keluaran JSON dalam format berikut: </p> <pre><code>{\n  \"DaysCfg\": {\n    \"Range\": {\n      \"lowerDate\": \"2017-07-28T00:00:00.000-04:00\",\n      \"upperDate\": \"2017-08-04T00:00:00.000-04:00\"\n    },\n    \"DaysInPeriod\": 8,\n    \"DaysToSchedule\": [\n      0,\n      1,\n      2,\n      3,\n      4,\n      5,\n      6\n    ]\n  },\n  \"DepartmentsID\": [\n    138837,\n    139734,\n    141934,\n    142436,\n    149687,\n    151049\n  ],\n  \"EmployeesID\": [\n    5039,\n    5170,\n    5889,\n    6051,\n    6236,\n    7208,\n    7281,\n    8776,\n    8781,\n    8936,\n    9261\n  ],\n  \"EndDate\": \"2017-08-03T23:59:00.000-04:00\",\n  \"IntervalSize\": 15,\n  \"IsActivitiesEnabled\": true,\n  \"ModifyExisting\": false,\n  \"OrignId\": 134721,\n  \"PrimaryOption\": 0,\n  \"SchoolDays\": [],\n  \"ScChanges\": [],\n  \"StartDate\": \"2017-07-28T00:00:00.000-04:00\",\n  \"ZonesToSchedule\": [\n    5,\n    4,\n    6,\n    3,\n    3,\n    3,\n    2,\n    14\n  ]\n}\n</code></pre> <p> Karena saya tidak dapat mengubah program yang mengeluarkannya, saya harus menggunakan <code>sed</code> (atau <code>awk</code>) untuk memadatkan array JSON sendiri. Output yang diinginkan adalah: </p> <pre><code>{\n  \"DaysCfg\": {\n    \"Range\": {\n      \"lowerDate\": \"2017-07-28T00:00:00.000-04:00\",\n      \"upperDate\": \"2017-08-04T00:00:00.000-04:00\"\n    },\n    \"DaysInPeriod\": 8,\n    \"DaysToSchedule\": [0, 1, 2, 3, 4, 5, 6]\n  },\n  \"DepartmentsID\": [138837, 139734, 141934, 142436, 149687, 151049],\n  \"EmployeesID\": [5039, 5170, 5889, 6051, 6236, 7208, 7281, 8776, 8781, 8936, 9261],\n  \"EndDate\": \"2017-08-03T23:59:00.000-04:00\",\n  \"IntervalSize\": 15,\n  \"IsActivitiesEnabled\": true,\n  \"ModifyExisting\": false,\n  \"OrignId\": 134721,\n  \"PrimaryOption\": 0,\n  \"SchoolDays\": [],\n  \"ScChanges\": [],\n  \"StartDate\": \"2017-07-28T00:00:00.000-04:00\",\n  \"ZonesToSchedule\": [5, 4, 6, 3, 3, 3, 2, 14]\n}\n</code></pre> <p> Saya telah mencoba membuat skrip <code>sed</code> sendiri, tetapi hanya setengah matang dan tidak berfungsi sepenuhnya: </p> <pre><code>sed -r -e :a -e '/^ *[]}],*$/!N; /\": \\[/s/\\n +//; ta' -e 'P;D'\n</code></pre> <p> Tolong bantu. Terima kasih. </p>","source":"https://superuser.com/questions/1235487/using-sed-to-compact-json-arrays","author":"<a href=\"https://superuser.com/users/203539/xpt\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">xpt</span></a>","replies":[{"reply":"Saya pikir <code>sed</code> bukanlah alat terbaik untuk masalah ini. Anda harus mencoba beberapa JSON-parser / formatter, misalnya <code>jq</code> ( <a href=\"https://stedolan.github.io/jq/\" rel=\"nofollow noopener\" target=\"_blank\"> stedolan.github.io/jq </a> ). Mungkin Anda ingin memeriksanya <a href=\"https://stackoverflow.com/questions/9105031/how-to-beautify-json-in-python-or-through-command-line\" title=\"how to beautify json in python or through command line\" target=\"_blank\" rel=\"nofollow noopener\"> stackoverflow.com/questions/9105031/… </a> dan <a href=\"https://stackoverflow.com/questions/352098/how-can-i-pretty-print-json-in-unix-shell-script\" title=\"how can i pretty print json in unix shell script\" target=\"_blank\" rel=\"nofollow noopener\"> stackoverflow.com/questions/352098/… </a>","author":"<a href=\"https://superuser.com/users/99959/uzsolt\" target=\"_blank\" rel=\"nofollow noopener\">uzsolt</a>"},{"reply":"FYI, output yang ingin saya kerjakan, dibuat persis oleh <code>jq</code>, program <code>C</code>, jadi saya tidak tertarik dengan solusi Python apa pun. @uz. Apa yang Anda lihat di sini hanyalah representasi terpilih dari 4 ~ 6 juta keluaran yang saya miliki. Jika Anda tidak memahami perintah <code>sed</code> di atas, maka tidak pantas bagi Anda untuk membuat penilaian apakah <code>sed</code> adalah alat terbaik atau bukan.","author":"<a href=\"https://superuser.com/users/203539/xpt\" target=\"_blank\" rel=\"nofollow noopener\">xpt</a>"},{"reply":"Jadi, sebenarnya apa yang kamu inginkan? Anda ingin menghapus &#39;\\ n&#39; (setelah koma) <i> jika </i> kita berada di dalam tanda kurung (<code>[</code> dan <code>]</code>). Jika Anda ingin melakukannya dengan <code>sed</code> lakukan saja! Bukan tidak mungkin tetapi &quot;FYI&quot; ada alat yang lebih baik. Saya ingin tahu tentang solusi <code>sed</code> cara. Lakukan! (Seseorang tidak menyukai pertanyaan Anda - FYI bukan saya)","author":"<a href=\"https://superuser.com/users/99959/uzsolt\" target=\"_blank\" rel=\"nofollow noopener\">uzsolt</a>"},{"reply":"Terima kasih atas masukannya @uzsolt. Oke, saya mengerti. Saya akan melupakan <code>sed</code> dan melakukannya pada <code>awk</code> nanti.","author":"<a href=\"https://superuser.com/users/203539/xpt\" target=\"_blank\" rel=\"nofollow noopener\">xpt</a>"},{"reply":"Pemungutan suara tidak menunjukkan apa-apa kecuali ada orang yang berpikiran sempit dan jahat di alam liar. Saya akan melakukannya pada <code>awk</code> dan memposting kembali.","author":"<a href=\"https://superuser.com/users/203539/xpt\" target=\"_blank\" rel=\"nofollow noopener\">xpt</a>"},{"reply":"Saya pikir <code>awk</code> lebih baik <i> pada kasus ini </i> :)","author":"<a href=\"https://superuser.com/users/99959/uzsolt\" target=\"_blank\" rel=\"nofollow noopener\">uzsolt</a>"}],"answers":[{"answer":"<p> Saya mengedit sed Anda, semoga ini membantu. </p> <pre><code>sed -r '/\\[$/ {:a;N;s/\\]/&amp;/;Ta;s/\\n +//g}'\n\nsed -r '\n\n# sed will apply the commands between '{}' only to lines that matches the address '/\\[$/'.\n/\\[$/ {\n\n# Set a mark with label 'a'.\n:a\n\n# N command, it appends a '\\n' to the pattern space,\n# reads the next line of the input (file,stdin) and appends it to the pattern space.\nN\n\n# Substitute ']' for itself. If the substitution isn't made (if there isn't a ']' on the\n# pattern space), the 'T' command jumps to the 'a' label.\n# Here is the loop to put some lines (or all lines of a file) in the same line.\n# While there isn't a ']' in the pattern space (which is the last line OP wants to put\n# on the same line), sed will append '\\n&lt;next line&gt;' to the pattern space.\ns/\\]/&amp;/\nTa\n\n# When the substitution is made, sed leaves the loop and applies other commands.\n# Substitute all occurrences (g flag) of new line character (with any\n# spaces after) for nothing.\ns/\\n +//g\n}'\n</code></pre>","votes":"6","source":"https://superuser.com/a/1236009","author":"<a href=\"https://superuser.com/users/597091/paulo\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Paulo</span></a>","replies":[{"reply":"YA TUHAN! Itu luar biasa. Saya telah dibujuk oleh orang-orang untuk menyerah pada <code>sed</code>, tetapi jauh di lubuk hati saya, saya masih percaya <code>sed</code> dapat melakukannya, dan ... BANG! inilah solusi sederhana Anda yang luar biasa, yang bekerja dengan sempurna !!! Silakan gunakan total +50 poin saya sebagai sambutan hangat untuk pengguna super!","author":"<a href=\"https://superuser.com/users/203539/xpt\" target=\"_blank\" rel=\"nofollow noopener\">xpt</a>"},{"reply":"Saya rasa saya mengerti hampir semuanya, tetapi bagaimana loop berakhir. Maukah Anda menjelaskan lebih lanjut?","author":"<a href=\"https://superuser.com/users/203539/xpt\" target=\"_blank\" rel=\"nofollow noopener\">xpt</a>"},{"reply":"Sekarang saya berharap saya mendapatkan lebih banyak suara negatif untuk pertanyaan ini - jelas mereka tidak memberikan suara negatif karena mereka tidak percaya akan ada solusi <code>sed</code>, <i> bahkan dalam imajinasi terliar mereka </i> . Bagi semua orang itu, jawaban luar biasa ini menunjukkan betapa sempitnya Anda di wajah Anda.","author":"<a href=\"https://superuser.com/users/203539/xpt\" target=\"_blank\" rel=\"nofollow noopener\">xpt</a>"},{"reply":"Saya hanya dapat memberikan hadiah +50 saya dalam 23 jam, jadi ambil +25 poin saya untuk saat ini.","author":"<a href=\"https://superuser.com/users/203539/xpt\" target=\"_blank\" rel=\"nofollow noopener\">xpt</a>"},{"reply":"Saya menemukan jawabannya sendiri dari pria <code>T label</code>: &quot; <i> Jika tidak ada <code>s&#47;&#47;&#47;</code> yang berhasil melakukan substitusi sejak baris input terakhir dibaca dan sejak perintah <code>t</code> atau <code>T</code> terakhir, maka percabangkan ke label </i> &quot;","author":"<a href=\"https://superuser.com/users/203539/xpt\" target=\"_blank\" rel=\"nofollow noopener\">xpt</a>"},{"reply":"Maaf, saya tidak tahu banyak cara kerja &quot;poin-poin&quot; tapi terima kasih banyak untuk poinnya. Akhirnya saya punya cukup poin untuk dikomentari :) terima kasih. Ya, Anda benar, perintah &#39;T&#39; melakukan tugas untuk melompat ke label &#39;a&#39; jika tidak ada &#39;]&#39; di ruang pola. Semua perintah diterapkan hanya jika sed menemukan baris dengan alamat &#39;/ [$ /&#39;, baris lain dicetak tanpa edisi apa pun.","author":"<a href=\"https://superuser.com/users/597091/paulo\" target=\"_blank\" rel=\"nofollow noopener\">Paulo</a>"},{"reply":"Jawaban bagus, tapi saya sarankan Anda menambahkan bagian penjelasan dengan rincian perintah untuk menggambarkan cara kerjanya. Tampaknya Anda menggunakan beberapa fungsionalitas <code>sed</code> yang tidak semua orang kenal.","author":"<a href=\"https://superuser.com/users/700617/simlev\" target=\"_blank\" rel=\"nofollow noopener\">simlev</a>"},{"reply":"Meskipun ini mungkin menjawab pertanyaan, akan menjadi jawaban yang lebih baik jika Anda dapat memberikan penjelasan <b> Mengapa </b> ia melakukannya.","author":"<a href=\"https://superuser.com/users/337631/davidpostill\" target=\"_blank\" rel=\"nofollow noopener\">DavidPostill&#9830;</a>"},{"reply":"Diedit untuk menambahkan penjelasan. Lihat &#39;info sed&#39; untuk perintah GNU-sed. ps- maafkan saya untuk kesalahan bahasa Inggris.","author":"<a href=\"https://superuser.com/users/597091/paulo\" target=\"_blank\" rel=\"nofollow noopener\">Paulo</a>"}]}]}
