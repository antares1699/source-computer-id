{"title":"Bagaimana NAT bekerja untuk protokol non-standar atau tidak umum (atau mentah)","draft":false,"url":"/bagaimana-nat-bekerja-untuk-protokol-non-standar-atau-tidak-umum-atau-mentah-d7moiizd","votes":"4","answers_count":"2","categories":["Komputer"],"tags":["nat"],"snippet":"Untuk info port pengguna TCP dan UDP NAT. Untuk protokol lain seperti ICMP dapat menggunakan trik khusus protokol. Apa yang terjadi jika protokol IP yang digunakan tidak dipenuhi atau dikenali?  Bisakah paket...","body":"<p> Untuk info port pengguna TCP dan UDP NAT. Untuk protokol lain seperti ICMP dapat menggunakan trik khusus protokol. Apa yang terjadi jika protokol IP yang digunakan tidak dipenuhi atau dikenali? </p>\n\n<p> Bisakah paket seperti itu bahkan meninggalkan antarmuka target? Jika ya, apa yang terjadi? Apakah IP sumber baru saja diubah? Apa yang terjadi dalam perjalanan pulang? Apakah mungkin paket pengembalian bisa masuk ke ip yang salah? Bahkan mungkin <em> semua </em> ips tersedia? </p>","source":"https://superuser.com/questions/1108210/how-does-nat-work-for-non-standard-or-uncommon-protocols-or-raw-up","author":"<a href=\"https://superuser.com/users/624557/andrew-parker\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Andrew Parker</span></a>","replies":[],"answers":[{"answer":"<blockquote>\n  <p> Untuk info port pengguna TCP dan UDP NAT. Untuk protokol lain seperti ICMP dapat menggunakan trik khusus protokol. </p>\n</blockquote>\n\n<p> Nah, TCP dan UDP yang sama <em> adalah </em> juga &quot;trik khusus protokol&quot; - semuanya tidak berbeda dengan &quot;ID permintaan&quot; ICMP Echo, atau &quot;SPI&quot; IPsec. (NAT sendiri adalah &#39;trik&#39;.) </p>\n\n<blockquote>\n  <p> Bisakah paket seperti itu bahkan meninggalkan antarmuka target? Jika ya, apa yang terjadi? Apakah IP sumber baru saja diubah? </p>\n</blockquote>\n\n<p> Biasanya ya. Kebanyakan NAT akan melewati paket tersebut meskipun mereka tidak mengenali protokol dalam, karena masih memiliki peluang lebih besar untuk bekerja daripada &quot;lepaskan semuanya&quot;. </p>\n\n<blockquote>\n  <p> Apa yang terjadi dalam perjalanan pulang? </p>\n</blockquote>\n\n<p> Tergantung pada apakah NAT benar-benar melacak paket keluar. (Ini bervariasi.) </p>\n\n<p> Meskipun NAT tidak memahami cara mengekstrak port atau ID dari protokol dalam, NAT masih dapat melacak <em> jenis protokol </em> , yang mungkin cukup untuk beberapa situasi. (Setiap paket IP memiliki bidang jenis protokol, jadi yang Anda sebut &quot;IP mentah&quot; hanyalah kasus &quot;jenis protokol IP tidak dikenal&quot;.) </p>\n\n<p> Misalnya, koneksi TCP (protokol IP 6) dan Ping ICMP (protokol IP 1, ICMP tipe 8) akan dilacak sebagai: </p>\n\n<ul>\n<li> <code>host 192.168.1.2 (as 42.0.2.1) → 62.205.132.12</code>, <code>proto 6</code>, <code>port 21445 → 80</code> </li>\n<li> <code>host 192.168.1.2 (as 42.0.2.1) → 62.205.132.12</code>, <code>proto 1</code>, <code>type 8 code 0 id 1227</code> </li>\n</ul>\n\n<p> Sedangkan protokol yang tidak dikenal seperti a <a href=\"https://en.wikipedia.org/wiki/6in4\" rel=\"nofollow noopener\" target=\"_blank\"> Terowongan 6in4 </a> akan dilacak sebagai: </p>\n\n<ul>\n<li> <code>host 192.168.1.2 (as 42.0.2.1) → 62.205.132.12</code>, <code>proto 41</code>, <code>—</code> </li>\n</ul>\n\n<p> Karena itu, <em> semua </em> paket protokol masuk-41 akan diteruskan kembali ke <code>192.168.1.2</code>. Ini berarti bahwa satu komputer masih dapat menggunakan protokol, tetapi dua komputer sekaligus mungkin tidak bisa. (Sama seperti dengan UDP, <em> beberapa </em> NAT juga memeriksa alamat IP sumber, tetapi banyak yang hanya peduli dengan protokol &amp; port.) </p>\n\n<p> Meskipun saya menggunakan 6in4 pada contoh di atas, hal yang sama juga akan terjadi dengan <em> semua </em> protokol yang tidak dipahami NAT, bahkan jika mereka <em> melakukan </em> memiliki port (misalnya UDP-Lite atau SCTP). </p>\n\n<ul>\n<li> Selain: Jika router Anda kebetulan menjalankan Linux, Anda dapat menjalankan <code>conntrack -L</code> atau <code>cat /proc/net/nf_conntrack</code> untuk melihat semua status yang sedang dilacak. Beberapa router bahkan menampilkan ini di UI web mereka. </li>\n</ul>\n\n<p> Akhirnya, jika NAT <em> tidak </em> simpan semua status, maka paket diasumsikan ditujukan ke router itu sendiri (sama seperti dengan paket masuk yang tidak terlacak lainnya), dan biasanya dijatuhkan ke lantai. </p>\n\n<blockquote>\n  <p> Apakah mungkin paket pengembalian bisa masuk ke ip yang salah? </p>\n</blockquote>\n\n<p> Dalam kasus yang paling sederhana, tidak. Entah NAT dapat mengasosiasikan paket kembali dengan beberapa status yang diketahui, atau tidak bisa, tetapi itu <em> biasa </em> membuat sampah secara acak. (Biasanya.) </p>\n\n<p> Namun, jika dua komputer di belakang LAN mencoba menggunakan protokol yang sama ke host jarak jauh yang sama, maka status mereka <em> bisa </em> konflik. Yang mana yang menang dapat bervariasi - baik status terlama digunakan hingga kedaluwarsa (jadi balasan untuk kedua komputer terus ke yang pertama), atau mereka terus menimpa satu sama lain setiap beberapa saat (yaitu, membalikkan jepit di antara keduanya). Ini adalah situasi di mana NAT dinamis pasti tidak dirancang untuk ... </p>\n\n<blockquote>\n  <p> Mungkin bahkan semua ips tersedia? </p>\n</blockquote>\n\n<p> Tidak. Itu mungkin dalam teori - mis. beberapa orang melakukan ini dengan konfigurasi penerusan port statis untuk Wake-on-LAN - tetapi melakukannya secara default tidak akan terlalu berguna. Jika ada, itu akan membuat LAN Anda lebih rentan terhadap paket palsu. </p>\n\n<p> (Padahal, kebetulan, begitulah sebenarnya cara kerja Ethernet switching - paket untuk MAC yang tidak dikenal dibanjiri melalui semua port fisik.) </p>\n\n<hr>\n\n<p> Sebagai catatan tambahan, ini sebenarnya tidak spesifik untuk NAT IPv4. Pelacakan negara bagian merupakan bagian integral dari a <em> firewall stateful </em> , digunakan oleh IPv4 dan IPv6. Bahkan tanpa NAT / PAT, pelacakan status juga memungkinkan firewall menerima semuanya secara otomatis <em> dikenal </em> paket dan tolak yang tidak dikenal. </p>\n\n<p> Jadi ketika orang mengklaim bahwa &quot;NAT menambahkan keamanan&quot;, mereka sebenarnya berbicara tentang konfigurasi firewall yang biasanya menyertainya (dan dapat digunakan dengan baik tanpa NAT). </p>","votes":"8","source":"https://superuser.com/a/1108226","author":"<a href=\"https://superuser.com/users/1686/user1686\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">user1686</span></a>","replies":[{"reply":"Terima kasih, sangat membantu. Ini menyentuh sebagian besar poin penting yang saya pikirkan. Hal yang paling menarik bagi saya - yang menurut saya mungkin terjadi - adalah konflik dengan dua host yang mencoba menggunakan protokol yang sama. Kasus penggunaan utama yang saya pikirkan adalah koneksi klien ke VPN. Saya khawatir bahwa dalam beberapa situasi (memang, mungkin jarang), paling banter akan ada masalah keandalan dan paling buruk ada potensi celah keamanan. Kedengarannya pemahaman saya tentang NAT cukup bagus dan jika saya perlu mengatakan secara konkret apa yang akan terjadi, saya harus menggali kode kernel.","author":"<a href=\"https://superuser.com/users/624557/andrew-parker\" target=\"_blank\" rel=\"nofollow noopener\">Andrew Parker</a>"},{"reply":"Selain itu, dengan risiko menjadi subjektif, beberapa petunjuk ke sumber kebenaran pasti akan membantu, mis. dokumen linux atau file sumber tertentu.","author":"<a href=\"https://superuser.com/users/624557/andrew-parker\" target=\"_blank\" rel=\"nofollow noopener\">Andrew Parker</a>"},{"reply":"Mungkin ada masalah keandalan dengan PPTP (karena GRE kekurangan port - tetapi PPTP seharusnya sudah mati), dan terkadang dengan IPsec (meskipun sebagian besar klien mendukung NAT-T melalui UDP saat ini). Banyak produk VPN lainnya menjalankan semuanya melalui UDP dan tidak memiliki masalah, meskipun mereka memang perlu sering-sering melakukan ping ke server untuk menghindari kedaluwarsa status.","author":"<a href=\"https://superuser.com/users/1686/user1686\" target=\"_blank\" rel=\"nofollow noopener\">user1686</a>"},{"reply":"Untuk NAT yang diterapkan di Linux, lihat <code>net&#47;netfilter&#47;nf_conntrack*.c</code> (tempat pelacakan status diterapkan) dan alat <code>conntrack</code> (untuk memeriksa dengan tepat status apa yang diketahui saat ini).","author":"<a href=\"https://superuser.com/users/1686/user1686\" target=\"_blank\" rel=\"nofollow noopener\">user1686</a>"}]},{"answer":"<p> NAT adalah topik yang menarik. </p>\n\n<p> Ada tiga jenis NAT: </p>\n\n<ul>\n<li> Statis </li>\n<li> Dinamis </li>\n<li> MENEPUK </li>\n</ul>\n\n<p> PAT adalah yang digunakan sebagian besar router konsumen, jadi mari kita gunakan yang satu itu. </p>\n\n<p> Bayangkan saya memiliki tata letak ini di rumah: </p> <pre><code>Router   192.168.0.1\nPC 1     192.168.0.2\nPC 2     192.168.0.3\nExternal IP 1.1.1.1 (Lets assume I have that one)\n</code></pre> <p> Kedua komputer saya ingin terhubung ke www.superuser.com yang memiliki ip 151.101.65.69. </p>\n\n<p> Saya memuat browser saya di PC1 dan mengetik www.superuser.com dan hal berikut terjadi: </p>\n\n<ul>\n<li> Komputer saya meminta server DNS saya untuk menyelesaikan www.superuser.com menjadi IP </li>\n<li> Server DNS hadir kembali dengan 151.101.65.69 </li>\n<li> Komputer saya membuka nomor port sumber acak, katakanlah 40000 dalam kasus ini. </li>\n<li> Komputer saya Mengirim paket ke 151.101.65.69 dari sumber 192.168.0.2 dan menempatkan nomor urut 1 di atasnya. </li>\n<li> Router mencegat paket itu, dan mengubah sumber dari 192.168.0.2 ke 1.1.1.1 kami dan mencatat bahwa itu berasal dari 192.168.0.2:40000. </li>\n<li> Pengguna super mendapatkan paket tersebut, dan mengirimkan respons ke 1.1.1.1 </li>\n<li> Router menerima respon, melihat nomor urut dan berkata &quot;Aha, itu untuk 192.168.0.2, saya lebih baik mengirimkannya ke port 40000, dia mengharapkannya. </li>\n</ul>\n\n<p> Pada saat yang sama PC 2 dapat pergi ke proses yang sama, tetapi kemungkinan besar akan memilih port yang terpisah. Router menyimpan catatan nomor port ini dan mengacak lalu lintas sesuai kebutuhan ke tujuan yang benar. </p>\n\n<p> Router akan menyimpan tabel seperti ini: </p> <pre><code>Source              Destination\n192.168.0.2:40000   151.101.65.69:80\n192.168.0.3:56944   151.101.65:69:80\n</code></pre> <p> Sekarang Anda bertanya, &quot;Tapi Lister, apa yang terjadi jika nomor port acak yang Anda pilih sudah digunakan? Anda telah merusak Lister sistem!&quot; Tidak apa-apa, router akan menambah nomor port dalam daftarnya ke yang tersedia berikutnya, tetapi akan ingat untuk mengirim kembali informasi pada port yang benar ke PC. </p>","votes":"2","source":"https://superuser.com/a/1108225","author":"<a href=\"https://superuser.com/users/623674/lister\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Lister</span></a>","replies":[{"reply":"Pertanyaannya kebanyakan tentang protokol di mana perangkat NAT <i> tidak tahu </i> bagaimana cara mengekstrak port dari (atau di mana port atau request-ID tidak ada sama sekali).","author":"<a href=\"https://superuser.com/users/1686/user1686\" target=\"_blank\" rel=\"nofollow noopener\">user1686</a>"},{"reply":"Ahh ya, saya telah menulis jawaban yang bagus untuk pertanyaan yang sedikit salah melihat jawaban Anda.","author":"<a href=\"https://superuser.com/users/623674/lister\" target=\"_blank\" rel=\"nofollow noopener\">Lister</a>"}]}]}
