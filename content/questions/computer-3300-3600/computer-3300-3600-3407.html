{"title":"Merutekan antara 7 (tujuh!) Subnet, 2 di antaranya memiliki IP yang ditetapkan secara dinamis","draft":false,"url":"/merutekan-antara-7-tujuh-subnet-2-di-antaranya-memiliki-ip-yang-ditetapkan-secara-dinamis-slivdpdy","votes":"4","answers_count":"1","categories":["Komputer"],"tags":["linux","networking","wireless-networking","vpn","routing"],"snippet":"Saya menggunakan RaspberryPi (Raspbian OS) dalam skema perutean yang sangat kompleks, yang dapat saya kelola hingga jumlah subnet adalah lima :)  Saat ini, saya memiliki antarmuka berikut, seperti yang ditunjukkan oleh ifconfig:...","body":"<p> Saya menggunakan RaspberryPi (Raspbian OS) dalam skema perutean yang sangat kompleks, yang dapat saya kelola hingga jumlah subnet adalah lima :) </p>\n\n<p> Saat ini, saya memiliki antarmuka berikut, seperti yang ditunjukkan oleh ifconfig: </p> <pre><code>eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n    inet 192.168.1.251  netmask 255.255.255.0  broadcast 192.168.1.255\neth0:1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n    inet 192.168.44.1  netmask 255.255.255.0  broadcast 192.168.44.255\n    ether b8:27:eb:b9:ca:47  txqueuelen 1000  (Ethernet)\neth0:2: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n    inet 192.168.45.1  netmask 255.255.255.0  broadcast 192.168.45.255\n    ether b8:27:eb:b9:ca:47  txqueuelen 1000  (Ethernet)\ntun0: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1500\n    inet 10.35.0.74  netmask 255.255.255.255  destination 10.35.0.73\ntun1: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1500\n    inet 10.35.0.18  netmask 255.255.255.255  destination 10.35.0.17\nwlan0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n    inet 192.168.42.1  netmask 255.255.255.0  broadcast 192.168.42.255\nwlan1: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500\n    inet 192.168.46.1  netmask 255.255.255.0  broadcast 192.168.46.255\n</code></pre> <p><strong> eth0 </strong> menyediakan akses internet ke dunia luar (fixed IP) </p>\n\n<p><strong> tun0 </strong> dan <strong> tun1 </strong> adalah antarmuka VPN ke server VPN yang berbeda, mereka mendapatkan IP yang ditetapkan secara dinamis dari server masing-masing ( <strong> ini </strong> tampaknya menjadi masalah inti) </p>\n\n<p><strong> wlan0 </strong> dan <strong> wlan1.dll </strong> adalah jaringan wifi (berfungsi sebagai titik akses!) yang harus dirutekan <strong> semua </strong> lalu lintas mereka melalui <strong> tun0 </strong> dan <strong> tun1 </strong> , masing-masing </p>\n\n<p><strong> eth0: 1 </strong> dan <strong> eth0: 2 </strong> adalah antarmuka yang berbagi perangkat keras dengan <strong> eth0 </strong> (hanya satu port Ethernet di RaspberryPi) dan harus menyediakan fungsionalitas yang sama seperti <strong> wlan0 </strong> dan <strong> wlan1.dll </strong> , tetapi untuk klien kabel. </p>\n\n<p> Server DHCP dijalankan di RaspberryPi untuk memastikannya <strong> wlan0 </strong> dan <strong> wlan1.dll </strong> memberikan alamat di kelasnya masing-masing kepada klien nirkabel mereka. Tidak ada DHCP yang disediakan pada kabel bersama, tentu saja - saya mengkonfigurasi masing-masing <strong> klien </strong> perangkat untuk merutekan lalu lintas mereka baik melalui 192.168.44.1 atau 192.168.45.1, tergantung pada VPN mana (atau tidak ada VPN) yang saya inginkan agar mereka terhubung. </p>\n\n<p> Jika tidak jelas, berikut semua jaringan yang harus saya tangani: </p>\n\n<p> eth0, 192.168.1.1/24 (internet hulu) </p>\n\n<p> eth0: 1, 192.168.44.1/24 (klien kabel hilir melalui tun0) </p>\n\n<p> eth0: 2, 192.168.45.1/24 (klien kabel hilir melalui tun1) </p>\n\n<p> tun0, <strong> 10.35.0.74/32 </strong> (VPN upstream pertama) </p>\n\n<p> tun1, <strong> 10.35.0.18/32 </strong> (VPN upstream kedua) </p>\n\n<p> wlan0, 192.168.42.1/24 (klien nirkabel hilir melalui tun0) </p>\n\n<p> wlan0, 192.168.46.1/24 (klien nirkabel hilir melalui tun1) </p>\n\n<p> Perhatikan, ini dia <strong> arus </strong> konfigurasi dengan IP tebal yang disediakan oleh server VPN. </p>\n\n<p> Masalahnya dilambangkan dengan <strong> mencolok </strong> - IP, yang disediakan oleh server VPN berubah secara dinamis setelah setiap koneksi ulang (bahkan jika tidak, mereka bisa). Bagi saya, cukup mudah untuk mengetahui bahkan perutean multi-arah seperti itu jika semua alamat diperbaiki. Dengan satu VPN, satu nirkabel, dan eth0: 1 juga mudah, sebagai server VPN <strong> mendorong rute default </strong> saat menghubungkan dan sisanya mudah. Bagaimanapun saya tahu untuk mengatur NAT untuk satu wifi yang dialihkan ke satu VPN </p> <pre><code>sudo iptables -t nat -A POSTROUTING -o tun0 -j MASQUERADE\n</code></pre> <p> seperti yang ditunjukkan di sini: </p>\n\n<p><a href=\"https://pimylifeup.com/raspberry-pi-vpn-access-point/\" rel=\"nofollow noopener\" target=\"_blank\"> https://pimylifeup.com/raspberry-pi-vpn-access-point/ </a></p>\n\n<p> Namun, untuk memiliki <strong> dua koneksi VPN </strong> Saya harus mencegah server mengacaukan perutean saya, tentu saja saya dapat melakukannya dengan: </p> <pre><code>pull-filter ignore redirect-gateway\n</code></pre> <p> dalam file konfigurasi klien VPN. </p>\n\n<p> Setelah saya melakukan ini, saya tersesat. Lalu lintas jelas tidak diarahkan ke <strong> tun0 </strong> atau <strong> tun1 </strong> . Perbedaan antara server VPN dan saya adalah bahwa server dapat mendorong rute yang tepat sebagai <strong> itu tahu ip yang tepat </strong> antarmuka VPN (server menentukannya), dan saya tidak tahu! </p>\n\n<p> Saya mencoba menyiapkan perutean menggunakan <strong> iptables </strong> , murni berdasarkan nama perangkat jaringan, tetapi sejauh ini saya tidak berhasil. Adakah yang bisa menyarankan rute yang benar yang dapat saya ambil untuk menyiapkan perutean ini? </p>","source":"https://superuser.com/questions/1511822/routing-between-7-seven-subnets-2-of-them-have-dynamically-assigned-ips","author":"<a href=\"https://superuser.com/users/641913/xmp125a\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">xmp125a</span></a>","replies":[],"answers":[{"answer":"<blockquote>\n  <p> Perbedaan antara server VPN dan saya adalah bahwa server dapat mendorong rute yang tepat karena ia mengetahui ip yang tepat dari antarmuka VPN (server menentukannya), dan saya tidak tahu! </p>\n</blockquote>\n\n<p> Anda tidak perlu melakukannya. Antarmuka &#39;tun&#39; yang dibuat oleh klien VPN Anda adalah antarmuka &quot;lapisan 3&quot; dan sama sekali tidak menggunakan alamat gateway rute - Anda akan mendapatkan hasil yang sama hanya dengan merutekan lalu lintas melalui seluruh perangkat. Sebagai contoh: </p> <pre><code>ip route add &lt;dstA&gt;/24 dev tun0\nip route add &lt;dstB&gt;/24 dev tun1\n</code></pre> <p> Atau jika Anda menginginkannya berdasarkan alamat IP klien: </p> <pre><code>ip route add 0.0.0.0/0 dev tun0 table 10\nip rule add pref 100 from 192.168.44.0/24 lookup 10\n</code></pre> <p> (Pada antarmuka lapisan-2 seperti Ethernet, Wi-Fi, atau &#39;tap&#39;, antarmuka yang sama menghubungkan Anda ke beberapa perangkat lokal berdasarkan alamat MAC yang Anda kirimi paket. Alamat &#39;gateway&#39; atau &#39;via&#39; yang Anda gunakan. tentukan dalam rute hanya digunakan untuk satu hal: itu diselesaikan ke alamat MAC. </p>\n\n<p> Antarmuka lapisan-3 seperti &#39;tun&#39; atau &#39;ppp&#39;, bagaimanapun, tidak memiliki alamat MAC sama sekali - mereka hanya memiliki dua ujung dan tidak ada perbedaan antara host &quot;on-link&quot; dan &quot;jauh&quot;. Jadi tidak perlu rute tersebut memiliki gateway, karena apa pun yang Anda kirim, paket selalu mencapai tujuan yang sama, dalam hal ini server VPN.) </p>\n\n<p> Akhirnya, jika Anda <em> melakukan </em> perlu mengetahui alamat gateway default, Anda dapat meminta klien VPN memberi tahu Anda - mis. OpenVPN mendukung skrip <code>--up</code> yang menerima semua informasi mengenai konfigurasi jaringan. </p>\n\n<blockquote>\n  <p> eth0: 1 dan eth0: 2 adalah antarmuka yang berbagi perangkat keras dengan eth0 </p>\n</blockquote>\n\n<p> Itu adalah kebohongan yang diberitahukan ifconfig kepada Anda karena alasan historis. Antarmuka &quot;alias&quot; ini sebenarnya belum ada di Linux untuk waktu yang lama; saat ini OS mengelolanya sebagai satu antarmuka eth0 yang hanya memiliki beberapa alamat yang ditetapkan padanya. </p>\n\n<p> Di catatan lain, untuk alasan yang sama seperti di bagian sebelumnya, tidak ada perbedaan nyata antara klien Anda yang menggunakan eth0: 1 dan eth0: 2 sebagai gateway mereka - kedua alamat IP mereka menghasilkan alamat MAC yang sama persis. Paket hanya dapat dibedakan berdasarkan alamat IP sumber klien itu sendiri. </p>","votes":"6","source":"https://superuser.com/a/1511829","author":"<a href=\"https://superuser.com/users/1686/user1686\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">user1686</span></a>","replies":[{"reply":"Thaks, berhasil! Satu pertanyaan tambahan, jika boleh. Mengapa tabel routing 10? Apakah ini masalah pilihan atau adakah standar yang menentukan apa yang tercantum dalam tabel 10?","author":"<a href=\"https://superuser.com/users/641913/xmp125a\" target=\"_blank\" rel=\"nofollow noopener\">xmp125a</a>"},{"reply":"Tidak, itu nomor acak yang saya pilih. Pilih apa saja antara 1 dan 4294967295, kecuali 253â€“255 (ketiganya memang disediakan untuk tabel built-in seperti &#39;main&#39;), dan mungkin berikan nama pada / etc / iproute2 / rt_tables.","author":"<a href=\"https://superuser.com/users/1686/user1686\" target=\"_blank\" rel=\"nofollow noopener\">user1686</a>"},{"reply":"Terima kasih, saya tahu tentang nomor yang dipesan, saya hanya ingin memeriksa apakah ada sesuatu yang istimewa tentang tabel 10.","author":"<a href=\"https://superuser.com/users/641913/xmp125a\" target=\"_blank\" rel=\"nofollow noopener\">xmp125a</a>"}]}]}
