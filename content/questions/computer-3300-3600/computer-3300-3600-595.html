{"title":"Mencoba mencetak nama pengguna pada message of the day (MOTD)","draft":false,"url":"/mencoba-mencetak-nama-pengguna-pada-message-of-the-day-motd-tjblokgv","votes":"4","answers_count":"3","categories":["Komputer"],"tags":["linux","ubuntu","bash","ssh"],"snippet":"Saya menguji skrip sederhana yang mencetak pesan selamat datang untuk pengguna yang masuk di server.  Naskah:  #!/bin/sh_user=$(whoami)_hostname=$(hostname)_currdate=$(date)echo \"#===================================================#\"echo \"          Welcome $_user to $_hostname server\"echo \"          Curr....","body":"<p> Saya menguji skrip sederhana yang mencetak pesan selamat datang untuk pengguna yang masuk di server. </p>\n\n<p> Naskah: </p> <pre><code>#!/bin/sh\n_user=$(whoami)\n_hostname=$(hostname)\n_currdate=$(date)\n\necho \"#===================================================#\"\necho \"          Welcome $_user to $_hostname server\"\necho \"          Curr. time: $_currdate\"\necho \"          Have a nice day!\"\necho \" \"\necho  \"#==================================================#\"\n</code></pre> <p> Saya menyimpan skrip di <strong> /etc/update-motd.d/ </strong> , sehingga muncul pesan setelah pengguna login. <strong> Masalahnya adalah </strong> bahwa var <code>_user</code> selalu muncul sebagai &quot; <strong> akar </strong> &quot;dan saya tidak dapat menemukan cara untuk mendapatkan nama pengguna dari pengguna. Saya sedang menguji ini melalui SSH. </p>\n\n<p> Ada yang bisa membantu saya?\nTerima kasih! :) </p>","source":"https://superuser.com/questions/981897/trying-to-print-username-at-message-of-the-day-motd","author":"<a href=\"https://superuser.com/users/505071/tzlima\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">tzlima</span></a>","replies":[],"answers":[{"answer":"<p> Jawaban Grawity salah. Dia menyatakan bahwa motd adalah file global, tetapi OP dengan jelas menyatakan dia bekerja di /etc/update-motd.d/. </p>\n\n<p> /etc/update-motd.d/ memungkinkan MOTD yang dibuat secara dinamis dan dapat menjalankan skrip atau aplikasi yang sebenarnya. </p>\n\n<p> Yang beeing berkata, saya menghadapi masalah yang sama seperti Anda. Masalahnya adalah bahwa selama pelaksanaan MOTD, hak istimewa belum jatuh ke akun pengguna, jadi semua skrip dijalankan sebagai root. </p>\n\n<p> Saya berhasil menemukan solusi yang berfungsi pada mesin Debian. Saya tidak mencobanya di distribusi lain. Apa solusi saya untuk mengambil nama pengguna dari output &#39;ps&#39;, karena sshd menunjukkan nama pengguna, seperti: </p> <pre><code>root      4179  0.0  0.0  93984  5952 ?        Ss   10:44   0:00 sshd: johndoe [priv] \n</code></pre> <p> Skrip kecil saya &#39;mencari kembali&#39; di pohon proses untuk menemukan proses yang berisi nama pengguna. </p> <pre><code>PPID1=`cat /proc/$PPID/status | grep PPid | awk '{ print $2 }'`\nPPID2=`cat /proc/$PPID1/status | grep PPid | awk '{ print $2 }'`\nUSERNAME=`ps -x | grep $PPID2 | awk '{ print $6 }' |  sed \"s/[[:digit:].-]//g\"`\n</code></pre> <p> Nama pengguna sekarang ada di variabel $ USERNAME. </p>","votes":"7","source":"https://superuser.com/a/1178598","author":"<a href=\"https://superuser.com/users/282989/rudy-broersma\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Rudy Broersma</span></a>","replies":[{"reply":"Bekerja di Ubuntu Zesty","author":"<a href=\"https://superuser.com/users/458577/grammargeek\" target=\"_blank\" rel=\"nofollow noopener\">Grammargeek</a>"},{"reply":"Ini berfungsi pada Raspbian (dengan zsh) ketika jawaban yang diterima tidak.","author":"<a href=\"https://superuser.com/users/648516/alex-meuer\" target=\"_blank\" rel=\"nofollow noopener\">Alex Meuer</a>"}]},{"answer":"<p> Tidak boleh. Motd adalah a <em> global </em> file, dibagikan di antara pengguna (itu / etc / motd), dan diperbarui hanya saat reboot (dan sesekali saya kira). Jadi tidak mungkin ada pengguna tertentu atau khusus sesi. </p>\n\n<p> Sebagai gantinya, tambahkan pesan Anda ke <code>/etc/profile</code> untuk ditampilkan oleh shell: </p> <pre><code>if [ -t 1 ] &amp;&amp; [ ! -f ~/.hushlogin ]; then\n    echo \"Welcome to $(hostname), $(whoami)!\"\n    echo \"$(ddate). Have a nice day.\"\nfi\n</code></pre>","votes":"3","source":"https://superuser.com/a/981899","author":"<a href=\"https://superuser.com/users/1686/user1686\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">user1686</span></a>","replies":[{"reply":"Terima kasih atas jawaban Anda @grawity. Saya seorang pemula dalam skrip. Bisakah Anda menjelaskan kepada saya, tolong, pernyataan if Anda?","author":"<a href=\"https://superuser.com/users/505071/tzlima\" target=\"_blank\" rel=\"nofollow noopener\">tzlima</a>"},{"reply":"@tzlima: Bacalah seluruh halaman manual <code>test</code> (alias <code>[</code>), atau shell <code>bash</code>. Pemeriksaan pertama adalah apakah keluaran ke terminal (untuk menghindari kekacauan <i> batch </i> koneksi dengan pesan sampah); yang kedua adalah apakah pengguna telah memilih untuk <i> menyembunyikan </i> motd dengan membuat file <code>~&#47;.hushlogin</code>.","author":"<a href=\"https://superuser.com/users/1686/user1686\" target=\"_blank\" rel=\"nofollow noopener\">user1686</a>"},{"reply":"@grawity tidak tepat dengan mengatakan bahwa ini adalah file global. Ya, ini adalah file global, tetapi ini adalah file global yang dibaca oleh pengguna yang log in. Masalah yang dilihat oleh OP bukanlah bahwa ini adalah file global; masalahnya adalah ketika motd ditampilkan, itu ditampilkan sebagai root pengguna dan bukan pengguna yang masuk. Namun, solusi yang ditawarkan baik-baik saja. saya <i> berpikir </i> pada saat motd ditampilkan, tidak ada variabel untuk pengguna yang login. (Saya mencoba menemukannya juga.)","author":"<a href=\"https://superuser.com/users/764244/ray\" target=\"_blank\" rel=\"nofollow noopener\">Ray</a>"}]},{"answer":"<p> Mengikuti tidak akan berfungsi untuk login lokal, tetapi sekali lagi motd saya tidak muncul di login lokal untuk saya dan OP sedang mencari solusi terkait SSH; jadi inilah mantra ajaib untuk menangkap nama pengguna dari pengguna terbaru yang telah masuk melalui SSH ke variabel dalam skrip motd. </p> <pre><code>_user=\"$(grep 'sshd' /var/log/auth.log | awk '/Accepted publickey for/{print $9}' | tail -1)\"\n</code></pre> <blockquote>\n  <p> Koreksi, <code>grep</code> sepertinya tidak diperlukan ... </p>\n</blockquote> <pre><code>_user=\"$(awk '/Accepted publickey for/ {print $9}' /var/log/auth.log | tail -1)\"\n</code></pre> <p> Meskipun saya tidak yakin apa yang akan dilaporkan jika / ketika dua atau lebih pengguna masuk pada saat yang bersamaan; jadi jangan mengandalkannya untuk keamanan atau untuk menjaga privasi. </p>","votes":"1","source":"https://superuser.com/a/1365495","author":"<a href=\"https://superuser.com/users/666508/s0ands0\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">S0AndS0</span></a>","replies":[{"reply":"bagi saya itu berhasil setelah mengintip ke dalam file log dan menyesuaikan string pencarian di skrip ke <code>_user=&quot;$(grep &#39;sshd&#39; &#47;var&#47;log&#47;auth.log | awk &#39;&#47;session opened for user&#47;{print $11}&#39; | tail -1)&quot;</code>","author":"<a href=\"https://superuser.com/users/291919/tymric\" target=\"_blank\" rel=\"nofollow noopener\">Tymric</a>"}]}]}
