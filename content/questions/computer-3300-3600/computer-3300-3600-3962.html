{"title":"Dapatkan stdout dan stderr yang digabungkan dan dipisahkan","draft":false,"url":"/dapatkan-stdout-dan-stderr-yang-digabungkan-dan-dipisahkan-mcezvubj","votes":"4","answers_count":"3","categories":["Komputer"],"tags":["linux","bash","redirection"],"snippet":"Saya mencari cara untuk menjalankan program Prog dan berakhir dengan 3 file:  Stdout Prog  Stderr Prog  Baik stdout dan stderr Prog digabungkan seperti yang akan ditampilkan di layar jika tidak ada pengalihan....","body":"<p> Saya mencari cara untuk menjalankan program <code>Prog</code> dan berakhir dengan 3 file: </p>\n\n<ol>\n<li> Stdout <code>Prog</code> </li>\n<li> Stderr <code>Prog</code> </li>\n<li> Baik stdout dan stderr <code>Prog</code> digabungkan seperti yang akan ditampilkan di layar jika tidak ada pengalihan. </li>\n</ol>\n\n<p> Apakah ada kombinasi pengalihan, pipa, dll. Yang dapat mencapai hal ini? </p>\n\n<p> Catatan: Saya biasanya menggunakan bash. </p>","source":"https://superuser.com/questions/517256/obtain-both-merged-and-separated-stdout-and-stderr","author":"<a href=\"https://superuser.com/users/179209/angew-is-no-longer-proud-of-so\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Angew is no longer proud of SO</span></a>","replies":[],"answers":[{"answer":"<p> Sejauh yang saya tahu, tidak ada cara elegan untuk melakukan ini (untuk cara yang tidak elegan yang berhasil tetapi tidak cantik, gulir ke bawah hingga akhir jawaban saya). Saya ragu Anda dapat melakukan yang lebih baik dari: </p> <pre><code>$ command &gt;stdout.txt 2&gt;stderr.txt &amp;&amp; cat stdout.txt stderr.txt &gt; both.txt\n</code></pre> <p> Ada <a href=\"https://unix.stackexchange.com/q/9646/22222\" target=\"_blank\" rel=\"nofollow noopener\"> berbagai </a> <a href=\"http://www.catonmat.net/blog/bash-one-liners-explained-part-three/\" rel=\"nofollow noopener\" target=\"_blank\"> keren </a> <a href=\"http://www.linuxquestions.org/questions/linux-software-2/bash-how-to-redirect-output-to-file-and-still-have-it-on-screen-412611/\" rel=\"nofollow noopener\" target=\"_blank\"> Trik </a> Anda dapat menggunakan tetapi tidak satupun dari mereka tampaknya berhasil menghasilkan 3 file lebih baik dari yang di atas. Masalah utamanya adalah file <code>both.txt</code> tidak akan menampilkan pesan (STDERR dan STDOUT) dalam urutan yang benar. Ini karena (seperti yang dijelaskan <a href=\"http://www.catonmat.net/blog/bash-one-liners-explained-part-three/\" rel=\"nofollow noopener\" target=\"_blank\"> sini </a> ): </p>\n\n<blockquote>\n  <p> Saat Anda mengarahkan kedua output standar dan kesalahan standar ke hal yang sama\n  file, Anda mungkin mendapatkan beberapa hasil yang tidak diharapkan. Ini karena fakta\n  bahwa STDOUT adalah aliran yang di-buffer sedangkan STDERR selalu tidak di-buffer.\n  Ini berarti bahwa setiap karakter STDERR ditulis secepatnya\n  tersedia saat STDOUT menulis hal-hal dalam batch. Saat STDOUT dan\n  STDERR menuju ke file yang sama Anda mungkin melihat pesan kesalahan muncul\n  lebih cepat dari yang Anda harapkan dalam kaitannya dengan yang sebenarnya\n  keluaran dari program atau skrip Anda. Bukan hal yang perlu diwaspadai\n  tentang tetapi hanyalah efek samping dari aliran yang disangga vs. aliran yang tidak disangga,\n  Anda hanya perlu mengingatnya. </p>\n</blockquote>\n\n<p> Alternatif terbaik yang bisa saya temukan adalah menggunakan subkulit bash, agak rumit dan <em> masih </em> tidak menampilkan keluaran dalam urutan yang benar. Saya membuat skrip Perl sederhana, <code>test.pl</code> yang mencetak &quot;OUT&quot; ke <code>STDOUT</code> dan &quot;ERR&quot; ke <code>STDERR</code>, mengulangi proses tersebut 3 kali: </p> <pre><code>#/usr/bin/perl \nfor($i=0; $i&lt;=2; $i++){\n    print STDOUT \"OUT\\n\"; \n    print STDERR \"ERR\\n\"\n}\n</code></pre> <p> Outputnya yang normal dan tidak dialihkan adalah: </p> <pre><code>$ ./test.pl\nOUT\nERR\nOUT\nERR\nOUT\nERR\n</code></pre> <p> Untuk mengarahkan keluaran, saya menjalankan: </p> <pre><code>(./test.pl 2&gt; &gt;(tee error.txt) &gt; &gt;(tee out.txt)) &gt; both.txt \n</code></pre> <p> Ini menggunakan <code>tee</code>, sebuah program yang akan mencetak inputnya ke layar <em> dan </em> ke nama file. Jadi, saya mengarahkan <code>STDERR</code> dan meneruskannya sebagai masukan ke <code>tee</code>, menyuruhnya menulisnya ke file <code>error.txt</code>. Demikian pula dengan <code>STDOUT</code> dan file <code>out.txt</code>. Saya menempatkan semuanya dalam subkulit (<code>(...)</code>) sehingga saya dapat menangkap <em> semua </em> dari outputnya dan dialihkan ke <code>both.txt</code>. </p>\n\n<p> Sekarang, ini berfungsi karena ia membuat 3 file, satu dengan <code>STDERR</code>, satu dengan <code>STDOUT</code> dan satu lagi dengan keduanya. Namun, seperti yang dijelaskan di atas, ini menyebabkan pesan muncul dalam urutan yang salah di <code>both.txt</code>: </p> <pre><code>$ cat both.txt \nERR\nERR\nERR\nOUT\nOUT\nOUT\n</code></pre> <p> Satu-satunya cara untuk mengatasi ini yang dapat saya temukan adalah menambahkan waktu itu dicetak ke setiap baris keluaran dan kemudian menyortir, tetapi itu semakin <em> serius </em> berbelit-belit dan, di tempat Anda, saya akan bertanya pada diri sendiri apakah itu benar-benar berharga: </p> <pre><code> $(./test.pl \\\n   2&gt; &gt;(while read n; do echo `date +%N`\" $n\"; echo \"$n\" &gt;&gt;error.txt; done) \\\n    &gt; &gt;(while read n; do echo `date +%N`\" $n\"; echo \"$n\" &gt;&gt; out.txt; done )) \\\n | gawk '{print $2}'&gt; both.txt \n</code></pre>","votes":"4","source":"https://superuser.com/a/517905","author":"<a href=\"https://superuser.com/users/151431/terdon\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">terdon</span></a>","replies":[{"reply":"Terima kasih atas jawabannya. Saya sudah mencoba pendekatan Anda dan Kevin; menerima milikmu untuk ide cap waktu. Hal yang menarik adalah bahwa output berakhir dalam (hampir) urutan yang benar dalam file gabungan <i> tanpa </i> stamping dan sortasi. Mungkinkah karena <code>Prog</code> sebenarnya adalah skrip Python yang melakukan <code>Popen()</code> dan keluarannya sendiri berasal dari proses yang dimunculkan? Dan BTW, bagaimana terminal menghindari buffering stdout?","author":"<a href=\"https://superuser.com/users/179209/angew-is-no-longer-proud-of-so\" target=\"_blank\" rel=\"nofollow noopener\">Angew is no longer proud of SO</a>"},{"reply":"Maaf, @Agnew, mencapai batas STDOUT / STDERR saya foo :), tidak tahu.","author":"<a href=\"https://superuser.com/users/151431/terdon\" target=\"_blank\" rel=\"nofollow noopener\">terdon</a>"},{"reply":"Saya tidak percaya bahwa menulis cap waktu akan (selalu) membantu. Karena Stdout dapat menunda dan mengakumulasi data, tindakan yang diambil oleh re-direct (termasuk menambahkan stempel waktu) dapat ditunda. Stempel waktu akan menunjukkan kapan data ditulis ke file keluaran, yang belum tentu sama dengan saat peristiwa itu terjadi.","author":"<a href=\"https://superuser.com/users/144147/kevin-fegan\" target=\"_blank\" rel=\"nofollow noopener\">Kevin Fegan</a>"},{"reply":"@Kevin, memang, tetapi perbedaan waktu relatif antara STDOUT dan STDERR harus dipertahankan. Intinya adalah menjaga urutan yang sama, tidak tahu persis kapan setiap baris dicetak.","author":"<a href=\"https://superuser.com/users/151431/terdon\" target=\"_blank\" rel=\"nofollow noopener\">terdon</a>"}]},{"answer":"<p> 1) buat dua skrip: </p> <pre><code>getout.sh\ngeterr.sh\n</code></pre> <p> getout.sh akan menerima Stdout. <br> Script akan menulis data ke f1.txt dan juga menulis data yang sama ke file f12.txt </p>\n\n<p> geterr.sh akan menerima Stderr. <br> Script akan menulis data ke f2.txt dan juga menulis data yang sama ke file f12.txt </p>\n\n<p> Saya tidak yakin bahwa mungkin untuk mempertahankan urutan persis data yang ditulis ke file: f12.txt secara andal. Ini karena penulisan ke Stdout di-buffer oleh sistem operasi dan penulisan ke Stderr terjadi hampir secara real-time. Ini dapat (akan) menunda data Stdout agar tidak terlihat oleh skrip. Efeknya adalah: </p> <pre><code>a. For some data written to Stdout BEFORE data written to \n   Stderr, the data written to f12.txt from Stderr may \n   precede the data written by Stdout.  \nb. Some data written to Stdout will be accumulated with \n   other data written earlier or later. As the script sees it, \n   these data lines may all appear at the same time (together).  \nc. Because of (b), for some data written to Stderr in-between \n   multiple data writes to Stdout, the data written to f12.txt \n   from Stderr may precede the whole group of data written to Stdout.  \nd. Because of all this, including timestamps with the data \n   written to f12.txt will not preserve the order that events happened.  \n</code></pre> <p> 2) buat 2 pipa bernama: </p> <pre><code>% mknod pout p\n% mknod perr p\n</code></pre> <p> 3) biarkan skrip &quot;mendengarkan&quot; ke pipa: </p> <pre><code>% ./getout.sh &lt; pout &amp;\n% ./geterr.sh &lt; perr &amp;\n</code></pre> <p> 4) Mulai program Anda (Prog) seperti ini: </p> <pre><code>% Prog 1&gt; pout 2&gt; perr\n</code></pre>","votes":"2","source":"https://superuser.com/a/517673","author":"<a href=\"https://superuser.com/users/144147/kevin-fegan\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Kevin Fegan</span></a>","replies":[{"reply":"Bagus, belum memikirkan pipa bernama. Namun, Anda dapat melakukan hal yang sama tanpa pipa bernama (dan, dengan langkah yang lebih sedikit) dengan menggunakan sub-shell seperti yang telah saya lakukan dalam jawaban saya. Selain itu, Anda masih memiliki masalah baris yang tidak muncul dalam urutan yang benar di f12.txt tetapi Anda dapat memperbaikinya dengan membuat dua skrip menambahkan <code>date</code> ke keluaran dan pengurutannya.","author":"<a href=\"https://superuser.com/users/151431/terdon\" target=\"_blank\" rel=\"nofollow noopener\">terdon</a>"}]},{"answer":"<p> Untuk memisahkannya menjadi beberapa file: </p> <pre><code>./Prog 1&gt; stdout.log 2&gt; stderr.log\n</code></pre> <p> Untuk menggabungkannya menjadi file yang sama: </p> <pre><code>./Prog 1&gt;&gt; combine.log 2&gt;&gt; combine.log\n</code></pre> <p> Ada cara &#39;singkat&#39; untuk melakukan penggabungan untuk bash, tetapi cara di atas lebih aman jika Anda menggunakan sh. </p>\n\n<hr>\n\n<p> Tergantung pada seberapa akurat kebutuhan kombinasi Anda, berikut ini mungkin berfungsi atau tidak </p> <pre><code>touch stdout.log\ntouch stderr.log\ntail -f stdout.log &gt;&gt; combine.log &amp;\ntail -f stderr.log &gt;&gt; combine.log &amp;\n./Prog 1&gt;&gt; stdout.log 2&gt;&gt; stderr.log ; pkill tail\n</code></pre>","votes":"0","source":"https://superuser.com/a/517468","author":"<a href=\"https://superuser.com/users/170017/john-siu\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">John Siu</span></a>","replies":[{"reply":"Terima kasih; Saya tahu ini. Namun, saya membutuhkan cara untuk &quot;melakukan keduanya secara bersamaan&quot;. Artinya, miliki semua stdout.log, stderr.log, dan kombinasikan.log saat proses selesai.","author":"<a href=\"https://superuser.com/users/179209/angew-is-no-longer-proud-of-so\" target=\"_blank\" rel=\"nofollow noopener\">Angew is no longer proud of SO</a>"},{"reply":"Perbarui jawaban saya untuk menggabungkan.log","author":"<a href=\"https://superuser.com/users/170017/john-siu\" target=\"_blank\" rel=\"nofollow noopener\">John Siu</a>"},{"reply":"Pada beberapa versi shell, <code>1&gt; combine.log 2&gt; combine.log</code> akan membuang keluaran standar ke dalam bit bucket dan hanya menangkap stderr pada <code>combine.log</code>.","author":"<a href=\"https://superuser.com/users/150988/scott\" target=\"_blank\" rel=\"nofollow noopener\">Scott</a>"}]}]}
