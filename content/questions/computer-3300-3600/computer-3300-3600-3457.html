{"title":"nslookup gagal tetapi berhasil diselesaikan oleh systemd","draft":false,"url":"/nslookup-gagal-tetapi-berhasil-diselesaikan-oleh-systemd-76mu4fgz","votes":"4","answers_count":"2","categories":["Komputer"],"tags":["ubuntu","dns","systemd","resolv.conf"],"snippet":"Ini adalah masalah aneh yang saya habiskan sepanjang hari. Akan sangat bagus jika seseorang bisa menjelaskan hal ini.  Masalahnya muncul sebagai masalah dengan resolusi nama, tapi saya tidak yakin itu penyebab utamanya:...","body":"<p> Ini adalah masalah aneh yang saya habiskan sepanjang hari. Akan sangat bagus jika seseorang bisa menjelaskan hal ini. </p>\n\n<p> Masalahnya muncul sebagai masalah dengan resolusi nama, tapi saya tidak yakin itu penyebab utamanya: </p> <pre><code># host www.google.com\n;; connection timed out; no servers could be reached\n</code></pre> <p> sejauh ini membosankan, tapi tunggu !: </p> <pre><code>#systemd-resolve www.google.com\nwww.google.com: 209.85.202.103\n                209.85.202.106\n                209.85.202.105\n                209.85.202.104\n                209.85.202.147\n                209.85.202.99\n</code></pre> <p> Sederhana, masalahnya ada pada resolv.conf bukan? </p> <pre><code># This file is managed by man:systemd-resolved(8). Do not edit.\n#\n# 127.0.0.53 is the systemd-resolved stub resolver.\n# run \"systemd-resolve --status\" to see details about the actual nameservers.\nnameserver 127.0.0.53\n\nsearch xxx.uk xyz\n</code></pre> <p> Jadi sistem menggunakan resolver systemd? </p> <pre><code>#dig @127.0.0.53 www.google.com\n; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-Ubuntu &lt;&lt;&gt;&gt; @127.0.0.53 www.google.com\n; (1 server found)\n;; global options: +cmd\n;; connection timed out; no servers could be reached\n</code></pre> <p> ok, jadi jika resolver systemd mengatakan ada di 127.0.0.53 mengapa tidak merespons. </p> <pre><code>#sudo netstat -lupn | grep 127\nudp        0      0 127.0.0.53:53           0.0.0.0:*                           1679/systemd-resolv\n</code></pre> <p> Jika tidak mendengarkan, apa yang dilakukan systemd-resolv? </p> <pre><code>Global\n          DNSSEC NTA: 10.in-addr.arpa\n                      16.172.in-addr.arpa\n                      168.192.in-addr.arpa\n                      17.172.in-addr.arpa\n                      18.172.in-addr.arpa\n                      19.172.in-addr.arpa\n                      20.172.in-addr.arpa\n                      21.172.in-addr.arpa\n                      22.172.in-addr.arpa\n                      23.172.in-addr.arpa\n                      24.172.in-addr.arpa\n                      25.172.in-addr.arpa\n                      26.172.in-addr.arpa\n                      27.172.in-addr.arpa\n                      28.172.in-addr.arpa\n                      29.172.in-addr.arpa\n                      30.172.in-addr.arpa\n                      31.172.in-addr.arpa\n                      corp\n                      d.f.ip6.arpa\n                      home\n                      internal\n                      intranet\n                      lan\n                      local\n                      private\n                      test\n\nLink 20 (veth10858e2)\n      Current Scopes: LLMNR/IPv6\n       LLMNR setting: yes\nMulticastDNS setting: no\n      DNSSEC setting: no\n    DNSSEC supported: no\n\nLink 14 (vnet0)\n      Current Scopes: LLMNR/IPv6\n       LLMNR setting: yes\nMulticastDNS setting: no\n      DNSSEC setting: no\n    DNSSEC supported: no\n\nLink 13 (virbr0-nic)\n      Current Scopes: none\n       LLMNR setting: yes\nMulticastDNS setting: no\n      DNSSEC setting: no\n    DNSSEC supported: no\n\nLink 12 (virbr0)\n      Current Scopes: LLMNR/IPv4\n       LLMNR setting: yes\nMulticastDNS setting: no\n      DNSSEC setting: no\n    DNSSEC supported: no\n\nLink 11 (docker0)\n      Current Scopes: none\n       LLMNR setting: yes\nMulticastDNS setting: no\n      DNSSEC setting: no\n    DNSSEC supported: no\n\nLink 10 (docker_gwbridge)\n      Current Scopes: LLMNR/IPv4 LLMNR/IPv6\n       LLMNR setting: yes\nMulticastDNS setting: no\n      DNSSEC setting: no\n    DNSSEC supported: no\n\nLink 3 (em2)\n      Current Scopes: DNS LLMNR/IPv4 LLMNR/IPv6\n       LLMNR setting: yes\nMulticastDNS setting: no\n      DNSSEC setting: no\n    DNSSEC supported: no\n         DNS Servers: 192.168.100.1\n                      192.168.100.2\n                      192.168.100.3\n                      192.168.100.4\n          DNS Domain: cqp\n\nLink 2 (em1)\n      Current Scopes: DNS LLMNR/IPv4 LLMNR/IPv6\n       LLMNR setting: yes\nMulticastDNS setting: no\n      DNSSEC setting: no\n    DNSSEC supported: no\n         DNS Servers: xxx.xxx.x.xx\n                      xxx.xxx.x.xx\n          DNS Domain: xxx.uk\n</code></pre> <p> Saya memiliki beberapa server, semuanya menjalankan ubuntu berseni terbaru, masalah ini telah berpindah antar server dalam proses mencoba memperbaikinya. <br> Mereka adalah bagian dari kawanan buruh pelabuhan dan menghapus, kemudian menambahkan kembali memperbaiki masalah pada satu titik. </p>\n\n<hr>\n\n<p> Saya dihidupkan <a href=\"https://superuser.com/questions/1187633/how-to-debug-systemd-networkd\" target=\"_blank\" rel=\"nofollow noopener\"> debugging yang diselesaikan systemd </a> tapi tidak ada keluaran saat permintaan dibuat. </p>","source":"https://superuser.com/questions/1317623/nslookup-failed-but-systemd-resolved-works","author":"<a href=\"https://superuser.com/users/899258/richard-collins\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Richard Collins</span></a>","replies":[{"reply":"Mungkin firewall Anda memblokirnya?","author":"<a href=\"https://superuser.com/users/1686/user1686\" target=\"_blank\" rel=\"nofollow noopener\">user1686</a>"},{"reply":"Anda mungkin benar, tetapi saya tidak dapat melihat aturan yang akan mempengaruhinya - yang tidak saya mengerti adalah bagaimana sistem memutuskan apa yang harus ditanyakan, saya pikir itu membaca resolv.conf untuk ke mana mengirim permintaan","author":"<a href=\"https://superuser.com/users/899258/richard-collins\" target=\"_blank\" rel=\"nofollow noopener\">Richard Collins</a>"},{"reply":"nslookup bukanlah &quot;sistem&quot;. systemd-resolvectl bukanlah &quot;sistem&quot;. Keduanya menggunakan pendekatan yang lebih langsung daripada &quot;sistem&quot;, dan keduanya menggunakan API yang berbeda (systemd-resolvectl menggunakan D-Bus, bukan UDP.)","author":"<a href=\"https://superuser.com/users/1686/user1686\" target=\"_blank\" rel=\"nofollow noopener\">user1686</a>"},{"reply":"Saya tahu bahwa itu pada akhirnya bermuara pada gethostbyname (), yang merupakan kegagalan, bagaimana cara memutuskan bagaimana menyelesaikan alamat jika tidak menggunakan 127.0.0.53 seperti yang dikatakan resol.conf?","author":"<a href=\"https://superuser.com/users/899258/richard-collins\" target=\"_blank\" rel=\"nofollow noopener\">Richard Collins</a>"},{"reply":"Maksud saya adalah itu <b> tidak </b> intinya menjadi gethostbyname (). Alat <code>nslookup</code> masih menggunakan resolv.conf tetapi sebenarnya menggunakan DNS secara langsung. Dan alat <code>systemd-resolve</code> tidak berbicara DNS sama sekali, alat itu berbicara D-Bus.","author":"<a href=\"https://superuser.com/users/1686/user1686\" target=\"_blank\" rel=\"nofollow noopener\">user1686</a>"}],"answers":[{"answer":"<p> saya menemukan <a href=\"https://news.ycombinator.com/item?id=17042047\" rel=\"nofollow noopener\" target=\"_blank\"> jawaban ini di Hacker News </a> yang menyarankan menghubungkan <code>/etc/resolv.conf</code> ke <code>/run/systemd/resolve/resolv.conf</code>: </p> <pre><code>sudo rm /etc/resolv.conf\nsudo ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf\n</code></pre> <p> Itu berhasil untuk saya. Saya tidak berpikir saya harus memulai ulang layanan apa pun setelah membuat ulang symlink. </p>","votes":"6","source":"https://superuser.com/a/1322684","author":"<a href=\"https://superuser.com/users/905023/neil-smith\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Neil Smith</span></a>","replies":[{"reply":"Terima kasih tapi ini sudah terjadi.","author":"<a href=\"https://superuser.com/users/899258/richard-collins\" target=\"_blank\" rel=\"nofollow noopener\">Richard Collins</a>"},{"reply":"@ Richard Collins: Jadi ini bukan jawabannya?","author":"<a href=\"https://superuser.com/users/964771/u-windl\" target=\"_blank\" rel=\"nofollow noopener\">U. Windl</a>"},{"reply":"Tidak, mungkin ada beberapa tautan dengan masalah dengan buruh pelabuhan dan firewalld - tidak ada bukti kuat untuk itu","author":"<a href=\"https://superuser.com/users/899258/richard-collins\" target=\"_blank\" rel=\"nofollow noopener\">Richard Collins</a>"}]},{"answer":"<p> Kedengarannya gila, tetapi Anda harus mengizinkan akses ke <code>127.0.0.53</code> untuk menggunakan <code>systemd-resolved</code> </p> <pre><code>iptables -I INPUT -s localhost -d 127.0.0.53  -j ACCEPT\n</code></pre>","votes":"0","source":"https://superuser.com/a/1565642","author":"<a href=\"https://superuser.com/users/1194100/david-ordyan\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">David Ordyan</span></a>","replies":[]}]}
