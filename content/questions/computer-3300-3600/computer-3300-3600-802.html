{"title":"Mengenai Unix Move Command","draft":false,"url":"/mengenai-unix-move-command-epvm51ao","votes":"4","answers_count":"5","categories":["Komputer"],"tags":["unix"],"snippet":"Saya perlu menulis Tran.sh Skrip Shell Unix yang memindahkan file input csv dari folder / exp / files ke direktori / exp / ready.  File input csv ditulis ke folder /exp/files oleh...","body":"<p> Saya perlu menulis Tran.sh Skrip Shell Unix yang memindahkan file input csv dari folder / exp / files ke direktori / exp / ready. </p>\n\n<p> File input csv ditulis ke folder <code>/exp/files</code> oleh server FTP yang perilakunya tidak dapat saya ubah sepele. Dalam skrip shell <code>tran.sh</code> saya perlu memastikan sebelum melakukan pemindahan file input csv dari / exp / files direktori tidak ada lagi proses lain yang menulis ke file tersebut. </p>\n\n<p> Bagaimana saya bisa melakukannya. </p>","source":"https://superuser.com/questions/112275/regarding-unix-move-command","author":"<a href=\"https://superuser.com/users/38993/user38993\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">user38993</span></a>","replies":[{"reply":"BTW - mengetahui bahwa ini adalah server FTP (sebagai lawan dari proses sewenang-wenang) benar-benar mengubah kumpulan jawaban yang sesuai; Saya pasti punya alasan untuk memperbarui milik saya. Harap berikan lebih banyak informasi dalam pertanyaan Anda di lain waktu.","author":"User"}],"answers":[{"answer":"<p> Tidak ada cara portabel untuk melakukannya. Anda dapat mencoba <code>fuser</code>, <code>lsof</code>, <code>inotify</code>, <code>FAM</code>, dan lainnya. </p>","votes":"3","source":"https://superuser.com/a/112276","author":"<a href=\"https://superuser.com/users/26316/ignacio-vazquez-abrams\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Ignacio Vazquez-Abrams</span></a>","replies":[{"reply":"jawaban yang bagus, langsung ke intinya. saya pikir Anda bisa menambahkan fasih dan gamin juga","author":"<a href=\"https://superuser.com/users/15896/matt-joiner\" target=\"_blank\" rel=\"nofollow noopener\">Matt Joiner</a>"}]},{"answer":"<p> Coba gunakan <code>fuser [FILE]</code>. Ini akan mengembalikan bukan nol jika file tidak digunakan. </p>\n\n<p> Berikut beberapa contoh kode yang akan menunggu file siap dipindahkan: </p> <pre><code>#!/bin/sh\n\nFROMDIR='/exp/files'\nDESTDIR='/exp/ready'\n\nfunction move_file_if_ready () {\n    if [ -f \"$1\" ]; then\n        while fuser \"$1\" 2&gt;/dev/null 1&gt;&amp;2 ; do\n            sleep 1\n        done\n\n        mv \"$1\" \"$DESTDIR\"\n    fi\n}\n\nfor \"$fn\" in \"$FROMDIR\"/*.csv; do\n    move_file_if_ready \"$fn\"\ndone\n</code></pre>","votes":"3","source":"https://superuser.com/a/112277","author":"<a href=\"https://superuser.com/users/23634/amphetamachine\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">amphetamachine</span></a>","replies":[{"reply":"Lumayan, tapi masih punya kondisi balapan.","author":"<a href=\"https://superuser.com/users/1711/dmckee-ex-moderator-kitten\" target=\"_blank\" rel=\"nofollow noopener\">dmckee --- ex-moderator kitten</a>"},{"reply":"Terima kasih banyak. tiga proses aplikasi jarak jauh sedang mem-ftp file input ke direktori ini. Jadi saya akan dapat mengetahui dengan perintah fuser ini jika mereka menulis ke file tersebut.","author":"User"},{"reply":"@dmckee - Benar tentang kondisi balapan, tetapi saya berasumsi bahwa proses penulisannya hanya menahan pegangan file terbuka cukup lama untuk menulis padanya, lalu menutupnya, tidak pernah membukanya lagi.","author":"<a href=\"https://superuser.com/users/23634/amphetamachine\" target=\"_blank\" rel=\"nofollow noopener\">amphetamachine</a>"},{"reply":"Terima kasih banyak. Saya berencana untuk memeriksa apakah baris terakhir di dalam file csv diterima dan memvalidasi file tersebut","author":"User"}]},{"answer":"<p> Anda dapat menggunakan lsof </p> <pre><code>r=$(lsof /exp/files )\nif [ ! -z \"$r\" ] ;then\n  mv /exp/files/*csv /exp/ready\nfi\n</code></pre>","votes":"3","source":"https://superuser.com/a/112278","author":"<a href=\"https://superuser.com/users/31894/user31894\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">user31894</span></a>","replies":[{"reply":"Terima kasih banyak. tiga proses aplikasi jarak jauh sedang mem-ftp file input ke direktori ini. Jadi saya akan dapat mengetahui dengan perintah lsof ini jika mereka menulis ke file tersebut.","author":"User"},{"reply":"Tetapi dengan tiga proses (dengan asumsi independen) menulis ke file direktori, maka ini tidak akan bergerak kecuali ketiganya selesai. Lebih modular menggunakan fuser, dan mengujinya pada basis per file.","author":"<a href=\"https://superuser.com/users/23634/amphetamachine\" target=\"_blank\" rel=\"nofollow noopener\">amphetamachine</a>"},{"reply":"Terima kasih banyak. Saya berencana untuk memeriksa apakah baris terakhir di dalam file csv diterima dan memvalidasi file tersebut.","author":"User"}]},{"answer":"<p> Cara yang Benar untuk melakukannya adalah dengan menyebabkan proses penulisan file dan mengganti nama atau memindahkannya atas kemauannya sendiri ketika selesai dengan penulisan. Yang lainnya rentan terhadap kondisi balapan dan / atau masalah izin. </p>\n\n<p> Beberapa contoh khusus kasus masalah: </p>\n\n<ul>\n<li> Jika proses pemindahan file dijalankan sebagai pengguna yang berbeda dengan lsof / fuser / etc, informasinya tidak dijamin selesai </li>\n<li> Jika proses yang melakukan penulisan adalah skrip shell, itu mungkin menelurkan subproses yang membuka file, membiarkannya ditutup, menelurkan subproses lain, dll. Dalam skenario ini, fuser dan alat serupa dapat secara sah menampilkan file sebagai tidak diakses bahkan jika subproses lebih lanjut akan dimulai untuk menulis ke sana nanti. </li>\n</ul>\n\n<p> Kondisi balapan lain yang lebih halus mungkin ada juga - dan terlepas dari itu, fuser dan semacamnya bukanlah alat POSIX dan tidak tersedia di semua tempat. </p>\n\n<p> Mengharuskan sebagai masalah protokol bahwa proses penulisan file memindahkannya ke lokasi akhir saat penyelesaian itu sendiri; itu satu-satunya pendekatan yang aman dan portabel. </p>\n\n<p> EDIT: Telah diklarifikasi bahwa file ditulis bukan dengan proses sewenang-wenang (yang mungkin menutup dan membukanya kembali) tetapi oleh server FTP. Pada kasus ini, <a href=\"http://inotify.aiken.cz/\" rel=\"nofollow noopener\" target=\"_blank\"> incron </a> dapat digunakan untuk menjalankan skrip arbitrer setiap kali file ditutup di direktori ini. </p>","votes":"2","source":"https://superuser.com/a/112279","author":"<a href=\"https://superuser.com/users/31769/charles-duffy\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Charles Duffy</span></a>","replies":[{"reply":"Terima kasih banyak atas infonya. Masalahnya adalah tiga proses aplikasi jarak jauh memasukkan file ke direktori ini. Jadi saya tidak boleh memindahkan file saat mereka menulisnya di direktori / exp / files ini","author":"User"},{"reply":"@arav - Anda dapat menyiasatinya (artinya, <i> saya </i> mengatasi ini) dengan server sftp kustom. (Milik saya ditulis dengan Python menggunakan pustaka Paramiko; ada ftpdlib untuk menulis server FTP standar dengan Python juga, meskipun ada banyak alasan untuk menghindari FTP).","author":"User"},{"reply":"@arav - ... yang mengatakan, bagi saya sepertinya solusi bebas kondisi balapan lain yang akan bekerja untuk Anda adalah menggunakan inotifywatch atau incron untuk menjalankan skrip pilihan Anda setiap kali pembaruan selesai.","author":"User"}]},{"answer":"<p> Saya rasa Anda tidak dapat melakukan ini tanpa mengubah proses yang membuat file-file ini. Setiap kali kami memiliki tugas seperti ini di sistem kami, kami memastikan bahwa proses yang membuat file membuatnya dapat dieksekusi di bagian paling akhir. Jadi proses yang akan memindahkan atau pasca-proses dengan cara lain file tersebut dapat memeriksa bit yang dapat dieksekusi untuk memastikan proses asal telah selesai bekerja dengan file. </p>","votes":"0","source":"https://superuser.com/a/112280","author":"<a href=\"https://superuser.com/users/622606/sha\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">sha</span></a>","replies":[{"reply":"Masalahnya adalah tiga proses aplikasi jarak jauh memasukkan file ke direktori ini. Jadi saya dapat memeriksa bahwa tiga proses aplikasi jarak jauh telah selesai.","author":"User"}]}]}
