{"title":"Powershell one-liner untuk menampilkan proses pada baris yang sama dengan port menggunakan masalah netstat","draft":false,"url":"/powershell-one-liner-untuk-menampilkan-proses-pada-baris-yang-sama-dengan-port-menggunakan-masalah-netstat-b5jh2kge","votes":"4","answers_count":"3","categories":["Komputer"],"tags":["powershell","script","netstat"],"snippet":"Pertama saya hanya ingin memastikan pengguna Erik Bitemo mendapatkan kredit untuk kode asli yang saya gunakan di sini. Outputnya adalah apa yang saya cari dengan satu pengecualian: Salah satu port menghilang dan...","body":"<p> Pertama saya hanya ingin memastikan pengguna Erik Bitemo mendapatkan kredit untuk kode asli yang saya gunakan di sini. Outputnya adalah apa yang saya cari dengan satu pengecualian: Salah satu port menghilang dan &quot;System System5&quot; muncul di tempatnya dan saya tidak tahu mengapa itu terjadi. </p>\n\n<p> Sasaran: Menampilkan semua port TCP (Listening) dan UDP dan proses yang terkait dengan masing-masing pada baris yang sama. </p>\n\n<p> Satu liner digunakan: </p> <pre><code>$nets = netstat -bano|select-string 'LISTENING|UDP'; foreach ($n in $nets)    {    $p = $n -replace ' +',' ';    $nar = $p.Split(' ');    $pname = $(Get-Process -id $nar[-1]).ProcessName;    $n -replace \"$($nar[-1])\",\"$($ppath) $($pname)\";     }\n</code></pre> <p> Contoh Output: </p>\n\n<blockquote>\n  <p> TCP 0.0.0.0:135 0.0.0.0i&gt; LISTENING svchost <br> TCP 0.0.0.0: Sistem Sistem5 0.0.0.0 E5E5E5 LISTENING Sistem <br> TCP 0.0.0.0:623 0.0.0.0 terrible LMS MENDENGARKAN </p>\n</blockquote>\n\n<p> Porta yang diubah adalah 445 tetapi saya tidak tahu mengapa hanya mengubah yang itu ketika port lainnya berfungsi sebagaimana mestinya. Mengapa skrip 445 berubah menjadi &quot;System System5&quot;? </p>\n\n<p> Sayangnya, menggunakan alat lain tidak memungkinkan, jadi saya dibatasi untuk menggunakan alat Windows bawaan. </p>","source":"https://superuser.com/questions/1215093/powershell-one-liner-to-show-process-on-same-line-as-port-using-netstat-issue","author":"<a href=\"https://superuser.com/users/726514/ric\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Ric</span></a>","replies":[{"reply":"Silahkan <a href=\"https://superuser.com/posts/1215093/edit\" target=\"_blank\" rel=\"nofollow noopener\"> edit </a> pertanyaan dan memberikan hasil mentah dari <code>netstat -bano|select-string &#39;LISTENING|UDP&#39;</code>","author":"<a href=\"https://superuser.com/users/337631/davidpostill\" target=\"_blank\" rel=\"nofollow noopener\">DavidPostill&#9830;</a>"}],"answers":[{"answer":"<p> <code>$p</code> bisa seperti <code>TCP 0.0.0.0:445 0.0.0.0:0 LISTENING 4</code> dan <code>$nar[-1]</code> adalah string <code>4</code> sehingga operator <code>-replace</code> mengambil <strong> semua </strong> <code>4</code>-an: </p> <pre><code>TCP 0.0.0.0:445 0.0.0.0:0 LISTENING 4\n            ↑↑                      ↑\n</code></pre> <p> Paksa hanya mengganti kejadian terakhir <code>$nar[-1]</code> menggunakan <em> akhir baris </em> jangkar (lolos <code>$</code>): </p> <pre><code>$p -replace \"$($nar[-1])`$\",\"$ppath $pname\"\n</code></pre> <p> Baca juga jawaban Matt untuk <a href=\"https://stackoverflow.com/a/28437855/3439404\" target=\"_blank\" rel=\"nofollow noopener\"> Mengganti kemunculan terakhir substring dalam string </a> di stackoverflow. </p>\n\n<p> BTW: </p>\n\n<ul>\n<li> <code>$ppath</code> tidak ditentukan… </li>\n<li> … Dan <pre><code>$p -replace \"$($nar[-1])`$\",\"$ppath $pname\"\n</code></pre> sudah cukup (perhatikan bahwa opsi <code>-b</code> dapat memakan waktu dan akan gagal kecuali Anda memiliki izin yang memadai). </li>\n</ul>","votes":"3","source":"https://superuser.com/a/1215199","author":"<a href=\"https://superuser.com/users/376602/josefz\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">JosefZ</span></a>","replies":[{"reply":"Anda menemukan masalahnya dengan pasti. Saya telah menawarkan saran untuk masalah ini juga jika Anda penasaran.","author":"<a href=\"https://superuser.com/users/348943/matt\" target=\"_blank\" rel=\"nofollow noopener\">Matt</a>"}]},{"answer":"<p><a href=\"https://superuser.com/a/1215199/348943\" target=\"_blank\" rel=\"nofollow noopener\"> Jawaban JosefZ </a> menjelaskan masalah Anda dengan sempurna. Anda menggunakan regex dan melakukan persis seperti yang Anda minta, mungkin hanya mengganti lebih dari yang Anda harapkan. </p>\n\n<p> Catatan tambahannya adalah Anda meminta <code>netstat</code> untuk </p>\n\n<blockquote>\n  <p> menampilkan eksekusi yang terlibat dalam membuat setiap koneksi atau port mendengarkan </p>\n</blockquote>\n\n<p> dengan tombol b. Namun Anda menjatuhkannya dengan <code>select-string</code> karena proses itu muncul di barisnya sendiri setelah data lainnya. Itu bukanlah akhir dunia tetapi karena Anda dapat menggunakan hal-hal seperti <code>-Context</code> dari <code>Select-String</code> untuk mendapatkannya tetapi itu harus dilihat lebih dekat di lain waktu. </p>\n\n<p> Saya ingin menawarkan saran lain tentang apa yang dapat Anda lakukan dalam situasi ini. </p>\n\n<blockquote>\n  <p> Sayangnya, menggunakan alat lain tidak memungkinkan, jadi saya dibatasi untuk menggunakan alat Windows bawaan. </p>\n</blockquote>\n\n<p> Lucunya, apakah Anda memiliki setidaknya Windows 8? Jika Anda melakukannya, Anda bisa menggunakan <a href=\"https://technet.microsoft.com/itpro/powershell/windows/nettcpip/get-nettcpconnection\" rel=\"nofollow noopener\" target=\"_blank\"> <code>Get-NetTCPConnection</code> </a> cmdlet yang pada dasarnya <code>netstat</code> dalam bentuk objek. </p>\n\n<p> Jadi Anda bisa melakukan ini yang seharusnya memberi Anda informasi yang sama tanpa kerumitan </p> <pre class=\"lang-ps prettyprint-override\"><code>get-nettcpconnection | select local*,remote*,state,@{Name=\"Process\";Expression={(Get-Process -Id $_.OwningProcess).ProcessName}}\n</code></pre> <p> Tidak punya Windows 8+? Kalau begitu kami bisa meningkatkan skrip parsing Anda. Mengambil satu langkah lebih jauh untuk membuat objek akan mencegah masalah dengan pencocokan ekspresi reguler. </p> <pre class=\"lang-ps prettyprint-override\"><code>netstat -ano | Where-Object{$_ -match 'LISTENING|UDP'} | ForEach-Object{\n    $split = $_.Trim() -split \"\\s+\"\n    [pscustomobject][ordered]@{\n        \"Proto\" = $split[0]\n        \"Local Address\" = $split[1]\n        \"Foreign Address\" = $split[2]\n        # Some might not have a state. Check to see if the last element is a number. If it is ignore it\n        \"State\" = if($split[3] -notmatch \"\\d+\"){$split[3]}else{\"\"}\n        # The last element in every case will be a PID\n        \"Process Name\" = $(Get-Process -Id $split[-1]).ProcessName\n    }\n}\n</code></pre> <p> Jika Anda terbatas pada PowerShell v2 maka Anda perlu mengubah psobject dan memerintahkan cast </p> <pre class=\"lang-ps prettyprint-override\"><code>netstat -ano | Where-Object{$_ -match 'LISTENING|UDP'} | ForEach-Object{\n    $split = $_.Trim() -split \"\\s+\"\n    New-Object -Type pscustomobject -Property @{\n        \"Proto\" = $split[0]\n        \"Local Address\" = $split[1]\n        \"Foreign Address\" = $split[2]\n        # Some might not have a state. Check to see if the last element is a number. If it is ignore it\n        \"State\" = if($split[3] -notmatch \"\\d+\"){$split[3]}else{\"\"}\n        # The last element in every case will be a PID\n        \"Process Name\" = $(Get-Process -Id $split[-1]).ProcessName\n    }\n} | Select \"Proto\", \"Local Address\", \"Foreign Address\", \"State\", \"Process Name\" \n</code></pre> <p> Pernyataan <code>select</code> terakhir menjamin urutan properti, yang akan dikocok sebaliknya, dan fungsinya setara dengan <code>[ordered]</code> </p>\n\n<p> Sehingga akan menghasilkan keluaran seperti ini ... </p> <pre><code>Proto Local Address Foreign Address State     Process Name  \n----- ------------- --------------- -----     ------------  \nTCP   0.0.0.0:135   0.0.0.0:0       LISTENING svchost       \nTCP   0.0.0.0:445   0.0.0.0:0       LISTENING System        \nTCP   0.0.0.0:1279  0.0.0.0:0       LISTENING PlexDlnaServer\nTCP   0.0.0.0:2869  0.0.0.0:0       LISTENING System  \n</code></pre> <p> Yang kemudian dapat Anda perlakukan seperti Anda memperlakukan objek dan filter PowerShell sesuai keinginan atau keluaran ke CSV atau apa pun yang perlu Anda lakukan. Itu terstruktur sekarang. </p>\n\n<p> Bergantung pada versi PowerShell Anda, Anda juga dapat menggunakan <a href=\"https://msdn.microsoft.com/en-us/powershell/reference/5.1/microsoft.powershell.utility/convertfrom-string\" rel=\"nofollow noopener\" target=\"_blank\"> <code>Convert-FromString</code> </a> yang mengambil string baris tunggal dan mengubahnya menjadi objek juga. Sesuatu yang lain untuk dicari. </p>","votes":"6","source":"https://superuser.com/a/1215237","author":"<a href=\"https://superuser.com/users/348943/matt\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Matt</span></a>","replies":[{"reply":"Ini sangat membantu. Terima kasih atas bantuannya.","author":"<a href=\"https://superuser.com/users/726514/ric\" target=\"_blank\" rel=\"nofollow noopener\">Ric</a>"},{"reply":"Solusi Anda akan ideal tetapi tampaknya itu membutuhkan setidaknya Powershell 3 atau 4. Ketika dijalankan pada mesin Windows 7 itu segera error. Apakah mungkin membuat perubahan untuk menghindari ini? Kesalahannya adalah &quot;Tidak dapat menemukan jenis [dipesan]: pastikan bahwa rakitan yang berisi jenis ini dimuat.&quot;","author":"<a href=\"https://superuser.com/users/726514/ric\" target=\"_blank\" rel=\"nofollow noopener\">Ric</a>"},{"reply":"Gips itu akan menyebabkan masalah ya. Mudah untuk diatasi. Saya akan menambahkan pembaruan cepat untuk Anda.","author":"<a href=\"https://superuser.com/users/348943/matt\" target=\"_blank\" rel=\"nofollow noopener\">Matt</a>"},{"reply":"Informasi proses tampaknya tidak tersedia di Windows 2012 (non-R2). Kemungkinan besar itu juga tidak tersedia di Windows 8.0.","author":"<a href=\"https://superuser.com/users/3677/thorarin\" target=\"_blank\" rel=\"nofollow noopener\">Thorarin</a>"}]},{"answer":"<p> Lebih sederhana ... </p> <pre><code>filter timestamp {\"$(Get-Date -Format G): $_\"};netstat -abno 1 | Select-String -Context 0,1 -Pattern LISTENING|timestamp\n</code></pre>","votes":"-1","source":"https://superuser.com/a/1294388","author":"<a href=\"https://superuser.com/users/871575/jhon-willmaure\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Jhon Willmaure</span></a>","replies":[]}]}
