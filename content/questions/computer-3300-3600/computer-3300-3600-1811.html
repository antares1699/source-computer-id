{"title":"Menyalurkan perintah ke nc","draft":false,"url":"/menyalurkan-perintah-ke-nc-8ekmipqf","votes":"4","answers_count":"2","categories":["Komputer"],"tags":["linux","bash","netcat","cat","stdin"],"snippet":"Sepertinya saya telah mencari banyak pertanyaan yang sangat mirip tetapi tidak pernah menemukan sesuatu yang berhasil. Saya mencoba menggunakan raspberry pi (generasi ke-2) untuk berkomunikasi dengan sensor Wifi OBDII. Saya dapat menggunakan...","body":"<p> Sepertinya saya telah mencari banyak pertanyaan yang sangat mirip tetapi tidak pernah menemukan sesuatu yang berhasil. Saya mencoba menggunakan raspberry pi (generasi ke-2) untuk berkomunikasi dengan sensor Wifi OBDII. Saya dapat menggunakan perintah berikut </p> <pre><code>nc -C 192.168.0.10 35000\n</code></pre> <p> 192.168.0.10 adalah sensor mobil dan 35000 port. Itu tidak relevan karena menghubungkan tampaknya baik-baik saja. Bagaimanapun, saya dapat membuka instance nc dan kemudian mengetik, misalnya &quot;0145&quot; (kode sensor), dan sebagai gantinya saya mendapatkan nilai untuk sensor itu kembali pada output sesi nc (misalnya, RPM mesin saya ). Itu bekerja dengan baik. Apa yang ingin saya lakukan adalah perintah pipa dari file teks ke sesi nc untuk tujuan perencanaan. Jadi hasil ideal saya adalah aliran konstan nilai RPM dan waktu terkait dibuang ke file teks. Saya bisa bekerja dari sana. Namun, saya tidak tahu persis bagaimana melakukan itu. Saya telah menyiapkan sebuah commands.txt yang terdiri dari ribuan baris &quot;0145&quot; dan saya ingin membaca file itu dan meneruskannya baris demi baris ke nc (saya mungkin dapat mengontrol interval pengambilan sampel dengan tidur), lalu membaca output dan menyimpannya ke dalam file teks. Saya tahu masalah ini ada hubungannya dengan stdin dan stdout dan piping, tetapi untuk alasan apa pun, saya belum bisa mendapatkannya. Saya sama sekali bukan master dalam semua itu. Saya juga ingin membuat skrip seluruh proses. </p>\n\n<p> Sekarang, jika saya lari </p> <pre><code>cat &lt;(echo 0145) - | nc -C 192.168.0.10 35000\n</code></pre> <p> yang memberi saya output di terminal yang saya inginkan, tetapi hanya berfungsi untuk satu nilai. Tetapi segera setelah saya mencoba memasukkannya ke dalam satu lingkaran, di mana saya membuat 0145 itu menjadi $ perintah dalam skrip dan mendapatkan $ perintah baris demi baris dari file txt, itu berhenti bekerja. Faktanya, ia berhenti bekerja di dalam loop mana pun atau jika blok bahkan jika saya membiarkannya sebagai 0145 dan tidak menggunakan variabel. </p>\n\n<p> Jadi, singkatnya, saya ingin skrip mengirimkan file txt baris demi baris ke koneksi nc, dan kemudian saya ingin mengekstrak setiap respons ke file lain. Jika itu tidak ditulis, saya dapat membuka koneksi nc itu dan mengirim 0145 setiap 1 detik dan mendapatkan tanggapan tersebut (masih tidak tahu cara meneruskannya ke file), tetapi itu hampir tidak efisien. Saya merasa harus ada cara yang lebih mudah untuk melakukan ini. Saya agak noob tapi pikir id mencobanya di sini. Bantuan apa pun sangat dihargai </p>","source":"https://superuser.com/questions/1122117/piping-commands-into-nc","author":"<a href=\"https://superuser.com/users/638849/markysm\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Markysm</span></a>","replies":[],"answers":[{"answer":"<p> Mungkin ada banyak cara untuk melakukan ini. </p>\n\n<p><strong> Dengan netcat </strong></p>\n\n<p> Masalah dengan <em> netcat </em> adalah menutup koneksi segera setelah mendeteksi akhir file. Implementasi GNU dari <em> netcat </em> memang memiliki beberapa opsi ( <em> -k </em> atau <em> -w -1 </em> ) agar instance mendengarkan tetap terbuka tanpa batas waktu, tetapi tidak ada yang berfungsi. Apa pekerjaan itu <em> nmap </em> versi <em> netcat </em> , dipanggil <strong> ncat </strong> . </p>\n\n<p> Di komputer Anda, instal <em> nmap </em> paket, lalu terbitkan: </p> <pre><code>mkfifo return_pipe\nncat -k -l 12345 0&lt;return_pipe| ncat -C 192.168.0.10 35000 1&gt;return_pipe &amp;\n</code></pre> <p> Sekarang Anda dapat mentransfer semua yang Anda suka, dalam banyak kelompok berbeda, melalui </p> <pre><code>echo Ciao | ncat localhost 12345\ncat somefile.txt | ncat localhost 12345 \n</code></pre> <p> tanpa koneksi terputus, asalkan pendengar Anda bekerja sama ( <em> yaitu </em> , itu tidak berhenti mendengarkan setelah akhir file pertama). Atau Anda dapat membuat bagian ini lebih sederhana dengan menggunakan file <em> bernama pipa </em> : dari terminal yang berbeda dari terminal tempat Anda mengeluarkan perintah pertama, </p> <pre><code>mkfifo mypipe\ntail -f mypipe | ncat localhost 12345 &amp;\necho Ciao &gt; mypipe\ncat somefile.txt &gt; mypipe\n</code></pre> <p> Itu <strong> pesan balasan </strong> dari perangkat Anda sekarang dalam pipa bernama <em> return_pipe </em> . Perintah </p> <pre><code>tail -f return_pipe &gt;&gt; responses\n</code></pre> <p> menambahkan respons perangkat ke file yang disebut <em> tanggapan </em> . </p>\n\n<p><strong> Tanpa netcat </strong></p>\n\n<p> Ini telah ditunjukkan oleh <em> Ipor Sircer </em> (bagus !, +1 dari saya). Tapi saya akan melakukannya sedikit berbeda, </p> <pre><code>exec 3&gt;/dev/tcp/192.168.0.10/35000\nexec 4&lt;/dev/tcp/192.168.0.10/35000\nexec 4&gt;&gt;somefile.out\necho \"Ciao\" &gt;&amp;3 \ncat somefile.txt &gt;&amp;3\n</code></pre> <p> jika Anda juga ingin melacak perintah Anda, </p> <pre><code>echo Ciao | tee  -a file_with_my_commands 1&gt;&amp;3\ncat somefile.txt | tee -a file_with_my_commands 1&gt;&amp;3\n</code></pre> <p> dan, setelah Anda selesai dengan komunikasi ini, </p> <pre><code>exec 3&gt;&amp;-\nexec 4&gt;&amp;-\n</code></pre>","votes":"4","source":"https://superuser.com/a/1122897","author":"<a href=\"https://superuser.com/users/255732/mariusmatutiae\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">MariusMatutiae</span></a>","replies":[]},{"answer":"<p> Mengapa Anda menggunakan <code>netcat</code>? <code>Bash</code> dapat menangani soket tcp dengan alias bawaan. </p> <pre><code>n=0\nwhile read -r line;do\n ((n++))\n exec 3&lt;&gt;/dev/tcp/192.168.0.10/35000\n echo -e \"$line\" &gt;&amp;3\n cat &lt;&amp;3 &gt; response.$n\n exec 3&lt;&amp;-\n exec 3&gt;&amp;-\ndone &lt; data.txt\n</code></pre>","votes":"4","source":"https://superuser.com/a/1122119","author":"<a href=\"https://superuser.com/users/607525/ipor-sircer\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Ipor Sircer</span></a>","replies":[{"reply":"Saya mencobanya, tetapi saya belum cukup berhasil melakukan apa yang saya butuhkan. Hanya untuk memahami dengan benar: $ line akan menjadi baris yang diberikan dari data.txt?","author":"<a href=\"https://superuser.com/users/638849/markysm\" target=\"_blank\" rel=\"nofollow noopener\">Markysm</a>"},{"reply":"Iya. setiap baris akan disalurkan ke soket tcp, dan setiap respons akan disimpan di file respone. &lt;linenumber&gt;","author":"<a href=\"https://superuser.com/users/607525/ipor-sircer\" target=\"_blank\" rel=\"nofollow noopener\">Ipor Sircer</a>"},{"reply":"Oh tunggu, sepertinya saya tidak memiliki / dev / tcp ketika saya ls di / dev","author":"<a href=\"https://superuser.com/users/638849/markysm\" target=\"_blank\" rel=\"nofollow noopener\">Markysm</a>"},{"reply":"Karena ini adalah alias bash bawaan.","author":"<a href=\"https://superuser.com/users/607525/ipor-sircer\" target=\"_blank\" rel=\"nofollow noopener\">Ipor Sircer</a>"},{"reply":"Ini tidak tepat di tempat yang saya inginkan karena alasan tertentu, tetapi ini adalah langkah besar ke arah yang benar. Saya telah memotong file data.txt saya menjadi hanya 5 baris untuk kesederhanaan (dan jadi saya tidak mendapatkan 1000 file respon), tetapi sejauh ini saya hanya dapat menghasilkan satu respon. 1 file (sepertinya tidak menjadi perulangan)","author":"<a href=\"https://superuser.com/users/638849/markysm\" target=\"_blank\" rel=\"nofollow noopener\">Markysm</a>"},{"reply":"jawaban yang diperbarui dengan soket penutup. tetapi daemon di rpi harus melakukannya, atau Anda dapat mengirim perintah untuk menutup soket. tidak terlalu sehat untuk menutup paksa soket.","author":"<a href=\"https://superuser.com/users/607525/ipor-sircer\" target=\"_blank\" rel=\"nofollow noopener\">Ipor Sircer</a>"},{"reply":"Ada sesuatu yang masih kurang beres, jika saya mendapatkan kode baris demi baris, itu adalah 1. membaca baris dari data.txt (tidak yakin apa yang -r lakukan), 2. menambah n 3. membuka soket 4. echoing $ baris ke soket (perhatikan bahwa perintah harus diikuti oleh carriage return atau baris baru atau sesuatu yang menyebabkan register), 5. membaca dari soket TCP 6/7 tutup soket dan loop. Namun itu tidak tetap perulangan dan di terminal ketika saya menjalankan skrip itu hang sampai saya membunuhnya","author":"<a href=\"https://superuser.com/users/638849/markysm\" target=\"_blank\" rel=\"nofollow noopener\">Markysm</a>"},{"reply":"juga, itu hanya menulis apa yang saya masukkan (baris dari data.txt) tetapi bukan respons dari perangkat (tidak yakin apakah tidak mendapatkannya atau tidak menulisnya). NVM, ketika saya menambahkan \\ r ke dalam gema maka ia mendapat respons. Tapi tetap tidak perulangan","author":"<a href=\"https://superuser.com/users/638849/markysm\" target=\"_blank\" rel=\"nofollow noopener\">Markysm</a>"}]}]}
