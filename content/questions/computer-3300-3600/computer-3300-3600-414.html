{"title":"Membuat program selalu dijalankan sebagai root di OS X","draft":false,"url":"/membuat-program-selalu-dijalankan-sebagai-root-di-os-x-e4j2yrik","votes":"4","answers_count":"2","categories":["Komputer"],"tags":["macos","unix","permissions","chmod"],"snippet":"Saya mencoba membuat program C selalu berjalan sebagai root, tidak peduli siapa yang memanggilnya.Pada dasarnya, saya ingin menjalankan &quot;mkdir / test&quot; sebagai contoh.Jadi saya membuat program C sebagai berikut:  #include...","body":"<p> Saya mencoba membuat program C selalu berjalan sebagai root, tidak peduli siapa yang memanggilnya.\nPada dasarnya, saya ingin menjalankan &quot;mkdir / test&quot; sebagai contoh.\nJadi saya membuat program C sebagai berikut: </p> <pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\nsystem(\"mkdir /test\");\nprintf(\"bye...\\n\");\nreturn 0;\n}\n</code></pre> <p> Sekarang, saya baru saja menyusunnya:\n    gcc test.c -o test </p>\n\n<p> Dan sekarang saya mencoba mengatur izin: </p> <pre><code>chmod +s test\n</code></pre> <p> Namun menjalankannya sebagai pengguna biasa, saya mendapatkan kesalahan izin ditolak. Jadi, itu mengeksekusi file tetapi tidak dengan izin root.\nSaya juga mencoba mengatur izin sebagai: </p> <pre><code>chmod a+s test\nchmod o+s test\n</code></pre> <p> Tapi saya selalu mendapatkan masalah yang sama. </p>\n\n<p> Adakah yang bisa membantu saya dengan ini?\nNgomong-ngomong, file test.c sedang dibuat oleh root dan juga sedang dikompilasi sebagai root. </p> <pre><code>bash-3.2# ls -al | grep test \n-rwxr-xr-x   1 root   staff       8796  5 Ago 19:07 test\nbash-3.2# chmod +s test\nbash-3.2# ls -al | grep test \n-rwsr-sr-x   1 root   staff       8796  5 Ago 19:07 test\nbash-3.2# whoami\nroot\nbash-3.2#\n</code></pre> <p> Terima kasih sebelumnya!\nCheerz! </p>","source":"https://superuser.com/questions/457868/making-a-program-always-run-as-root-in-os-x","author":"<a href=\"https://superuser.com/users/150489/yaroze\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">yaroze</span></a>","replies":[],"answers":[{"answer":"<p> Ada dua hal yang perlu diketahui di sini: </p>\n\n<ul>\n<li><p> Itu <a href=\"http://en.wikipedia.org/wiki/Sticky_bit\" rel=\"nofollow noopener\" target=\"_blank\"> sedikit lengket </a> , yang dapat digunakan pada file dan direktori, tetapi tidak akan melakukan apa yang Anda inginkan. Dari <a href=\"https://developer.apple.com/library/mac/#documentation/Darwin/Reference/ManPages/man8/sticky.8.html\" rel=\"nofollow noopener\" target=\"_blank\"> <code>sticky(8)</code> </a> : <em> Bit lengket tidak berpengaruh pada file yang dapat dieksekusi </em> . </p></li>\n<li><p> Itu <a href=\"http://en.wikipedia.org/wiki/Setuid\" rel=\"nofollow noopener\" target=\"_blank\"> <code>setuid</code> </a> flag, yang akan memungkinkan program dijalankan dengan izin pemiliknya. Apa yang tampaknya menjadi batasan di OS X, dan tampaknya tidak didokumentasikan, adalah bahwa bit setuid pada yang dapat dieksekusi memiliki efek hanya jika yang dapat dieksekusi ada dalam direktori yang dimiliki oleh root (dan tidak terbuka untuk ditulis oleh orang lain), dll, hingga direktori root. Jika tidak, itu akan diabaikan untuk alasan keamanan. </p></li>\n</ul>\n\n<p> Bagaimanapun, Anda dapat memodifikasi file sudoers sedemikian rupa sehingga tidak memerlukan kata sandi untuk satu perintah. Ingatlah bahwa Anda <em> memiliki </em> menggunakan <code>visudo</code> untuk mengeditnya. Jika Anda berhasil mendapatkan sintaks yang salah saat mengedit file, Anda tidak akan dapat menjalankan <code>sudo</code> sama sekali. </p> <pre><code>sudo visudo\n</code></pre> <p> Lalu tekan <kbd> saya </kbd> , dan di sisipan bawah: </p> <pre><code>username    ALL= NOPASSWD: /path/to/command\n</code></pre> <p> Di sini, Anda jelas perlu mengubah <code>username</code> untuk pengguna yang seharusnya menjalankan perintah tanpa harus mengetikkan kata sandi. Juga, ubah jalur ke file yang dapat dieksekusi. Perhatikan bahwa pada titik ini, executable dapat dimiliki oleh <code>root</code> dan memiliki izin eksekusi hanya untuk <code>root</code> juga. </p>\n\n<p> tekan <kbd> ESC </kbd> , lalu tulis <code>:wq</code>, lalu <kbd> Memasukkan </kbd> . </p>\n\n<p> Sekarang, pengguna <code>username</code> dapat menjalankan perintah dengan <code>sudo /path/to/command</code> dan tidak perlu memasukkan kata sandi untuk melakukannya. </p>","votes":"11","source":"https://superuser.com/a/457870","author":"<a href=\"https://superuser.com/users/48078/slhck\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">slhck</span></a>","replies":[{"reply":"Bagian lengket tidak ada hubungannya dengan setuid, itulah mengapa saya merasa aneh saat penanya mengungkitnya.","author":"<a href=\"https://superuser.com/users/26316/ignacio-vazquez-abrams\" target=\"_blank\" rel=\"nofollow noopener\">Ignacio Vazquez-Abrams</a>"},{"reply":"Keren! Saya tidak tahu itu. Ya, sepertinya lebih aman seperti itu.","author":"<a href=\"https://superuser.com/users/150489/yaroze\" target=\"_blank\" rel=\"nofollow noopener\">yaroze</a>"},{"reply":"@ IgnacioVazquez-Abrams, Anda sepenuhnya benar. Terima kasih telah menunjukkannya. Saya sudah mengedit pertanyaannya.","author":"<a href=\"https://superuser.com/users/150489/yaroze\" target=\"_blank\" rel=\"nofollow noopener\">yaroze</a>"},{"reply":"Jika program memerlukan izin root untuk berfungsi, Anda selalu dapat memeriksa ID pengguna Anda saat ini, dan jika bukan nol, coba jalankan <code>sudo $0</code> (atau yang setara). Jika itu berhasil, bagus; jika tidak cetak pesan kesalahan dan keluar. Karena ini bukanlah perilaku yang diharapkan, Anda tidak boleh melakukan ini untuk sesuatu yang ingin Anda distribusikan.","author":"<a href=\"https://superuser.com/users/22317/daniel-beck\" target=\"_blank\" rel=\"nofollow noopener\">Daniel Beck&#9830;</a>"},{"reply":"Bit setuid tidak diabaikan di OS X, menurut Anda bagaimana program seperti sudo yang Anda sebutkan akan dapat bekerja jika tidak karena itu adalah setuid root? Apa yang tampaknya menjadi batasan di OS X, dan tampaknya tidak didokumentasikan, adalah bahwa bit setuid pada yang dapat dieksekusi memiliki efek hanya jika yang dapat dieksekusi ada dalam direktori yang dimiliki oleh root (dan tidak terbuka untuk ditulis oleh orang lain), dll, hingga direktori root.","author":"<a href=\"https://superuser.com/users/106134/tml\" target=\"_blank\" rel=\"nofollow noopener\">tml</a>"}]},{"answer":"<p> Saya bekerja di Linux, tetapi karena OSX hanyalah BSD, saya menganggapnya mengikuti aturan (umum) yang sama seperti Unix lainnya. </p>\n\n<p> Dalam program Anda, Anda perlu memanggil setuid (UID), yang mengembalikan 0 jika berhasil, untuk membuatnya berjalan sebagai UID itu dan Anda ingin menjalankannya sebagai root. UID root adalah <strong><em> mungkin </em></strong> 0, tetapi jika Anda sangat paranoid, gunakan getpwnam (const char * szUserName) untuk mendapatkan UID. </p>\n\n<p> Jadi, sesuatu seperti ini: </p> <pre><code>#include &lt;stdio.h&gt; // needed for printf\n\n#include &lt;sys/types.h&gt;\n#include &lt;pwd.h&gt;\n#include &lt;unistd.h&gt;\n\nvoid change_to_user (const char *szUserName)\n{\n  struct passwd *pw;\n\n  pw = getpwnam(szUserName);\n  if (pw != NULL)\n  {\n    uid_t uid = pw-&gt;pw_uid; // we now have the UID of the username\n\n    printf (\"UID of user %s is %d\\n\", szUserName, (int)uid);\n    if (setuid (uid) != 0)\n    {\n      perror (\"setuid\");\n    }\n    else\n    {\n      // this will fail if you try to change to root without the SUID\n      // bit set.  This executive needs to be owned by root (probably\n      // group owned by root as well), and set the SUID bit with:\n      //   suid a+s {executable}\n      printf (\"UID is now %d\\n\", (int)uid);\n    }\n  }\n  else\n  {\n    perror (\"getpwnam\");\n  }\n}\n\n\nint main (int argc, char **argv)\n{\n  int iIter;\n\n  if (argc == 1)\n  {\n    printf (\"Give me a user name\\n\");\n    return 1;\n  }\n\n  for (iIter = 1 ; iIter &lt; argc ; iIter++)\n  {\n    change_to_user (argv[iIter]);\n  }\n  return 0;\n}\n</code></pre> <p> Anda dapat mengaturuid ke nama pengguna APA PUN, jadi mungkin Anda menjalankan skrip cgi, dan Anda ingin menjalankan sebagai nama pengguna di akun Anda sendiri, bukan &quot;www-data&quot; atau apa pun - Anda dapat menggunakannya di sana. Saya melakukan ini, itulah sebabnya saya dapat menjawab pertanyaan Anda secara rinci. </p>","votes":"1","source":"https://superuser.com/a/1316546","author":"<a href=\"https://superuser.com/users/898017/richard-wicks\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Richard Wicks</span></a>","replies":[]}]}
