{"title":"Bagaimana cara menggunakan ENV {SYSTEMD_USER_WANTS} = dalam aturan udev?","draft":false,"url":"/bagaimana-cara-menggunakan-env-systemd-user-wants-dalam-aturan-udev-sx7gvwdr","votes":"4","answers_count":"3","categories":["Komputer"],"tags":["linux","systemd","udev"],"snippet":"Saya ingin menyiapkan docked.target di systemd tingkat pengguna saya. Idenya adalah menjalankan beberapa layanan untuk mengkonfigurasi tampilan eksternal saya.  Saat ini saya memiliki ini sebagai aturan saya:  SUBSYSTEM==\"usb\", ACTION==\"add\", ENV{ID_VENDOR}==\"17ef\", ENV{ID_MODEL}==\"100a\", SYMLINK+=\"tp_mini_dock\",...","body":"<p> Saya ingin menyiapkan <code>docked.target</code> di systemd tingkat pengguna saya. Idenya adalah menjalankan beberapa layanan untuk mengkonfigurasi tampilan eksternal saya. </p>\n\n<p> Saat ini saya memiliki ini sebagai aturan saya: </p> <pre><code>SUBSYSTEM==\"usb\", ACTION==\"add\", ENV{ID_VENDOR}==\"17ef\", ENV{ID_MODEL}==\"100a\", SYMLINK+=\"tp_mini_dock\", TAG+=\"systemd\", ENV{SYSTEMD_USER_WANTS}=\"docked.target\"\n</code></pre> <p> Aturan terdeteksi dengan baik (saya dapat melihat <code>dev-tp_mini_dock.device</code> saat saya berlabuh). </p>\n\n<p> Saya kemudian memilikinya di <code>~/.config/systemd/user/docked.target</code> (juga mencoba <code>/etc/systemd/user</code> tidak berhasil): </p> <pre><code>[Unit]\nDescription=Docked to ThinkPad Mini Dock\nBindTo=dev-tp_mini_dock.device\n</code></pre> <p> Tapi ini tidak dimulai saat saya merapat. Namun, jika saya memulai <code>docked.target</code> secara manual saat dipasang ke dok, ini berhenti seperti yang diharapkan saat saya melepas sambungan. </p>\n\n<p> Namun, jika saya menggunakan <code>ENV{SYSTEMD_WANTS}=\"docked.target\"</code> dan meletakkan file di <code>/etc/systemd/system/docked.target</code>, target mulai seperti yang diharapkan saat saya berlabuh. Masalahnya kemudian, adalah bahwa instance tingkat pengguna saya tidak tahu tentang layanan / target tingkat sistem. </p>\n\n<p> Ada pemikiran? Saya telah melihat beberapa pertanyaan lain di internet, dan yang hampir persis seperti pertanyaan saya: <a href=\"https://bbs.archlinux.org/viewtopic.php?pid=1600019\" rel=\"nofollow noopener\" target=\"_blank\"> https://bbs.archlinux.org/viewtopic.php?pid=1600019 </a></p>","source":"https://superuser.com/questions/1033270/how-do-i-use-envsystemd-user-wants-in-udev-rule","author":"<a href=\"https://superuser.com/users/221209/aiguofer\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">aiguofer</span></a>","replies":[],"answers":[{"answer":"<p> Anda dapat mencoba mengganti <code>SYSTEMD_USER_WANTS</code> dengan <code>MANAGER_USER_WANTS</code>. Saya tidak 100% yakin tentang perubahan nama ini, tetapi setidaknya pada <code>systemd-226</code> tidak ada lagi penyebutan <code>SYSTEMD_USER_WANTS</code> di sumber dan tampaknya diganti dengan <code>MANAGER_USER_WANTS</code>. Setidaknya itu berhasil untuk saya untuk kasus serupa. </p>","votes":"3","source":"https://superuser.com/a/1061648","author":"<a href=\"https://superuser.com/users/579237/pavel-procopiuc\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Pavel Procopiuc</span></a>","replies":[]},{"answer":"<p> Meskipun saya masih tidak tahu cara kerja <code>ENV{SYSTEMD_USER_WANTS}</code>, saya berhasil menyelesaikan masalah khusus saya setelah membaca <a href=\"http://blog.tjll.net/systemd-for-device-activation-and-media-archiving/\" rel=\"nofollow noopener\" target=\"_blank\"> blog ini </a> . </p>\n\n<p> Ternyata saya dapat memasang target sebagai ketergantungan pada perangkat. Saya mengubah file unit saya <code>~/.config/systemd/user/docked.target</code> menjadi: </p> <pre><code>[Unit]\nDescription=Docked to ThinkPad Mini Dock\nBindsTo=dev-tp_mini_dock.device\nAfter=dev-tp_mini_dock.device\n\n[Install]\nWantedBy=dev-tp_mini_dock.device\n</code></pre> <p> dan aturan udev saya untuk: </p> <pre><code>SUBSYSTEM==\"usb\", ACTION==\"add\", ENV{ID_VENDOR}==\"17ef\", ENV{ID_MODEL}==\"100a\", SYMLINK+=\"tp_mini_dock\", TAG+=\"systemd\"\n</code></pre> <p> dan kemudian aktifkan dengan <code>systemctl --user enable docked.target</code>. </p>\n\n<p> Sekarang, ketika saya menggalangkannya, aturan udev membuat perangkat systemd, yang pada gilirannya memulai target. Kemudian opsi <code>BindsTo</code> memastikan bahwa ketika perangkat menghilang (dicabut) target dihentikan. </p>\n\n<p> Saya harus melakukan sihir yang tidak masuk akal agar ini berfungsi ketika saya masuk dengan dok sudah terpasang. Orang akan membayangkan bahwa menambahkan <code>default.target</code> ke <code>WantedBy</code> dan <code>After</code> saja sudah cukup ... Saya akan menambahkan tautan ke blog setelah saya tulis itu. </p>","votes":"2","source":"https://superuser.com/a/1033967","author":"<a href=\"https://superuser.com/users/221209/aiguofer\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">aiguofer</span></a>","replies":[]},{"answer":"<p> Man ... Masalah itu membuatku mual juga, sungguh menyebalkan! </p>\n\n<p> Dalam kasus saya, saya ingin mendengarkan acara HDMI (monitor hotplug), dan saya menemukan trik untuk mengatasi masalah ini. Saya berpikir, baiklah, jika <code>udev</code> ini entah bagaimana mengetahui bahwa ia memulai layanan dengan nama ini atau itu dan menolak untuk melakukannya lagi, maka mari kita membuatnya percaya bahwa ia memulai layanan baru setiap saat. Semua mata tertuju pada acara <code>udev</code> yang sesuai: </p> <pre><code>UDEV  [19214.534185] change   /devices/pci0000:00/0000:00:01.0/0000:01:00.0/drm/card0 (drm)\nACTION=change\nDEVLINKS=/dev/dri/by-path/pci-0000:01:00.0-card\nDEVNAME=/dev/dri/card0\nDEVPATH=/devices/pci0000:00/0000:00:01.0/0000:01:00.0/drm/card0\nDEVTYPE=drm_minor\nHOTPLUG=1\nID_FOR_SEAT=drm-pci-0000_01_00_0\nID_PATH=pci-0000:01:00.0\nID_PATH_TAG=pci-0000_01_00_0\nMAJOR=226\nMINOR=0\nSEQNUM=3364\nSUBSYSTEM=drm\nUSEC_INITIALIZED=3280572\n</code></pre> <p> dan perhatikan <code>SEQNUM</code>. Itu berubah di setiap acara baru dan itulah yang kami inginkan: </p> <pre><code>ACTION==\"change\", SUBSYSTEM==\"drm\", ENV{HOTPLUG}==\"1\", ENV{SYSTEMD_USER_WANTS}+=\"monitor-hotplug@$env{SEQNUM}.service\", TAG+=\"systemd\"\n</code></pre> <p> Bekerja seperti pesona bahkan untuk <code>~/.config/systemd/user/monitor-hotplug@.service</code>. Mudah-mudahan, acara Anda juga memiliki <code>SEQNUM</code> atau yang serupa. </p>","votes":"1","source":"https://superuser.com/a/1401322","author":"<a href=\"https://superuser.com/users/166253/alexander-shukaev\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Alexander Shukaev</span></a>","replies":[]}]}
