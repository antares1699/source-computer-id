{"title":"Tambahkan elemen baru ke larik JSON yang sudah ada","draft":false,"url":"/tambahkan-elemen-baru-ke-larik-json-yang-sudah-ada-prawtxcj","votes":"4","answers_count":"1","categories":["Komputer"],"tags":["sed","bash-scripting","perl"],"snippet":"Bagaimana saya dapat menambahkan baris \"arn:aws:iam::xxxxxxx:role/3\" di bawah \"arn:aws:iam::xxxxxxx:role/2\" menambahkan koma setelah \"arn:aws:iam::xxxxxxx:role/2\" ,.  Sebelum:  {  \"Version\": \"2012-10-17\",  \"Statement\": [    {      \"Effect\": \"Allow\",      \"Principal\": {        \"Service\": \"ec2.amazonaws.com\"      },      \"Action\": \"sts:AssumeRole\"    },    {...","body":"<p> Bagaimana saya dapat menambahkan baris <code>\"arn:aws:iam::xxxxxxx:role/3\"</code> di bawah <code>\"arn:aws:iam::xxxxxxx:role/2\"</code> menambahkan koma setelah <code>\"arn:aws:iam::xxxxxxx:role/2\"</code> ,. </p>\n\n<p> Sebelum: </p> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"AWS\": [\n          \"arn:aws:iam::xxxxxxx:role/1\",\n          \"arn:aws:iam::xxxxxxx:role/2\"\n        ]\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\n</code></pre> <p> Setelah </p> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"AWS\": [\n          \"arn:aws:iam::xxxxxxx:role/1\",\n          \"arn:aws:iam::xxxxxxx:role/2\",\n          \"arn:aws:iam::xxxxxxx:role/3\"\n        ]\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\n</code></pre>","source":"https://superuser.com/questions/1538453/add-a-new-element-to-existing-json-array","author":"<a href=\"https://superuser.com/users/1029766/tr53\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">tr53</span></a>","replies":[],"answers":[{"answer":"<p> Jangan mencoba mengurai teks JSON dengan alat pemrosesan teks standar seperti <code>awk</code>, <code>sed</code> atau tanpa modul JSON pada <code>perl</code>, karena mereka tidak memahami sintaks JSON. <code>jq</code> adalah prosesor JSON ringan yang memungkinkan Anda memanipulasi konten dengan cepat. </p>\n\n<p> Untuk mis. kebutuhan Anda dapat dengan mudah ditulis sebagai </p> <pre><code>jq --arg new \"arn:aws:iam::xxxxxxx:role/3\" '.Statement[].Principal.AWS? += [$new]' json\n</code></pre> <p> Jika ada lebih dari satu elemen yang akan ditambahkan, buat arg sebagai blob JSON </p> <pre><code>jq --argjson new '[\"arn:aws:iam::xxxxxxx:role/3\", \"arn:aws:iam::xxxxxxx:role/4\"]' '.Statement[].Principal.AWS? += $new'\n</code></pre> <p> Petunjuk untuk mengunduh dan menggunakan alat ini ada di <a href=\"https://stedolan.github.io/jq/download/\" rel=\"nofollow noopener\" target=\"_blank\"> Unduh jq </a> dan tutorial penggunaan di <a href=\"https://stedolan.github.io/jq/manual/\" rel=\"nofollow noopener\" target=\"_blank\"> jq Manual </a></p>\n\n<p> Jika konten ada dalam file dan Anda ingin mengubah file ini secara permanen, gunakan alat edit di tempat seperti <code>sponge</code> yang tersedia dari paket GNU moreutils yang dapat Anda lakukan </p> <pre><code>jq --arg new \"arn:aws:iam::xxxxxxx:role/3\" '.Statement[].Principal.AWS? += [$new]' json | sponge json\n</code></pre> <p> atau gunakan alat POSIX seperti <code>mktemp</code> </p> <pre><code>temp=\"$(mktemp)\"\njq --arg new \"arn:aws:iam::xxxxxxx:role/3\" '.Statement[].Principal.AWS? += [$new]' json &gt; \"$temp\" &amp;&amp; mv \"$temp\" json\n</code></pre>","votes":"8","source":"https://superuser.com/a/1538461","author":"<a href=\"https://superuser.com/users/707284/inian\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Inian</span></a>","replies":[{"reply":"Jenius, biarkan aku menguji ini. Saya banyak menggunakan jq untuk membaca tetapi tidak pernah menambahkan.","author":"<a href=\"https://superuser.com/users/1029766/tr53\" target=\"_blank\" rel=\"nofollow noopener\">tr53</a>"},{"reply":"Saya menggunakan ini dan berhasil aws iam get-role --role-name &lt;rolename&gt; | jq --arg new &quot;arn: aws: iam :: xxxxxxx: role / 3&quot; &#39;.Role.AssumeRolePolicyDocument.Statement []. Principal.AWS? + = [$ baru] &#39;&gt; role.json","author":"<a href=\"https://superuser.com/users/1029766/tr53\" target=\"_blank\" rel=\"nofollow noopener\">tr53</a>"},{"reply":"Terima kasih, saya selalu merasa jq sulit digunakan tetapi saya semakin mahir.","author":"<a href=\"https://superuser.com/users/1029766/tr53\" target=\"_blank\" rel=\"nofollow noopener\">tr53</a>"},{"reply":"Tahukah Anda bagaimana saya bisa menambahkan beberapa entri satu di bawah yang lain? Contoh: &quot;arn: aws: iam :: xxxxxxx: role / 3&quot; &quot;arn: aws: iam :: xxxxxxx: role / 4&quot;","author":"<a href=\"https://superuser.com/users/1029766/tr53\" target=\"_blank\" rel=\"nofollow noopener\">tr53</a>"},{"reply":"@ tr53: Lihat pembaruan","author":"<a href=\"https://superuser.com/users/707284/inian\" target=\"_blank\" rel=\"nofollow noopener\">Inian</a>"},{"reply":"Apakah ada cara untuk menambahkannya satu sama lain tetapi tidak sebagai larik?","author":"<a href=\"https://superuser.com/users/1029766/tr53\" target=\"_blank\" rel=\"nofollow noopener\">tr53</a>"},{"reply":"ok, saya sudah melakukannya.","author":"<a href=\"https://superuser.com/users/1029766/tr53\" target=\"_blank\" rel=\"nofollow noopener\">tr53</a>"}]}]}
