{"title":"Kecilkan gambar disk total: UEFI GPT Flashdrive - ruang kosong di akhir","draft":false,"url":"/kecilkan-gambar-disk-total-uefi-gpt-flashdrive-ruang-kosong-di-akhir-ewbzdoai","votes":"4","answers_count":"1","categories":["Komputer"],"tags":["linux","boot","ssd","uefi","dd"],"snippet":"Saya memiliki gambar disk dari flashdisk yang dapat di-boot. Ini adalah GPT untuk booting EFI, jadi ada partisi Vfat32 kecil dan tiga partisi Linux lainnya, diikuti oleh sekitar 3G ruang kosong.  Saya...","body":"<p> Saya memiliki gambar disk dari flashdisk yang dapat di-boot. Ini adalah GPT untuk booting EFI, jadi ada partisi Vfat32 kecil dan tiga partisi Linux lainnya, diikuti oleh sekitar 3G ruang kosong. </p>\n\n<p> Saya perlu menyalin gambar disk ke flashdisk yang sedikit lebih kecil, jadi saya perlu mengecilkan dari 15G ke 14G lebih atau kurang. Saya akan menggunakan dd di linux untuk membuat salinannya. </p>\n\n<p> gparted sangat bagus untuk memodifikasi dan mengubah ukuran partisi, tetapi pada akhirnya tidak dapat mengecilkan ruang bebas. Secara teoritis seharusnya mungkin untuk memotong file, tetapi ketika saya mencobanya meledakkan (? Tabel diska? Tebakan) sehingga tidak ada partisi dan file tersebut rusak. Saya cukup yakin teknik di bawah ini akan berhasil jika saya menggunakan disk berputar dan / atau disk MBR, tetapi saya belum mengujinya. </p>\n\n<p> Mencoba: </p> <pre><code>dd bs=1M count=14000 iflag=fullblock if=/dev/sda  of=myfile.raw\n</code></pre> <p><em> tidak menyusut </em></p> <pre><code>rsync --sparse filename filename \n</code></pre> <p><em> yang tidak meledakkan tabel disk tetapi mengecilkan swap dan mempertahankan area yang tidak terisi. </em></p>\n\n<p> <code>qemu-img convert -f raw -O qcow2 -S 4k filename filename</code> (direncanakan untuk diubah kembali menjadi mentah) </p>\n\n<p><em> meledakkan tabel </em></p> <pre><code>truncate size=140000M &lt;filename&gt;\n</code></pre> <p><em> juga meledakkan tabel </em></p> <pre><code>cp --sparse=always filename filename\n</code></pre> <p><em> tidak berhasil </em></p>","source":"https://superuser.com/questions/1081623/shrink-total-disk-image-uefi-gpt-flashdrive-freespace-at-end","author":"<a href=\"https://superuser.com/users/503326/john-fisher\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">John Fisher</span></a>","replies":[],"answers":[{"answer":"<p> Harus ada Tabel Partisi GUID primer (utama) di awal dan sekunder (cadangan) di akhir file mentah yang dibuat oleh <code>dd</code>. Pemotongan file akan menghancurkan file sekunder. Ada cara untuk memperbaikinya. </p>\n\n<p> Mari kita mulai dengan file Anda yang tidak terpotong dengan ruang kosong di bagian akhir. Jalankan <code>gdisk -l myfile.raw</code>. Perhatikan <em> ukuran sektor logis </em> (<code>512B</code> mungkin). Temukan yang maksimal <em> sektor akhir </em> (mungkin satu untuk partisi terakhir, tetapi entri partisi mungkin tidak berurutan, jadi perhatikan baik-baik untuk yang maksimal). Sektor diberi nomor dari <code>0</code>, oleh karena itu Anda perlu ( <em> ukuran sektor </em> ) * ( <em> sektor ujung maksimal </em> + 1) byte untuk menyimpan semua partisi. </p>\n\n<p> Selain itu, Anda memerlukan setidaknya 33 sektor penuh ruang kosong di bagian akhir untuk menyimpan GPT sekunder baru. Lihat <a href=\"https://en.wikipedia.org/wiki/File:GUID_Partition_Table_Scheme.svg\" rel=\"nofollow noopener\" target=\"_blank\"> gambar ini dari Wikipedia </a> . </p>\n\n<p> Semuanya Anda butuhkan ( <em> ukuran sektor </em> ) * ( <em> sektor ujung maksimal </em> + 34) byte file Anda. Potong file menjadi ukuran ini atau lebih besar: </p> <pre><code>truncate -s &lt;new_size&gt; myfile.raw\n</code></pre> <p> Panggilan berikutnya </p> <pre><code>gdisk myfile.raw\n</code></pre> <p> Anda akan mendapatkan (antara lain): </p>\n\n<blockquote>\n  <p> Peringatan! Ukuran disk lebih kecil dari yang ditunjukkan oleh header utama! <br> Perhatian: header GPT cadangan tidak valid, tetapi header utama valid; regenerasi\n  header cadangan dari header utama. </p>\n</blockquote>\n\n<p> Ketik <code>w</code>, pukul <kbd> Memasukkan </kbd> untuk menulis tabel partisi yang benar. Anda akan melihat peringatan karena GPT sekunder akan segera dipindahkan. Anda memiliki cukup ruang kosong di akhir file, jadi tidak ada yang perlu dikhawatirkan. Konfirmasikan saat ditanya. </p>\n\n<p> Berhenti dengan <code>q</code>, <kbd> Memasukkan </kbd> . Jalankan <code>gdisk</code> lagi - seharusnya tidak ada peringatan. <strong> GPT sudah diperbaiki </strong> . </p>\n\n<hr>\n\n<p> Jika Anda perlu menggunakan <code>gparted</code> dengan gambar Anda, saya punya beberapa petunjuk. </p>\n\n<p> Perintah <code>sudo gparted myfile.raw</code> mengharapkan file <code>myfile.raw1</code>, <code>myfile.raw2</code> dll ada dan sesuai dengan partisi di dalam <code>myfile.raw</code>. Jika itu adalah file khusus seperti <code>/dev/sdb</code> maka <code>myfile.raw</code> akan menangani <code>/dev/sdb1</code>, <code>/dev/sdb2</code>â€¦ Tidak demikian halnya dengan file biasa. Banyak fitur <code>gparted</code> akan gagal jika tidak ada file <code>myfile.raw</code>. </p>\n\n<p> Untuk membuat file seperti itu gunakan <code>kpartx</code> (atau <code>partx</code> + <code>losetup</code> tandem): </p> <pre><code>sudo kpartx -av myfile.raw\n</code></pre> <p> Amati outputnya (perangkat <code>loopXpY</code> yang dibuat) dan buat symlink ke semua partisi. Yang pertama mungkin: </p> <pre><code>ln -s /dev/mapper/loop0p1 myfile.raw1\n</code></pre> <p> Sekarang <code>gparted</code> harus berjalan dan beroperasi pada partisi tersebut. Namun ada kekurangannya: ketika partisi berubah (misalnya dipindahkan / diubah ukurannya) pemetaan yang dibuat oleh <code>kpartx</code> tidak diperbarui. Biasanya <code>gparted</code> akan menelepon <code>partprobe</code> atau sesuatu untuk memperbarui <code>/dev/sd*</code>; ini tidak akan berhasil dalam kasus kami. Anda harus menghancurkan pemetaan dan membuatnya kembali. Saat memindahkan / mengubah ukuran partisi, jalankan satu tugas <code>gparted</code>, tutup program, perbaiki pemetaan, jalankan <code>gparted</code> dengan tugas kedua dan seterusnya. </p>\n\n<p> Untuk menghancurkan pemetaan, panggil <code>sudo kpartx -dv myfile.raw</code>. Hapus symlink yatim piatu di bagian paling akhir. </p>","votes":"6","source":"https://superuser.com/a/1081649","author":"<a href=\"https://superuser.com/users/432690/kamil-maciorowski\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Kamil Maciorowski</span></a>","replies":[]}]}
