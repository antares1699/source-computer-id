{"title":"GCP - sudo berfungsi di GoogleCloudShell tetapi tidak saat saya ssh ke vm","draft":false,"url":"/gcp-sudo-berfungsi-di-googlecloudshell-tetapi-tidak-saat-saya-ssh-ke-vm-02wvaecg","votes":"4","answers_count":"2","categories":["Komputer"],"tags":["ssh","google-cloud-platform"],"snippet":"Saya membuat VM Google Compute Engine baru (Debian 9) dan membuka shell untuk itu menggunakan shell GoogleCloud. Saya dapat sudo dari jendela shell browser itu.  Saya kemudian mengatur kunci ssh dan ssh...","body":"<p> Saya membuat VM Google Compute Engine baru (Debian 9) dan membuka shell untuk itu menggunakan shell GoogleCloud. Saya dapat <code>sudo</code> dari jendela shell browser itu. </p>\n\n<p> Saya kemudian mengatur kunci ssh dan ssh saya ke dalam vm. Demi pembahasan, nama pengguna saya adalah &quot;user123&quot;. Saya ssh ke vm GCP saya menggunakan: </p>\n\n<p> <code>ssh user123@1.2.3.4</code> </p>\n\n<p> Dengan 1.2.3.4 adalah alamat IP eksternal GCP saya. Saya kemudian masuk. </p>\n\n<p> Jadi sebagai pengguna <code>user123</code> di <strong> GoogleCloudShell </strong> <code>sudo</code> berfungsi, tetapi saat masuk melalui <strong> ssh </strong> sebagai <code>user123</code>, saya dimintai kata sandi. </p> <pre><code>We trust you have received the usual lecture from the local System\nAdministrator. It usually boils down to these three things:\n\n    #1) Respect the privacy of others.\n    #2) Think before you type.\n    #3) With great power comes great responsibility.\n\n[sudo] password for user123:\n</code></pre> <p> Secara alami, saya tidak ingin atau perlu mengatur kata sandi, saya perlu sudo untuk mengizinkan akun pengguna <code>user123</code> ini ke sudo. Tapi itu berfungsi saat masuk ke GoogleCloudShell .... Hum ... Saya akan melacaknya tapi itu pertanyaan saya. </p>\n\n<p> CATATAN: Karena saya memiliki root di file <strong> GoogleCloudShell </strong> (via sudo), saya harus dapat menemukan apa yang perlu saya lakukan dan memperbaikinya. </p>\n\n<p><strong> Apa langkah selanjutnya yang perlu saya ambil agar sudo dapat berfungsi saat masuk melalui ssh? </strong></p>","source":"https://superuser.com/questions/1399934/gcp-sudo-works-in-googlecloudshell-but-not-when-i-ssh-into-vm","author":"<a href=\"https://superuser.com/users/331605/pats\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">PatS</span></a>","replies":[{"reply":"Saya tidak yakin apa yang terjadi, tetapi saya menyiapkan VM lain dan semuanya berfungsi dengan baik. Saya bisa <code>sudo</code> setelah saya ssh ke vm menggunakan <b> ssh pengguna123 @ gcp-host </b> serta dari GoogleCloudShell. Saya mungkin menghapus pertanyaan ini jika tidak ada yang menganggapnya berguna.","author":"<a href=\"https://superuser.com/users/331605/pats\" target=\"_blank\" rel=\"nofollow noopener\">PatS</a>"},{"reply":"Hum ... Plotnya kental. Sesuatu mengacaukan file ~ / .ssh / authorized_keys saya dan ketika saya membuatnya kembali. Saya tidak bisa sudo ketika saya <b> ssh </b> ke dalam GCP vm. Saya pasti melakukan sesuatu dengan cara yang salah (cara yang tidak disukai GCP).","author":"<a href=\"https://superuser.com/users/331605/pats\" target=\"_blank\" rel=\"nofollow noopener\">PatS</a>"},{"reply":"Saya menutup GoogleCloudShell saya dan membukanya kembali. Ketika saya melakukannya, lingkungan GCP menambahkan dua kunci ssh GCP (untuk mendukung GoogleCloudShell, saya menduga). Ketika kunci tersebut ada, saya dapat <code>sudo</code> saat masuk dari <b> ssh </b> .","author":"<a href=\"https://superuser.com/users/331605/pats\" target=\"_blank\" rel=\"nofollow noopener\">PatS</a>"}],"answers":[{"answer":"<p> Saya akan memberi Anda 2 jawaban. </p>\n\n<p> Pertama, cloud shell mengelola metadata instance untuk Anda di belakang layar, dan memungkinkan sudo tanpa kata sandi untuk semua pengguna yang ditambahkan ke proyek dengan cara ini. Gunakan google untuk menyiapkan pengguna Anda </p>\n\n<p><a href=\"https://cloud.google.com/compute/docs/instances/adding-removing-ssh-keys\" rel=\"nofollow noopener\" target=\"_blank\"> https://cloud.google.com/compute/docs/instances/adding-removing-ssh-keys </a>\n<a href=\"https://cloud.google.com/compute/docs/instances/managing-instance-access\" rel=\"nofollow noopener\" target=\"_blank\"> https://cloud.google.com/compute/docs/instances/managing-instance-access </a></p>\n\n<p> Tambahkan akun pengguna yang Anda inginkan melalui konsol proyek. Ini akan menyebarkan pengguna tersebut ke semua host dalam proyek Anda. </p>\n\n<p> Kedua, yang Anda inginkan adalah mengatur sudo tanpa kata sandi. Anda dapat (menggunakan visudo) mengedit / etc / sudoers atau membuat file baru di bawah /etc/sudoers.d dan menambahkan baris seperti ini: </p> <pre><code>user123       ALL = (ALL) NOPASSWD: ALL\n</code></pre> <p> Anda dapat melihat bahwa google melakukannya dengan keanggotaan grup di grup google-sudoers </p> <pre><code>timmy@instance-1:~$ sudo cat /etc/sudoers.d/google_sudoers \n%google-sudoers ALL=(ALL:ALL) NOPASSWD:ALL\ntimmy@instance-1:~$ id\nuid=1000(timmy) gid=1001(timmy) groups=1001(timmy),4(adm),30(dip),44(video),46(plugdev),1000(google-sudoers)\n</code></pre>","votes":"6","source":"https://superuser.com/a/1400281","author":"<a href=\"https://superuser.com/users/889444/timmy-browne\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Timmy Browne</span></a>","replies":[]},{"answer":"<p> Setelah membuat mesin komputasi GCP, Anda tidak perlu melakukan hal khusus agar sudo berfungsi dari ssh. Anda jelas perlu menggunakan GCP Console dan menambahkan kunci Anda seperti yang disebutkan @TimmyBrowne dalam postingannya. Lihat <a href=\"https://cloud.google.com/compute/docs/instances/adding-removing-ssh-keys\" rel=\"nofollow noopener\" target=\"_blank\"> https://cloud.google.com/compute/docs/instances/adding-removing-ssh-keys </a> . </p>\n\n<p> Setelah kunci publik ssh Anda dimasukkan ke dalam instance GCP Compute Engine, Anda dapat ssh ke dalam instance Anda. Tetapi Anda harus menggunakan nama pengguna yang benar. </p>\n\n<p> Misalnya, jika nama pengguna GCP saya adalah fredsmith, dan IP eksternal GCP saya adalah 5.6.7.8, maka perintah ssh saya akan terlihat seperti ini: </p>\n\n<p> <code>ssh fredsmith@5.6.7.8</code> </p>\n\n<p> Dan jelas, kunci ssh pribadi Anda harus cocok dengan kunci publik yang Anda masukkan ke dalam meta-data ssh untuk instance Anda. </p>\n\n<p> Setelah masuk, Anda dapat menjalankan sudo dan berfungsi karena GCP telah menyiapkan instance ini dengan kredensial Anda (fredsmith) dan telah menempatkan Anda (fredsmith) ke dalam grup yang diperlukan sehingga sudo berfungsi yang untuk GCP tampaknya adalah google-sudoers. </p>\n\n<p> Jika Anda ingin membuat pengguna lain dan mengizinkan pengguna tersebut memiliki hak sudo, lihat jawaban @TimmyBrowne saat dia menjelaskan ini. </p>\n\n<p> Saya masih tidak yakin mengapa saya mendapatkan hasil yang tidak konsisten dimana kadang-kadang saya bisa sudo dan di lain waktu saya tidak bisa karena file authorized_keys saya dihapus, tetapi saya tidak memiliki cukup informasi untuk melanjutkan ini lebih jauh. </p>\n\n<p> Karena Timmy Browne menjawab pertanyaanku seperti yang dia pahami, dan sepertinya itu benar. Saya akan memberinya pujian atas jawaban ini, tetapi ingin memposting jawaban saya sehingga jika orang lain melihat perilaku yang sama ini, mereka dapat memberikan suara positif pada jawaban ini dan mudah-mudahan kami dapat melacaknya. </p>","votes":"1","source":"https://superuser.com/a/1401175","author":"<a href=\"https://superuser.com/users/331605/pats\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">PatS</span></a>","replies":[]}]}
