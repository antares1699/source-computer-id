{"title":"Kontainer Docker tidak dapat terhubung ke internet di Fedora 32?","draft":false,"url":"/kontainer-docker-tidak-dapat-terhubung-ke-internet-di-fedora-32-nn8ecbua","votes":"4","answers_count":"3","categories":["Komputer"],"tags":["linux","networking","wireless-networking","docker","docker-compose"],"snippet":"Masalah  Saya baru-baru ini membuat container buruh pelabuhan yang harus menarik repositori github publik, namun tidak dapat menyelesaikan host github.com. Bahkan, ia bahkan tidak dapat menjalankan perintah ping.  CATATAN: semua operasi jaringan...","body":"<h1 class=\"h3\"> Masalah </h1>\n<p> Saya baru-baru ini membuat container buruh pelabuhan yang harus menarik repositori github publik, namun tidak dapat menyelesaikan host github.com. Bahkan, ia bahkan tidak dapat menjalankan perintah ping. </p>\n<p><strong> CATATAN: semua operasi jaringan di sini berada di dalam wadah setelah bangunan, ketika wadah berjalan </strong></p>\n<p> <code>ping www.google.com</code> menghasilkan <code>cannot resolve host</code> </p>\n<p> Itu tidak dapat terhubung ke internet sama sekali. </p>\n<p> Setelah mencari di internet dan <a href=\"https://docs.docker.com/engine/install/linux-postinstall/#ip-forwarding-problems\" rel=\"nofollow noopener\" target=\"_blank\"> Dokumentasi Docker </a></p>\n<h1 class=\"h3\"> Solusi Sudah Dicoba </h1>\n<h2 class=\"h4\"> 1) Mengaktifkan Penerusan IP seperti yang diberikan dalam <a href=\"https://docs.docker.com/engine/install/linux-postinstall/#ip-forwarding-problems\" rel=\"nofollow noopener\" target=\"_blank\"> Dokumentasi Docker </a></h2>\n<p> Saya mencoba mengaktifkan IPForwarding tetapi tidak berhasil. </p>\n<p> Isi <code>/usr/lib/systemd/network/80-container-host0.network</code> setelah mengaktifkan IPForwarding </p> <pre><code>...\n[Network]\nDHCP=yes\nLinkLocalAddressing=yes\nLLDP=yes\nEmitLLDP=customer-bridge\nIPForward=true // this line was changed\n[DHCP]\nUseTimezone=yes\n</code></pre> <h2 class=\"h4\"> 2) Membuat Ulang Jembatan Docker seperti yang diberikan pada <a href=\"https://superuser.com/a/1130993/1214210\" target=\"_blank\" rel=\"nofollow noopener\"> Stack Overflow </a></h2> <pre><code>pkill docker\niptables -t nat -F\nifconfig docker0 down\nbrctl delbr docker0\nsudo service restart docker\n</code></pre> <p> Ini awalnya efektif di <a href=\"https://github.com/moby/moby/issues/866#issuecomment-19218300\" rel=\"nofollow noopener\" target=\"_blank\"> masalah ini </a></p>\n<p> Ada solusi untuk ubuntu, tetapi konfigurasi jaringan saya tidak memilikinya <a href=\"https://superuser.com/a/1274161/1214210\" target=\"_blank\" rel=\"nofollow noopener\"> bermasalah </a> garis </p>\n<p> <code>sudo pico /etc/NetworkManager/NetworkManager.conf</code> saya hanya diisi dengan komentar </p> <pre><code>[main]\n#plugins=ifcfg-rh\n\n\n[logging]\n#level=TRACE\n#domains=ALL\n\n</code></pre> <h2 class=\"h4\"> 3) Menginstal layanan Tabel-IP <a href=\"https://stackoverflow.com/a/60074328/2851473\" target=\"_blank\" rel=\"nofollow noopener\"> StackOverflow </a></h2> <pre><code>sudo yum install iptables-services\nsudo service docker restart\n\n</code></pre> <h2 class=\"h4\"> 4) Mengganti konfigurasi DNS di docker-compose- <a href=\"https://stackoverflow.com/questions/41717180/docker-compose-container-using-host-dns-server\" target=\"_blank\" rel=\"nofollow noopener\"> StackOverflow </a></h2> <pre><code>version: &quot;3.3&quot;\nservices:\n    airflow:\n        build: \n            context: ./airflow\n            dockerfile: Dockerfile\n        ports: \n            - 8080:8080\n        environment: \n            GITHUB_DAG_REPO: https://github.com/siddharths067/HelloAirflow.git\n        dns:\n            - 8.8.8.8\n            - 8.8.4.4\n</code></pre> <h1 class=\"h3\"> Jaringan Docker Periksa Jaringan Gambar </h1>\n<p> Saya tidak tahu apakah ini akan berguna </p> <pre><code>docker network inspect airflowsetup_default \n[\n    {\n        &quot;Name&quot;: &quot;airflowsetup_default&quot;,\n        &quot;Id&quot;: &quot;141a518c1440e603f75774c54f42de33e9173e3f062a0a0bc772db13a7f1ef5d&quot;,\n        &quot;Created&quot;: &quot;2020-08-30T14:42:30.951975699+05:30&quot;,\n        &quot;Scope&quot;: &quot;local&quot;,\n        &quot;Driver&quot;: &quot;bridge&quot;,\n        &quot;EnableIPv6&quot;: false,\n        &quot;IPAM&quot;: {\n            &quot;Driver&quot;: &quot;default&quot;,\n            &quot;Options&quot;: null,\n            &quot;Config&quot;: [\n                {\n                    &quot;Subnet&quot;: &quot;172.18.0.0/16&quot;,\n                    &quot;Gateway&quot;: &quot;172.18.0.1&quot;\n                }\n            ]\n        },\n        &quot;Internal&quot;: false,\n        &quot;Attachable&quot;: true,\n        &quot;Ingress&quot;: false,\n        &quot;ConfigFrom&quot;: {\n            &quot;Network&quot;: &quot;&quot;\n        },\n        &quot;ConfigOnly&quot;: false,\n        &quot;Containers&quot;: {},\n        &quot;Options&quot;: {},\n        &quot;Labels&quot;: {\n            &quot;com.docker.compose.network&quot;: &quot;default&quot;,\n            &quot;com.docker.compose.project&quot;: &quot;airflowsetup&quot;,\n            &quot;com.docker.compose.version&quot;: &quot;1.25.4&quot;\n        }\n    }\n]\n</code></pre> <h3 class=\"h5\"> Keluaran </h3> <pre><code>airflow_1  | GITHUB DAG REPO IS\nairflow_1  | https://github.com/siddharths067/HelloAirflow.git\nairflow_1  | Cloning into 'HelloAirflow'...\nairflow_1  | fatal: unable to access 'https://github.com/siddharths067/HelloAirflow.git/': Could not resolve host: github.com\n</code></pre>","source":"https://superuser.com/questions/1581738/docker-containers-cannot-connect-to-internet-in-fedora-32","author":"<a href=\"https://superuser.com/users/1214210/siddharth-singh\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Siddharth Singh</span></a>","replies":[{"reply":"periksa jawaban saya untuk akar penyebab masalah Anda yang paling mungkin dan solusi yang mungkin.","author":"<a href=\"https://superuser.com/users/917018/konrad-botor\" target=\"_blank\" rel=\"nofollow noopener\">Konrad Botor</a>"}],"answers":[{"answer":"<p> Meskipun OP menemukan solusi untuk masalahnya dan menutup masalah ini, dia tidak menemukan akar masalahnya. Fakta bahwa jaringan jembatan default Docker <code>bridge</code> terhubung ke internet dan <code>airflowsetup_default</code> tidak menunjukkan bahwa ada yang salah dengan pengaturan jaringan Docker. </p>\n<p> Saya melakukan beberapa penelitian dan ternyata Fedora 32 memutuskan tidak terlalu peduli apakah Docker berfungsi atau tidak. </p>\n<p> Bahkan tidak mungkin untuk menginstal Docker dengan cara yang dijelaskan dalam dokumentasi dan jika Anda menginstal paket yang disediakan oleh Fedora, itu masih tidak berfungsi dengan benar - informasi lebih lanjut tentang masalah itu dapat ditemukan <a href=\"https://serverfault.com/questions/1021293/docker-ce-not-available-for-fedora-32\" target=\"_blank\" rel=\"nofollow noopener\"> sini </a> , <a href=\"https://fedoramagazine.org/docker-and-fedora-32/\" rel=\"nofollow noopener\" target=\"_blank\"> sini </a> dan <a href=\"https://github.com/docker/for-linux/issues/955\" rel=\"nofollow noopener\" target=\"_blank\"> sini </a> . </p>\n<p> Masalah utamanya adalah tidak ada konektivitas internet di dalam container jika container terhubung ke jaringan khusus apa pun yang dijembatani - baik itu dibuat menggunakan <code>docker network create</code> atau oleh docker-compose. </p>\n<p> Alasan mengapa sederhana - Docker mengasumsikan bahwa firewall yang digunakan oleh OS adalah <a href=\"https://en.wikipedia.org/wiki/Iptables\" rel=\"nofollow noopener\" target=\"_blank\"> iptables </a> , tetapi Fedora 32 menggunakan <a href=\"https://en.wikipedia.org/wiki/Firewalld\" rel=\"nofollow noopener\" target=\"_blank\"> firewalld </a> secara default. Itu berarti Docker tidak dapat mengkonfigurasi firewall secara manual - itu harus dikonfigurasi secara manual. </p>\n<p> Untuk tujuan referensi, pertama-tama saya akan menjelaskan cara mengatur Docker pada instalasi Fedora 32 yang bersih. </p>\n<p> Pertama jalankan perintah berikut: </p> <pre><code>sudo grubby --update-kernel=ALL --args=&quot;systemd.unified_cgroup_hierarchy=0&quot;\nsudo groupadd docker\nsudo usermod -aG docker $USER\n</code></pre> <p> Ini akan mengkonfigurasi cgroups agar kompatibel dengan Docker daemon dan memungkinkan pengguna Anda menggunakan Docker CLI tanpa sudo. </p>\n<p> Selanjutnya restart sistem Anda untuk menerapkan perubahan dan menjalankan: </p> <pre><code>sudo dnf install -y moby-engine docker-compose nano\nsudo systemctl enable docker\nsudo systemctl start docker\n</code></pre> <p> untuk menginstal dan mengaktifkan Docker. </p>\n<p> Sekarang, masuklah ke direktori yang berisi <code>docker-compose.yml</code> Anda dan jalankan <code>docker-compose up -d</code>. Yuo akan melihat <code>docker-compose</code> membuat jaringan untuk Anda dan kemudian membuat wadah. Jika penampung Anda memerlukan koneksi internet saat startup (seperti OP), penampung akan gagal untuk memulai. </p>\n<p> Sekarang jalankan <code>sudo iptables-save | grep DOCKER</code> dan Anda akan melihat sesuatu seperti: </p> <pre><code>:DOCKER - [0:0]\n:DOCKER-ISOLATION-STAGE-1 - [0:0]\n:DOCKER-ISOLATION-STAGE-2 - [0:0]\n:DOCKER-USER - [0:0]\n-A FORWARD -j DOCKER-USER\n-A FORWARD -j DOCKER-ISOLATION-STAGE-1\n-A FORWARD -o docker0 -j DOCKER\n-A FORWARD -o br-b56fa303f315 -j DOCKER\n-A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2\n-A DOCKER-ISOLATION-STAGE-1 -i br-b56fa303f315 ! -o br-b56fa303f315 -j DOCKER-ISOLATION-STAGE-2\n-A DOCKER-ISOLATION-STAGE-1 -j RETURN\n-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP\n-A DOCKER-ISOLATION-STAGE-2 -o br-b56fa303f315 -j DROP\n-A DOCKER-ISOLATION-STAGE-2 -j RETURN\n-A DOCKER-USER -j RETURN\n:DOCKER - [0:0]\n-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER\n-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER\n-A DOCKER -i docker0 -j RETURN\n-A DOCKER -i br-b56fa303f315 -j RETURN\n</code></pre> <p> <code>docker0</code> adalah jaringan jembatan default Docker, sedangkan <code>br-b56fa303f315</code> adalah jaringan baru yang dibuat oleh <pre><code>sudo dnf install -y moby-engine docker-compose nano\nsudo systemctl enable docker\nsudo systemctl start docker\n</code></pre> (milik Anda mungkin memiliki nama yang berbeda). Jika OS Anda menggunakan <code>iptables</code> semuanya akan bekerja seperti yang diharapkan, tetapi tidak, jadi kami perlu memeriksa konfigurasi <code>docker0</code> di <code>iptables</code>. </p>\n<p> Jalankan <code>firewall-cmd --get-active-zones</code> dan Anda akan mendapatkan sesuatu yang mirip dengan: </p> <pre><code>docker\n  interfaces: docker0\npublic\n  interfaces: eth0 eth1\n</code></pre> <p> Anda dapat melihat bahwa jaringan <code>bridge</code> berada di zona <code>docker</code>, tetapi jaringan baru tidak. Faktanya itu tidak terdaftar sama sekali, yang berarti berada di zona default. Anda dapat memeriksa apa itu dengan menjalankan <code>firewall-cmd --get-default-zone</code>. Pada instalasi Fedora 32 yang bersih, ini <code>public</code>. </p>\n<p> Jadi jalankan (ingat untuk mengganti <code>br-b56fa303f315</code> dengan nama antarmuka Anda): </p> <pre><code>sudo firewall-cmd --zone=docker --add-interface=br-b56fa303f315\n</code></pre> <p> jalankan <code>docker-compose up -d</code> jika layanan Anda gagal untuk memulai sebelumnya dan voila - penampung Anda memiliki konektivitas jaringan. </p>\n<p> Sayangnya jika Anda me-restart sistem Anda, itu akan kehilangan konektivitas itu lagi. </p>\n<p> Anda dapat mencegahnya dengan menggunakan: </p> <pre><code>sudo firewall-cmd --permanent --zone=docker --add-interface=br-b56fa303f315\nsudo firewall-cmd --reload\n</code></pre> <p> Namun jika Anda membuat jaringan baru atau membuat ulang jaringan yang sudah ada (misalnya dengan menjalankan <code>docker-compose down</code> lalu <code>docker-compose up -d</code> lagi), Anda harus mengulangi prosesnya. </p>\n<p> Jadi apa solusi untuk masalah ini? </p>\n<p> Pertama, tuliskan semua antarmuka jaringan yang saat ini terpasang ke zona default - dalam contoh ini <code>eth0</code> dan <pre><code>sudo firewall-cmd --zone=docker --add-interface=br-b56fa303f315\n</code></pre>. </p>\n<p> Kemudian jalankan perintah berikut (mengganti <code>public</code> dengan nama zona default Anda) </p> <pre><code>sudo firewall-cmd --set-default-zone=docker\nsudo firewall-cmd --permanent --zone=public --add-interface=eth0\nsudo firewall-cmd --permanent --zone=public --add-interface=eth1\nsudo firewall-cmd --reload\n</code></pre> <p> Sekarang antarmuka yang sebelumnya berada di zona default Anda seharusnya ada lagi, tetapi semua antarmuka baru (dan karenanya semua jaringan Docker baru) akan secara otomatis ditambahkan ke zona <code>docker</code>, yang akan memberi mereka konektivitas jaringan penuh. </p>","votes":"5","source":"https://superuser.com/a/1583411","author":"<a href=\"https://superuser.com/users/917018/konrad-botor\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Konrad Botor</span></a>","replies":[{"reply":"Sial, tidak heran mengapa aku tidak bisa memahaminya. Ini terlalu rumit bagi saya untuk memahaminya sendiri. Bisakah saya menginstal iptables di fedora? apakah itu akan berhasil?","author":"<a href=\"https://superuser.com/users/1214210/siddharth-singh\" target=\"_blank\" rel=\"nofollow noopener\">Siddharth Singh</a>"},{"reply":"Tidak sesederhana itu. Saya tidak ingin lebih membingungkan masalah ini dalam jawaban saya, tetapi di Linux firewall selalu menjadi bagian dari kernel. Pertama <code>ipfirewall</code>, kemudian <code>ipchains</code>, kemudian <code>iptables</code> dan sekarang <code>nftables</code>. “Firewall” lainnya, termasuk <code>firewalld</code>, hanyalah frontend yang membuat pengelolaannya lebih mudah. Anda dapat membaca alasan mengapa Docker dulu bekerja dengan <code>firewalld</code> di Fedora 31, tetapi tidak 32 di sini: <a href=\"https://fedoraproject.org/wiki/Changes/firewalld_default_to_nftables\" rel=\"nofollow noopener\" target=\"_blank\"> fedoraproject.org/wiki/Changes/firewalld_default_to_nftables </a>","author":"<a href=\"https://superuser.com/users/917018/konrad-botor\" target=\"_blank\" rel=\"nofollow noopener\">Konrad Botor</a>"},{"reply":"Saya pikir mengatur zona default ke <code>docker</code> adalah solusi terbaik, tetapi Anda juga dapat mencoba memaksa <code>firewalld</code> untuk menggunakan <code>iptables</code> seperti yang dijelaskan di sini: <a href=\"https://dev.to/ozorest/fedora-32-how-to-solve-docker-internal-network-issue-22me\" rel=\"nofollow noopener\" target=\"_blank\"> dev.to/ozorest/… </a>","author":"<a href=\"https://superuser.com/users/917018/konrad-botor\" target=\"_blank\" rel=\"nofollow noopener\">Konrad Botor</a>"},{"reply":"Ketika saya mengambil zona aktif, saya bahkan tidak mendapatkan antarmuka <code>public</code> <a href=\"https://pastebin.pl/view/7cf674b7\" rel=\"nofollow noopener\" target=\"_blank\"> pastebin.pl/view/7cf674b7 </a>","author":"<a href=\"https://superuser.com/users/1214210/siddharth-singh\" target=\"_blank\" rel=\"nofollow noopener\">Siddharth Singh</a>"},{"reply":"Output dari perintah itu tergantung pada konfigurasi sistem Anda saat ini. Mungkin Anda tidak memiliki antarmuka di zona <code>public</code>. Periksa zona apa yang Anda miliki: <code>firewall-cmd --get-zones</code>. Jika ada yang bernama <code>docker</code>, Anda masih dapat melakukan <code>sudo firewall-cmd --set-default-zone=docker</code> untuk memperbaiki jaringan Docker. Jika tidak, <code>sudo firewall-cmd --set-default-zone=trusted</code> seharusnya berfungsi, tetapi akan membuat sistem Anda kurang aman.","author":"<a href=\"https://superuser.com/users/917018/konrad-botor\" target=\"_blank\" rel=\"nofollow noopener\">Konrad Botor</a>"}]},{"answer":"<p> Saya mengikuti solusi alternatif <a href=\"https://fedoramagazine.org/docker-and-fedora-32/\" rel=\"nofollow noopener\" target=\"_blank\"> dari Majalah Fedora </a> : </p>\n<blockquote>\n<p> Masukkan buruh pelabuhan ke daftar putih di firewall </p>\n<p> Untuk mengizinkan Docker memiliki akses jaringan, diperlukan dua perintah. </p> <pre><code>sudo firewall-cmd --permanent --zone=trusted --add-interface=docker0\nsudo firewall-cmd --permanent --zone=FedoraWorkstation\n--add-masquerade\n</code></pre> <p> Perintah pertama akan menambahkan antarmuka Docker ke tepercaya\nlingkungan yang memungkinkan Docker membuat koneksi jarak jauh. Kedua\nperintah akan memungkinkan buruh pelabuhan untuk membuat koneksi lokal. Ini adalah\nsangat berguna ketika beberapa kontainer Docker ada sebagai file\npengembangan lingkungan. </p>\n</blockquote>\n<p> Kemudian Anda harus menjalankan perintah ini untuk memvalidasi perubahan </p> <pre><code>sudo firewall-cmd --reload\n</code></pre> <p> Biasanya, Anda tidak perlu me-reboot komputer Anda dan container Anda berikutnya akan terhubung. </p>\n<p> Jika tidak berhasil, Anda dapat mencoba untuk: </p>\n<ol>\n<li> Pertama, mulai ulang penampung baru </li>\n<li> Kedua, restart buruh pelabuhan: <code>sudo systemctl restart docker</code> </li>\n<li> Terakhir, reboot komputer Anda </li>\n</ol>","votes":"1","source":"https://superuser.com/a/1608243","author":"<a href=\"https://superuser.com/users/1249068/eric-masseran\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Eric Masseran</span></a>","replies":[]},{"answer":"<p> Menambahkan <code>network-mode: bridge</code> ke file docker-compose saya sepertinya berhasil. Tetapi saya merasa ini mungkin bukan cara yang tepat untuk melakukan ini. Saya tidak perlu melakukan over-ride apa pun untuk memungkinkan wadah saya terhubung. </p> <pre><code>version: &quot;3.3&quot;\nservices:\n    airflow:\n        build: \n            context: ./airflow\n            dockerfile: Dockerfile\n        ports: \n            - 8080:8080\n        environment: \n            GITHUB_DAG_REPO: https://github.com/siddharths067/HelloAirflow.git\n        # dns:\n        #     - 8.8.8.8\n        #     - 8.8.4.4\n        network_mode: bridge\n</code></pre>","votes":"0","source":"https://superuser.com/a/1581747","author":"<a href=\"https://superuser.com/users/1214210/siddharth-singh\" target=\"_blank\" rel=\"nofollow noopener\"><span itemprop=\"name\">Siddharth Singh</span></a>","replies":[{"reply":"Ini aneh - sejauh yang saya tahu pengaturan <code>network_mode</code> ke <code>bridge</code> memaksa kontainer untuk terhubung ke jaringan jembatan Docker default daripada ke jaringan jembatan khusus proyek yang dibuat secara default oleh docker-compose. Apakah Anda menggunakan kunci <code>networks</code> tingkat atas untuk menyesuaikan jaringan khusus proyek itu? Mungkin itu masalahnya.","author":"<a href=\"https://superuser.com/users/917018/konrad-botor\" target=\"_blank\" rel=\"nofollow noopener\">Konrad Botor</a>"},{"reply":"Saya akan jujur, saya tidak mengerti apa yang Anda katakan. Saya baru saja mencari di internet untuk file buruh pelabuhan dan menggunakan pengaturan ini :(","author":"<a href=\"https://superuser.com/users/1214210/siddharth-singh\" target=\"_blank\" rel=\"nofollow noopener\">Siddharth Singh</a>"},{"reply":"Maksud saya, ketika Anda menentukan <code>network_mode: bridge</code>, Anda menghubungkan container Anda ke jaringan yang disebut <code>bridge</code> - yang dibuat selama instalasi Docker - bukan ke jaringan <code>airflowsetup_default</code> - yang dibuat oleh docker-compose.","author":"<a href=\"https://superuser.com/users/917018/konrad-botor\" target=\"_blank\" rel=\"nofollow noopener\">Konrad Botor</a>"}]}]}
